# åå°ç®¡ç†ç³»ç»Ÿ - æŠ€æœ¯å®ç°æŒ‡å—

**ç‰ˆæœ¬**: V1.0
**åˆ›å»ºæ—¶é—´**: 2026-02-10

---

## ğŸ“Š æ•°æ®åº“è¡¨å…³ç³»å›¾

### æ ¸å¿ƒè¡¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚ ç”¨æˆ·è¡¨ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _openid         â”‚          â”‚
â”‚ real_name       â”‚          â”‚
â”‚ phone           â”‚          â”‚
â”‚ referral_code   â”‚          â”‚
â”‚ referee_id      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (è‡ªå…³è”)
â”‚ ambassador_levelâ”‚
â”‚ merit_points    â”‚
â”‚ cash_points     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                      â”‚
         â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     orders      â”‚ è®¢å•è¡¨             â”‚  user_courses   â”‚ ç”¨æˆ·è¯¾ç¨‹è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚                   â”‚ id              â”‚
â”‚ user_id         â”‚                   â”‚ user_id         â”‚
â”‚ order_no        â”‚                   â”‚ course_id       â”‚
â”‚ order_type      â”‚                   â”‚ purchase_date   â”‚
â”‚ final_amount    â”‚                   â”‚ progress        â”‚
â”‚ pay_status      â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ referee_id      â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
         â”‚                                     â”‚
         â”‚ N:1                                 â”‚ N:1
         â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    courses      â”‚ è¯¾ç¨‹è¡¨             â”‚    courses      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ id              â”‚
â”‚ name            â”‚
â”‚ type            â”‚
â”‚ price           â”‚
â”‚ status          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ class_records   â”‚ ä¸Šè¯¾æ’æœŸè¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ course_id       â”‚
â”‚ start_time      â”‚
â”‚ end_time        â”‚
â”‚ max_students    â”‚
â”‚ current_studentsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  appointments   â”‚ é¢„çº¦è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ user_id         â”‚
â”‚ class_record_id â”‚
â”‚ status          â”‚
â”‚ checkin_time    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤§ä½¿ç³»ç»Ÿè¡¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                      â”‚
         â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ambassador_     â”‚ å¤§ä½¿ç”³è¯·è¡¨         â”‚ ambassador_     â”‚ å¤§ä½¿åé¢è¡¨
â”‚ applications    â”‚                   â”‚ quotas          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚                   â”‚ id              â”‚
â”‚ user_id         â”‚                   â”‚ user_id         â”‚
â”‚ status          â”‚                   â”‚ type            â”‚
â”‚ reason          â”‚                   â”‚ quantity        â”‚
â”‚ reject_reason   â”‚                   â”‚ used_quantity   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ contract_       â”‚ åè®®æ¨¡æ¿è¡¨
â”‚ templates       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ title           â”‚
â”‚ level           â”‚
â”‚ content         â”‚
â”‚ version         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ contract_       â”‚ åè®®ç­¾ç½²è¡¨
â”‚ signatures      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ user_id         â”‚
â”‚ template_id     â”‚
â”‚ contract_no     â”‚
â”‚ status          â”‚
â”‚ signed_at       â”‚
â”‚ expire_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç³»ç»Ÿç®¡ç†è¡¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  admin_users    â”‚ ç®¡ç†å‘˜è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ username        â”‚
â”‚ password        â”‚
â”‚ role            â”‚
â”‚ permissions     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ system_configs  â”‚ ç³»ç»Ÿé…ç½®è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ key             â”‚
â”‚ value           â”‚
â”‚ description     â”‚
â”‚ value_type      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ feedbacks       â”‚ ç”¨æˆ·åé¦ˆè¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ user_id         â”‚
â”‚ type            â”‚
â”‚ content         â”‚
â”‚ status          â”‚
â”‚ reply_content   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ notification_   â”‚ é€šçŸ¥é…ç½®è¡¨
â”‚ configs         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ name            â”‚
â”‚ template_id     â”‚
â”‚ scene           â”‚
â”‚ required        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ notification_   â”‚ é€šçŸ¥æ—¥å¿—è¡¨
â”‚ logs            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚
â”‚ user_id         â”‚
â”‚ config_id       â”‚
â”‚ status          â”‚
â”‚ sent_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” è®¤è¯ä¸æƒé™å®ç°

### JWT Token è®¤è¯æµç¨‹

```javascript
// 1. ç®¡ç†å‘˜ç™»å½•
async function login(username, password) {
  // éªŒè¯ç”¨æˆ·åå¯†ç 
  const admin = await db.collection('admin_users')
    .where({ username, password: md5(password), status: 1 })
    .getOne()

  if (!admin) {
    throw new Error('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
  }

  // ç”Ÿæˆ JWT Token
  const token = jwt.sign(
    {
      id: admin.id,
      username: admin.username,
      role: admin.role
    },
    JWT_SECRET,
    { expiresIn: '24h' }
  )

  return { token, admin }
}

// 2. éªŒè¯ Token
function verifyToken(token) {
  try {
    const decoded = jwt.verify(token, JWT_SECRET)
    return decoded
  } catch (error) {
    throw new Error('Token æ— æ•ˆæˆ–å·²è¿‡æœŸ')
  }
}

// 3. æƒé™æ£€æŸ¥
function checkPermission(admin, permission) {
  // è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
  if (admin.role === 'super_admin') {
    return true
  }

  // æ£€æŸ¥æƒé™åˆ—è¡¨
  const permissions = JSON.parse(admin.permissions || '[]')
  return permissions.includes(permission)
}
```

### å‰ç«¯ Token ç®¡ç†

```javascript
// store/auth.js
import { defineStore } from 'pinia'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    token: localStorage.getItem('admin_token') || '',
    admin: JSON.parse(localStorage.getItem('admin_info') || '{}')
  }),

  actions: {
    // ç™»å½•
    async login(username, password) {
      const res = await wx.cloud.callFunction({
        name: 'system',
        data: { action: 'login', username, password }
      })

      if (res.result.code === 0) {
        this.token = res.result.data.token
        this.admin = res.result.data.admin

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('admin_token', this.token)
        localStorage.setItem('admin_info', JSON.stringify(this.admin))
      }

      return res.result
    },

    // é€€å‡ºç™»å½•
    logout() {
      this.token = ''
      this.admin = {}
      localStorage.removeItem('admin_token')
      localStorage.removeItem('admin_info')
    },

    // æ£€æŸ¥æƒé™
    hasPermission(permission) {
      if (this.admin.role === 'super_admin') {
        return true
      }
      return this.admin.permissions?.includes(permission) || false
    }
  }
})
```

### è·¯ç”±å®ˆå«

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/store/auth'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/login',
      component: () => import('@/views/Login.vue')
    },
    {
      path: '/',
      component: () => import('@/layouts/MainLayout.vue'),
      meta: { requiresAuth: true },
      children: [
        {
          path: 'dashboard',
          component: () => import('@/views/Dashboard.vue')
        },
        {
          path: 'users',
          component: () => import('@/views/Users/List.vue'),
          meta: { permission: 'user:read' }
        }
        // ... å…¶ä»–è·¯ç”±
      ]
    }
  ]
})

// å…¨å±€å‰ç½®å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  // éœ€è¦ç™»å½•çš„é¡µé¢
  if (to.meta.requiresAuth && !authStore.token) {
    next('/login')
    return
  }

  // éœ€è¦æƒé™çš„é¡µé¢
  if (to.meta.permission && !authStore.hasPermission(to.meta.permission)) {
    ElMessage.error('æ— æƒé™è®¿é—®')
    next(from.path)
    return
  }

  next()
})

export default router
```

---

## ğŸ“¡ API è°ƒç”¨å°è£…

### äº‘å‡½æ•°è°ƒç”¨å°è£…

```javascript
// utils/cloudFunction.js
import { useAuthStore } from '@/store/auth'
import { ElMessage } from 'element-plus'

/**
 * è°ƒç”¨äº‘å‡½æ•°
 * @param {string} name - äº‘å‡½æ•°åç§°
 * @param {string} action - æ¥å£ action
 * @param {object} data - è¯·æ±‚å‚æ•°
 */
export async function callCloudFunction(name, action, data = {}) {
  const authStore = useAuthStore()

  try {
    const res = await wx.cloud.callFunction({
      name,
      data: {
        action,
        token: authStore.token, // æºå¸¦ Token
        ...data
      }
    })

    const result = res.result

    // å¤„ç†é”™è¯¯
    if (result.code !== 0) {
      // Token å¤±æ•ˆ
      if (result.code === 401) {
        ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
        authStore.logout()
        window.location.href = '/login'
        return
      }

      ElMessage.error(result.message || 'è¯·æ±‚å¤±è´¥')
      throw new Error(result.message)
    }

    return result.data
  } catch (error) {
    console.error('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥:', error)
    ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    throw error
  }
}
```

### API æ¨¡å—åŒ–

```javascript
// api/user.js
import { callCloudFunction } from '@/utils/cloudFunction'

export const userApi = {
  // è·å–å­¦å‘˜åˆ—è¡¨
  getUserList(params) {
    return callCloudFunction('user', 'admin:getUserList', params)
  },

  // è·å–å­¦å‘˜è¯¦æƒ…
  getUserDetail(userId) {
    return callCloudFunction('user', 'admin:getUserDetail', { userId })
  },

  // ä¿®æ”¹æ¨èäºº
  updateUserReferee(userId, newRefereeId, remark) {
    return callCloudFunction('user', 'admin:updateUserReferee', {
      userId,
      newRefereeId,
      remark
    })
  },

  // è·å–æ¨èäººå˜æ›´æ—¥å¿—
  getRefereeChangeLogs(params) {
    return callCloudFunction('user', 'admin:getRefereeChangeLogs', params)
  }
}

// api/order.js
export const orderApi = {
  // è·å–è®¢å•åˆ—è¡¨
  getOrderList(params) {
    return callCloudFunction('order', 'getOrderList', params)
  },

  // è·å–è®¢å•è¯¦æƒ…
  getOrderDetail(orderNo) {
    return callCloudFunction('order', 'getOrderDetail', { order_no: orderNo })
  },

  // æç°å®¡æ ¸
  withdrawAudit(withdrawalId, status, rejectReason) {
    return callCloudFunction('order', 'withdrawAudit', {
      withdrawal_id: withdrawalId,
      status,
      reject_reason: rejectReason
    })
  }
}

// api/ambassador.js
export const ambassadorApi = {
  // è·å–ç”³è¯·åˆ—è¡¨
  getApplicationList(params) {
    return callCloudFunction('ambassador', 'getApplicationList', params)
  },

  // å®¡æ ¸ç”³è¯·
  auditApplication(id, status, rejectReason) {
    return callCloudFunction('ambassador', 'auditApplication', {
      id,
      status,
      reject_reason: rejectReason
    })
  },

  // è·å–å¤§ä½¿åˆ—è¡¨
  getAmbassadorList(params) {
    return callCloudFunction('ambassador', 'getAmbassadorList', params)
  }
}

// api/course.js
export const courseApi = {
  // è·å–è¯¾ç¨‹åˆ—è¡¨
  getCourseList(params) {
    return callCloudFunction('course', 'getCourseList', params)
  },

  // åˆ›å»ºè¯¾ç¨‹
  createCourse(data) {
    return callCloudFunction('course', 'createCourse', data)
  },

  // æ›´æ–°è¯¾ç¨‹
  updateCourse(id, data) {
    return callCloudFunction('course', 'updateCourse', { id, ...data })
  }
}

// api/system.js
export const systemApi = {
  // ç™»å½•
  login(username, password) {
    return callCloudFunction('system', 'login', { username, password })
  },

  // è·å–ç»Ÿè®¡æ•°æ®
  getStatistics() {
    return callCloudFunction('system', 'getStatistics')
  },

  // è·å–ç³»ç»Ÿé…ç½®
  getConfig(key) {
    return callCloudFunction('system', 'getConfig', { key })
  },

  // æ›´æ–°ç³»ç»Ÿé…ç½®
  updateConfig(key, value) {
    return callCloudFunction('system', 'updateConfig', { key, value })
  }
}
```

---

## ğŸ¨ ç»„ä»¶å¼€å‘ç¤ºä¾‹

### æ•°æ®è¡¨æ ¼ç»„ä»¶

```vue
<!-- components/DataTable.vue -->
<template>
  <div class="data-table">
    <el-table
      :data="data"
      :loading="loading"
      stripe
      border
      @selection-change="handleSelectionChange"
    >
      <el-table-column
        v-if="showSelection"
        type="selection"
        width="55"
      />

      <el-table-column
        v-for="column in columns"
        :key="column.prop"
        :prop="column.prop"
        :label="column.label"
        :width="column.width"
        :formatter="column.formatter"
      >
        <template v-if="column.slot" #default="scope">
          <slot :name="column.slot" :row="scope.row" />
        </template>
      </el-table-column>

      <el-table-column
        v-if="showActions"
        label="æ“ä½œ"
        :width="actionsWidth"
        fixed="right"
      >
        <template #default="scope">
          <slot name="actions" :row="scope.row" />
        </template>
      </el-table-column>
    </el-table>

    <el-pagination
      v-if="showPagination"
      v-model:current-page="currentPage"
      v-model:page-size="pageSize"
      :total="total"
      :page-sizes="[10, 20, 50, 100]"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
    />
  </div>
</template>

<script setup>
import { ref, watch } from 'vue'

const props = defineProps({
  data: Array,
  columns: Array,
  loading: Boolean,
  total: Number,
  page: Number,
  pageSize: Number,
  showSelection: Boolean,
  showActions: Boolean,
  showPagination: { type: Boolean, default: true },
  actionsWidth: { type: Number, default: 150 }
})

const emit = defineEmits(['update:page', 'update:pageSize', 'selection-change'])

const currentPage = ref(props.page || 1)
const pageSize = ref(props.pageSize || 20)

watch(() => props.page, (val) => {
  currentPage.value = val
})

watch(() => props.pageSize, (val) => {
  pageSize.value = val
})

function handleSizeChange(val) {
  emit('update:pageSize', val)
}

function handleCurrentChange(val) {
  emit('update:page', val)
}

function handleSelectionChange(selection) {
  emit('selection-change', selection)
}
</script>
```

### ä½¿ç”¨ç¤ºä¾‹

```vue
<!-- views/Users/List.vue -->
<template>
  <div class="user-list">
    <div class="search-bar">
      <el-input
        v-model="searchForm.keyword"
        placeholder="æœç´¢å§“åæˆ–æ‰‹æœºå·"
        clearable
        @clear="handleSearch"
      />
      <el-select v-model="searchForm.ambassadorLevel" placeholder="å¤§ä½¿ç­‰çº§">
        <el-option label="å…¨éƒ¨" :value="null" />
        <el-option label="åˆçº§å¤§ä½¿" :value="1" />
        <el-option label="ä¸­çº§å¤§ä½¿" :value="2" />
        <el-option label="é«˜çº§å¤§ä½¿" :value="3" />
      </el-select>
      <el-button type="primary" @click="handleSearch">æœç´¢</el-button>
    </div>

    <DataTable
      :data="tableData"
      :columns="columns"
      :loading="loading"
      :total="total"
      :page="page"
      :page-size="pageSize"
      show-actions
      @update:page="handlePageChange"
      @update:pageSize="handleSizeChange"
    >
      <template #ambassadorLevel="{ row }">
        <el-tag :type="getLevelType(row.ambassador_level)">
          {{ getLevelName(row.ambassador_level) }}
        </el-tag>
      </template>

      <template #actions="{ row }">
        <el-button link type="primary" @click="handleView(row)">
          æŸ¥çœ‹è¯¦æƒ…
        </el-button>
        <el-button link type="warning" @click="handleUpdateReferee(row)">
          ä¿®æ”¹æ¨èäºº
        </el-button>
      </template>
    </DataTable>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { userApi } from '@/api/user'
import DataTable from '@/components/DataTable.vue'

const searchForm = reactive({
  keyword: '',
  ambassadorLevel: null
})

const tableData = ref([])
const loading = ref(false)
const total = ref(0)
const page = ref(1)
const pageSize = ref(20)

const columns = [
  { prop: 'real_name', label: 'å§“å', width: 100 },
  { prop: 'phone', label: 'æ‰‹æœºå·', width: 120 },
  { prop: 'city', label: 'åŸå¸‚', width: 100 },
  { prop: 'referral_code', label: 'æ¨èç ', width: 100 },
  { prop: 'ambassador_level', label: 'å¤§ä½¿ç­‰çº§', width: 120, slot: 'ambassadorLevel' },
  { prop: 'merit_points', label: 'åŠŸå¾·åˆ†', width: 100 },
  { prop: 'cash_points', label: 'ç§¯åˆ†', width: 100 },
  { prop: 'created_at', label: 'æ³¨å†Œæ—¶é—´', width: 180 }
]

onMounted(() => {
  fetchData()
})

async function fetchData() {
  loading.value = true
  try {
    const res = await userApi.getUserList({
      page: page.value,
      pageSize: pageSize.value,
      ...searchForm
    })
    tableData.value = res.list
    total.value = res.total
  } finally {
    loading.value = false
  }
}

function handleSearch() {
  page.value = 1
  fetchData()
}

function handlePageChange(val) {
  page.value = val
  fetchData()
}

function handleSizeChange(val) {
  pageSize.value = val
  page.value = 1
  fetchData()
}

function getLevelType(level) {
  const types = ['', 'success', 'warning', 'danger', 'info', 'primary']
  return types[level] || ''
}

function getLevelName(level) {
  const names = ['æ™®é€šç”¨æˆ·', 'åˆçº§å¤§ä½¿', 'ä¸­çº§å¤§ä½¿', 'é«˜çº§å¤§ä½¿', 'é‡‘ç‰Œå¤§ä½¿', 'é’»çŸ³å¤§ä½¿']
  return names[level] || 'æœªçŸ¥'
}

function handleView(row) {
  // è·³è½¬åˆ°è¯¦æƒ…é¡µ
}

function handleUpdateReferee(row) {
  // æ‰“å¼€ä¿®æ”¹æ¨èäººå¯¹è¯æ¡†
}
</script>
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
try {
  const data = await userApi.getUserList(params)
  // å¤„ç†æ•°æ®
} catch (error) {
  // é”™è¯¯å·²åœ¨ callCloudFunction ä¸­å¤„ç†
  // è¿™é‡Œå¯ä»¥åšé¢å¤–çš„å¤„ç†
  console.error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error)
}
```

### 2. åŠ è½½çŠ¶æ€

```vue
<template>
  <el-button :loading="loading" @click="handleSubmit">
    æäº¤
  </el-button>
</template>

<script setup>
const loading = ref(false)

async function handleSubmit() {
  loading.value = true
  try {
    await someApi()
    ElMessage.success('æ“ä½œæˆåŠŸ')
  } finally {
    loading.value = false
  }
}
</script>
```

### 3. è¡¨å•éªŒè¯

```vue
<template>
  <el-form ref="formRef" :model="form" :rules="rules">
    <el-form-item label="ç”¨æˆ·å" prop="username">
      <el-input v-model="form.username" />
    </el-form-item>
    <el-form-item label="å¯†ç " prop="password">
      <el-input v-model="form.password" type="password" />
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="handleSubmit">æäº¤</el-button>
    </el-form-item>
  </el-form>
</template>

<script setup>
const formRef = ref()
const form = reactive({
  username: '',
  password: ''
})

const rules = {
  username: [
    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
    { min: 3, max: 20, message: 'é•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
  ],
  password: [
    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
    { min: 6, message: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº 6 ä½', trigger: 'blur' }
  ]
}

async function handleSubmit() {
  await formRef.value.validate()
  // æäº¤è¡¨å•
}
</script>
```

### 4. æƒé™æ§åˆ¶

```vue
<template>
  <el-button v-if="hasPermission('user:delete')" @click="handleDelete">
    åˆ é™¤
  </el-button>
</template>

<script setup>
import { useAuthStore } from '@/store/auth'

const authStore = useAuthStore()

function hasPermission(permission) {
  return authStore.hasPermission(permission)
}
</script>
```

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### å‰ç«¯éƒ¨ç½²
1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š`npm run build`
2. éƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨ï¼ˆNginxã€CDNï¼‰
3. é…ç½® HTTPS
4. é…ç½® CORSï¼ˆå¦‚æœéœ€è¦ï¼‰

### äº‘å‡½æ•°éƒ¨ç½²
1. ä½¿ç”¨è…¾è®¯äº‘ CloudBase CLI éƒ¨ç½²
2. é…ç½®ç¯å¢ƒå˜é‡
3. é…ç½®è§¦å‘å™¨ï¼ˆHTTP äº‘å‡½æ•°ï¼‰
4. ç›‘æ§æ—¥å¿—å’Œæ€§èƒ½

---

**æ–‡æ¡£ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-10
**ç‰ˆæœ¬**: V1.0
