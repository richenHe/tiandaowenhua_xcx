# 天道文化小程序需求规则文档

## 文档信息

- **版本**：V1.0
- **基于**：需求文档-V2.md (V2.5)
- **创建日期**：2026-01-21
- **文档性质**：需求规则概述文档（详细内容见原需求文档）

---

## 目录

1. [执行摘要](#1-执行摘要)
2. [使命声明与目标用户](#2-使命声明与目标用户)
3. [核心业务规则](#3-核心业务规则)
4. [功能需求](#4-功能需求)
5. [数据模型规范](#5-数据模型规范)
6. [业务流程规则](#6-业务流程规则)
7. [技术架构与技术栈](#7-技术架构与技术栈)
8. [API接口规范](#8-api接口规范)
9. [风险管理与缓解策略](#9-风险管理与缓解策略)
10. [实施计划与验收标准](#10-实施计划与验收标准)
11. [附录：术语表](#11-附录术语表)

---

## 1. 执行摘要

### 1.1 项目概述

本项目旨在开发一个**国学兵法课程线上商城小程序**，为孙膑道天道文化课程提供线上购买、学习管理和推广的完整解决方案。项目采用腾讯云CloudBase Serverless架构，支持微信小程序、H5等多端部署。

**核心价值主张**：
- 提供便捷的课程浏览和购买体验
- 建立完善的传播大使推广体系
- 实现课程复训管理
- 支持直接推荐关系和双重奖励机制（功德分+积分）

**关键指标**：
- 支持多端部署（微信小程序、H5、APP）
- 支持1000+并发用户
- 页面加载时间 < 2秒
- 云函数响应时间 < 500ms

### 📖 详细内容

→ 项目背景与目标：[需求文档 第一章](../需求文档-V2.md#一项目概述)  
→ 技术架构说明：[需求文档 第三章](../需求文档-V2.md#三系统架构)  
→ 技术实现方案：[需求文档 第十章](../需求文档-V2.md#十技术实现方案)

---

## 2. 使命声明与目标用户

### 2.1 产品使命

**为天道文化课程提供线上购买、学习管理和推广的完整解决方案，建立完善的传播大使推广体系。**

### 2.2 目标用户

| 用户类型 | 角色定位 | 核心需求 |
|---------|---------|---------|
| **学员** | 购买和学习天道文化课程的用户 | 课程浏览、在线购买、复训管理 |
| **传播大使** | 推广课程并获得功德分/积分的传播人员 | 推荐二维码、奖励管理、团队管理 |
| **管理员** | 后台管理人员 | 课程管理、学员管理、订单管理、大使管理 |

**大使等级体系**：
- 普通学员（无推广权益）
- 准青鸾大使（可推荐但暂无奖励，只能推荐初探班）
- 青鸾大使（获得功德分奖励）
- 鸿鹄大使（获得积分奖励）
- 金凤大使（更高比例积分奖励）

### 📖 详细内容

→ 目标用户详情：[需求文档 1.2节](../需求文档-V2.md#12-目标用户)  
→ 大使等级体系：[需求文档 3.1.7节](../需求文档-V2.md#317-传播大使模块)

---

## 3. 核心业务规则

### 3.1 功德分与积分互斥规则

**核心原则**：功德分和积分不可同时发放（二选一，仅限推荐奖励）

| 对比项 | 功德分 | 积分 |
|-------|--------|------|
| **性质** | 虚拟奖励分 | 可提现的现金分 |
| **获得方式** | 青鸾大使推荐、所有大使担任辅导员/义工 | 鸿鹄及以上大使推荐 |
| **使用方式** | 商城兑换商品、课程、复训、咨询 | 解冻后可提现 |
| **上限** | 无上限，持续获得 | 有上限（鸿鹄16880） |
| **互斥规则** | 不可与积分同时发放 | 不可与功德分同时发放 |

**关键规则**：
1. 青鸾大使推荐 → 只发功德分，无积分
2. 鸿鹄及以上推荐 → 只发积分（优先解冻）
3. 辅导员和义工 → 所有大使都可担任，只发功德分
4. 密训班包含初探班 → 推荐奖励只按密训班价格38888元计算

### 3.2 推荐人确定机制（三阶段）

**核心原则**：推荐人可多次修改，首次购买支付成功后最终确定并永久锁定

| 阶段 | 时机 | 可修改性 | 说明 |
|------|------|---------|------|
| **阶段1** | 注册时 | ✅ 可修改 | 扫码进入，临时记录推荐人ID |
| **阶段2** | 个人资料修改 | ✅ 可修改 | 7天内只能修改1次，需验证资格 |
| **阶段3** | 购买时 | ⚠️ 支付前可修改 | 支付成功后最终确定，永久锁定 |

**重要规则**：
- 推荐人必须是**准青鸾及以上等级**的传播大使
- 准青鸾大使**只能推荐初探班**
- 其他课程推荐人必须是**青鸾及以上等级**
- 奖励发放给**订单中的推荐人**，而非用户资料中的推荐人

### 3.3 积分冻结解冻机制

**冻结积分额度**：
- 青鸾大使：1688冻结积分（固定额度）
- 鸿鹄大使：16880冻结积分（固定额度）

**解冻规则**：
- **推荐初探班**：解冻1688积分（冻结→可提现）
- **推荐其他课程**：直接按比例加到可提现积分（不消耗冻结）
- 青鸾大使第1次推荐初探班：解冻积分，不发功德分
- 青鸾大使第2次起推荐：只发功德分，不发积分

### 📖 详细内容

→ 奖励系统详情：[需求文档 1.4节](../需求文档-V2.md#14-核心机制说明)  
→ 推荐人机制详情：[需求文档 第二章](../需求文档-V2.md#二推荐人确定机制重要)  
→ 青鸾大使规则：[需求文档 3.1.7.1节](../需求文档-V2.md#青鸾大使)  
→ 鸿鹄大使规则：[需求文档 3.1.7.1节](../需求文档-V2.md#鸿鹄大使)  
→ 功德分管理：[需求文档 3.1.7.2节](../需求文档-V2.md#3172-功德分管理)  
→ 积分管理：[需求文档 3.1.7.3节](../需求文档-V2.md#3173-积分管理)

---

## 4. 功能需求

### 4.1 小程序端功能模块（7大模块）

#### 4.1.1 用户认证模块
- **微信授权登录**：一键登录，获取用户基本信息
- **首次登录资料填写**：必填真实姓名和手机号
- **预览模式**：未完善资料只能浏览，无法操作

#### 4.1.2 首页模块
- **通知公告**：展示后台发布的通知和公告
- **课程列表**：展示所有可购买的课程
- **课程详情**：完整课程信息和在线购买

#### 4.1.3 课程学习模块
- **我的课程**：已购买课程和复训情况
- **预约报名**：预约即将开课的课程
- **复训管理**：第二次及之后上课都称作复训

#### 4.1.4 商学院模块
- **商学院介绍**：文化、理念、师资等信息
- **朋友圈素材**：推广素材（海报、文案）
- **学员案例**：优秀学员学习成果

#### 4.1.5 我的模块
- **购买记录**：所有订单记录
- **预约课程**：已预约的课程
- **意见反馈**：针对课程或通用反馈
- **咨询预约**：一对一咨询服务
- **用户信息**：编辑个人资料和推荐人
- **我的协议**：已签署的传播大使协议

#### 4.1.6 传播大使模块
- **大使等级**：当前等级和权益展示
- **功德分管理**：功德分明细和兑换
- **积分管理**：积分明细和提现
- **推荐二维码**：生成专属推荐码
- **推荐人员信息**：直接推荐的学员列表

#### 4.1.7 订单支付模块
- **订单创建**：选择课程和推荐人
- **推荐人确定**：支付前可修改，支付后锁定
- **微信支付**：调起微信支付
- **支付回调**：更新订单状态，发放奖励

### 4.2 后台管理功能模块（8大模块）

#### 4.2.1 课程管理
- 课程列表、新增/编辑课程
- 消息推送配置
- 课程上下架管理

#### 4.2.2 学员管理
- 学员列表、学员详情
- 推荐人管理、推荐人变更审计
- 复训管理

#### 4.2.3 上课记录管理
- 创建上课记录（课程名称、日期、地点、讲师、期数）
- 签到管理（扫码签到、手动签到）
- 查看签到名单、导出签到表
- 签到记录（区分首次上课和复训）
- 自动触发消息提醒

#### 4.2.4 订单管理
- 订单列表、订单详情
- 退款处理、订单统计

#### 4.2.5 大使管理
- 准青鸾申请管理（面试审核）
- 大使列表、大使详情
- 功德分/积分管理、大使升级
- 活动记录管理（辅导员/义工）

#### 4.2.6 消息提醒管理
- 消息提醒配置
- 消息发送记录
- 手动发送消息

#### 4.2.7 反馈管理
- 反馈列表（按类型、状态、课程筛选）
- 反馈详情（查看内容、图片）
- 回复反馈和状态管理
- 课程反馈统计（满意度分析）

#### 4.2.8 系统管理
- 后台用户管理
- 推荐人变更审计
- 通知公告管理
- 协议模板管理
- 协议签署管理

### 📖 详细内容

→ 小程序端功能详情：[需求文档 3.1节](../需求文档-V2.md#31-小程序端功能)  
→ 后台管理功能详情：[需求文档 3.2节](../需求文档-V2.md#32-后台管理系统功能)  
→ 登录模块：[需求文档 3.1.1节](../需求文档-V2.md#311-登录模块)  
→ 传播大使模块：[需求文档 3.1.7节](../需求文档-V2.md#317-传播大使模块)  
→ 上课记录管理：[需求文档 3.2.4节](../需求文档-V2.md#324-上课记录管理)  
→ 大使管理：[需求文档 3.2.6节](../需求文档-V2.md#326-大使管理)  
→ 反馈管理：[需求文档 3.2.10节](../需求文档-V2.md#3210-反馈管理)

---

## 5. 数据模型规范

### 5.1 核心数据实体（21张表）

#### 用户与权限
1. **users** - 用户表：用户基本信息、推荐人、大使等级、功德分、积分
2. **referee_relations** - 推荐关系表：直接推荐关系
3. **referee_change_logs** - 推荐人变更日志表：审计和风控

#### 课程与学习
4. **courses** - 课程表：课程信息、价格、复训价格
5. **user_courses** - 用户课程表：已购课程、上课次数
6. **class_records** - 上课记录表：每次课程的上课信息（日期、地点、讲师、期数）
7. **attendance_records** - 签到记录表：学员签到详情（首次上课/复训）
8. **appointments** - 预约记录表：课程预约信息

#### 订单与支付
9. **orders** - 订单表：订单信息、推荐人、奖励发放状态

#### 奖励系统
10. **merit_points_records** - 功德分记录表：功德分明细
11. **cash_points_records** - 积分记录表：积分明细（冻结/解冻/直接发放）
12. **withdraw_records** - 提现记录表：积分提现申请

#### 大使系统
13. **ambassador_applications** - 大使申请表：准青鸾申请记录
14. **activity_records** - 活动记录表：辅导员/义工活动

#### 协议系统
15. **contract_templates** - 协议模板表：电子协议模板
16. **contract_signatures** - 协议签署记录表：签署详情

#### 消息系统
17. **course_notification_configs** - 课程消息提醒配置表
18. **notification_logs** - 消息发送记录表
19. **notification_details** - 消息发送明细表

#### 其他
20. **announcements** - 通知公告表
21. **feedbacks** - 意见反馈表：针对课程或通用反馈

### 5.2 关键字段说明

**users表关键字段**：
- `referee_id` - 推荐人ID（可修改，首次购买后确认）
- `is_referee_confirmed` - 推荐人是否已确认（首次购买支付成功后设为1）
- `ambassador_level` - 大使等级（0普通/1准青鸾/2青鸾/3鸿鹄/4金凤）
- `cash_points_frozen` - 冻结积分
- `cash_points_available` - 可提现积分
- `is_first_recommend` - 是否首次推荐（青鸾大使专用）

**orders表关键字段**：
- `referee_id` - 订单推荐人ID（支付前可修改，支付后最终确定）
- `referee_confirmed_at` - 推荐人确认时间（支付成功时记录）
- `is_reward_granted` - 是否已发放奖励

### 📖 详细内容

→ 数据库关系图：[需求文档 4.1节](../需求文档-V2.md#41-数据库关系图)  
→ 核心数据表详情：[需求文档 4.2节](../需求文档-V2.md#42-核心数据表)  
→ 用户表结构：[需求文档 4.2节 users表](../需求文档-V2.md#用户表-users)  
→ 订单表结构：[需求文档 4.2节 orders表](../需求文档-V2.md#订单表-orders)

---

## 6. 业务流程规则

### 6.1 用户注册与资料完善流程

**流程概述**：
1. 微信授权登录 → 获取openid和基本信息
2. 首次登录强制弹出资料填写页面
3. 用户选择：完善资料（正常模式）或暂不填写（预览模式）
4. 预览模式：只能浏览，无法购买、预约等操作

### 6.2 课程购买与推荐人确定流程

**核心流程**：
1. 用户浏览课程详情 → 点击立即购买
2. 创建订单，自动将用户资料中的推荐人ID复制到订单
3. **推荐人资格验证**（关键）：
   - 推荐人必须是准青鸾及以上等级
   - 准青鸾只能推荐初探班
   - 其他课程必须青鸾及以上
   - 验证失败：显示错误提示，阻止下单
4. 订单确认页面显示推荐人信息
5. **支付前可修改推荐人**（最后机会）
6. 调起微信支付
7. **支付成功后**：
   - 推荐人最终确定，不可再修改
   - 如果是首次购买：用户推荐人永久锁定
   - 课程加入"我的课程"
   - 计算并发放推荐人奖励

### 6.3 奖励发放流程

**计算逻辑**：
1. 获取订单推荐人A（不是用户资料推荐人）
2. 查询推荐人A的大使等级
3. 根据等级执行不同逻辑：
   - **准青鸾**：无奖励，检查是否升级为青鸾
   - **青鸾**：第1次推荐初探班解冻积分，第2次起发功德分
   - **鸿鹄/金凤**：只发积分（解冻或直接发放）

**青鸾大使特殊规则**：
- 第1次推荐初探班：解冻1688积分，不发功德分
- 第2次起推荐：只发功德分，不发积分

**鸿鹄大使规则**：
- 推荐初探班：优先解冻冻结积分
- 推荐其他课程：直接按比例加到可提现积分

### 6.4 大使申请与升级流程

**准青鸾申请流程**：
1. 用户购买密训班 → 小程序点击申请大使
2. 填写申请表单 → 提交申请
3. 后台初步审核 → 安排面试
4. 线下/线上面试 → 面试通过
5. 升级为准青鸾大使（等级=1）

**准青鸾→青鸾自动升级**：
1. 准青鸾推荐1位学员购买初探班并支付成功
2. 系统发送升级通知，提示签署协议
3. 用户签署《传播大使合作协议》
4. 正式升级为青鸾大使（等级=2）
5. 发放1688冻结积分
6. 标记这是第1次推荐

### 6.5 协议签署流程

**签署流程**：
1. 系统发送协议签署提醒
2. 用户进入小程序查看协议全文
3. 勾选"我已阅读并同意协议内容"
4. 输入手机号后四位确认签署
5. 系统记录签署时间、IP、设备信息
6. 协议签署后可在"我的协议"中查看

**协议类型**：
- 《传播大使合作协议》：青鸾大使签署，合同期1年
- 《鸿鹄大使补充协议》：鸿鹄大使签署

### 6.6 积分提现流程

1. 用户查看可提现积分 → 点击提现
2. 填写提现金额和账户信息
3. 提交提现申请
4. 后台审核
5. 财务处理转账
6. 更新积分状态
7. 通知用户提现成功

### 6.7 消息提醒流程

1. 后台创建上课记录
2. 系统检查课程消息配置
3. 计算发送时间（上课日期-提前天数）
4. 定时任务每天检查
5. 到达发送时间后获取已预约学员列表
6. 生成消息内容，填充模板变量
7. 逐个发送消息
8. 记录发送结果

### 📖 详细内容

→ 微信授权登录流程：[需求文档 3.1.1节](../需求文档-V2.md#微信授权登录)  
→ 课程购买流程图：[需求文档 3.1.2.3节](../需求文档-V2.md#课程详情)  
→ 奖励计算流程图：[需求文档 3.1.7.2节](../需求文档-V2.md#奖励计算流程)  
→ 青鸾升级流程图：[需求文档 3.1.7.1节](../需求文档-V2.md#升级流程-1)  
→ 积分解冻流程图：[需求文档 3.1.7.3节](../需求文档-V2.md#积分解冻流程推荐初探班)  
→ 消息发送流程图：[需求文档 3.2.7节](../需求文档-V2.md#消息发送流程)

---

## 7. 技术架构与技术栈

### 7.1 整体架构

**架构类型**：腾讯云CloudBase（云开发）Serverless架构

**核心优势**：
- 免运维：无需管理服务器，自动弹性伸缩
- 按量付费：根据实际使用量计费
- 快速开发：前后端一体化开发体验
- 安全可靠：腾讯云级别的安全保障

### 7.2 技术栈

| 层级 | 技术选型 | 说明 |
|-----|---------|------|
| **前端** | uniapp | 支持微信小程序、H5、APP等多端 |
| **后端** | 腾讯云 CloudBase | Serverless架构 |
| **云函数** | Node.js 12.x+ | 业务逻辑实现 |
| **数据库** | 腾讯云 MySQL 5.7/8.0 | 关系型数据库 |
| **云存储** | 腾讯云对象存储（COS） | 图片、文件存储 |
| **云接入** | HTTP API服务 | API网关 |
| **支付** | 微信支付 | 在线支付 |
| **其他服务** | 腾讯云SMS、定时触发器 | 短信、定时任务 |

### 7.3 核心组件

#### 7.3.1 云函数（Cloud Functions）
- **运行环境**：Node.js 12.x+
- **函数类型**：HTTP触发、定时触发、事件触发
- **配置建议**：内存256MB-512MB，超时30秒

#### 7.3.2 云数据库（Cloud Database）
- **类型**：MySQL 5.7/8.0
- **连接**：云函数内网直连
- **优化**：连接池复用、索引优化、慢查询监控

#### 7.3.3 云存储（Cloud Storage）
- **存储内容**：用户头像、课程图片、朋友圈素材、协议PDF
- **访问控制**：公开读私有写、CDN加速、防盗链

#### 7.3.4 云接入（HTTP API）
- API网关自动配置
- HTTPS加密传输
- 跨域配置、请求限流

### 7.4 云函数设计

**函数分类**：
- `user/` - 用户相关（登录、个人资料、推荐人）
- `course/` - 课程相关（列表、详情、我的课程）
- `order/` - 订单相关（创建、支付、回调）
- `ambassador/` - 大使相关（申请、信息、二维码）
- `points/` - 积分相关（功德分、积分、提现）
- `contract/` - 协议相关（模板、签署、查看）
- `admin/` - 后台管理（课程、学员、订单、大使）
- `schedule/` - 定时任务（消息提醒、订单检查、协议状态）

### 📖 详细内容

→ 技术架构图：[需求文档 2.1节](../需求文档-V2.md#21-技术架构)  
→ 系统模块图：[需求文档 2.2节](../需求文档-V2.md#22-系统模块)  
→ CloudBase架构详情：[需求文档 10.1节](../需求文档-V2.md#101-腾讯云cloudbase架构)  
→ 云函数设计：[需求文档 10.1.3节](../需求文档-V2.md#1013-云函数设计)  
→ 性能优化建议：[需求文档 10.1.8节](../需求文档-V2.md#1018-性能优化建议)

---

## 8. API接口规范

### 8.1 接口分类（11类）

#### 8.1.1 用户相关接口（7个）
- `POST /api/user/login` - 微信登录
- `POST /api/user/complete-profile` - 完善个人资料
- `GET /api/user/info` - 获取用户信息
- `PUT /api/user/update-referee` - 更新推荐人
- `GET /api/user/ambassador-list` - 获取可选的传播大使列表
- `GET /api/user/referee-status` - 查询推荐人状态
- `GET /api/user/profile-status` - 查询资料完善状态

#### 8.1.2 课程相关接口（3个）
- `GET /api/course/list` - 课程列表
- `GET /api/course/detail` - 课程详情
- `GET /api/course/my` - 我的课程

#### 8.1.3 订单相关接口（6个）
- `POST /api/order/create` - 创建订单（含推荐人资格验证）
- `PUT /api/order/update-referee` - 修改订单推荐人
- `POST /api/order/pay` - 发起支付
- `POST /api/order/notify` - 支付回调
- `GET /api/order/list` - 订单列表
- `GET /api/order/detail` - 订单详情

#### 8.1.4 预约相关接口（4个）
- `GET /api/appointment/class-plans` - 课程计划列表
- `POST /api/appointment/create` - 创建预约
- `DELETE /api/appointment/cancel` - 取消预约
- `GET /api/appointment/my` - 我的预约

#### 8.1.5 功德分相关接口（3个）
- `GET /api/merit-points/balance` - 功德分余额
- `GET /api/merit-points/records` - 功德分明细
- `POST /api/merit-points/exchange` - 功德分兑换

#### 8.1.6 积分相关接口（4个）
- `GET /api/cash-points/balance` - 积分余额
- `GET /api/cash-points/records` - 积分明细
- `POST /api/cash-points/withdraw` - 申请提现
- `GET /api/cash-points/withdraw-list` - 提现记录

#### 8.1.7 大使相关接口（6个）
- `GET /api/ambassador/info` - 大使信息
- `POST /api/ambassador/apply` - 申请成为准青鸾大使
- `GET /api/ambassador/apply-status` - 查看申请状态
- `GET /api/ambassador/qrcode` - 生成推荐二维码
- `GET /api/ambassador/referees` - 推荐人员列表
- `GET /api/ambassador/validate-referee` - 验证推荐人资格

#### 8.1.8 消息提醒相关接口（3个）
- `GET /api/notification/configs` - 获取消息提醒配置
- `POST /api/notification/subscribe` - 订阅消息授权
- `GET /api/notification/history` - 获取消息历史

#### 8.1.9 其他接口（4个）
- `GET /api/announcement/list` - 公告列表
- `GET /api/announcement/detail` - 公告详情
- `GET /api/material/list` - 素材列表
- `GET /api/case/list` - 学员案例列表

#### 8.1.10 反馈相关接口（4个）
- `GET /api/feedback/my-courses` - 获取可反馈的课程列表
- `GET /api/feedback/types` - 获取反馈类型列表
- `POST /api/feedback/submit` - 提交反馈
- `GET /api/feedback/detail` - 反馈详情

#### 8.1.11 协议相关接口（8个）

**小程序端**：
- `GET /api/contract/template` - 获取协议模板
- `POST /api/contract/sign` - 签署协议
- `GET /api/contract/my-list` - 我的协议列表
- `GET /api/contract/detail` - 协议详情
- `GET /api/contract/check-sign-status` - 检查协议签署状态

**后台管理**：
- `GET /api/admin/contract/template-list` - 协议模板列表
- `GET /api/admin/contract/signature-list` - 协议签署记录列表
- `POST /api/admin/contract/renew` - 手动续签协议

### 8.2 关键接口说明

#### 推荐人资格验证（核心）
```
GET /api/ambassador/validate-referee
参数：referee_id, course_type
返回：valid, error_message, referee_info
```
**验证规则**：
- 推荐人必须是准青鸾及以上等级
- 准青鸾只能推荐初探班（course_type=1）
- 其他课程必须青鸾及以上等级

#### 订单创建（核心）
```
POST /api/order/create
参数：course_id, referee_id（可选）
返回：order_no, amount, referee_id, referee_name
```
**业务逻辑**：
- 订单推荐人优先级：订单指定 > 用户资料 > 无推荐人
- 推荐人资格验证（验证失败不允许创建订单）
- 记录推荐人变更日志

### 📖 详细内容

→ 接口设计完整文档：[需求文档 第五章](../需求文档-V2.md#五接口设计建议)  
→ 用户相关接口：[需求文档 5.1节](../需求文档-V2.md#51-用户相关接口)  
→ 订单相关接口：[需求文档 5.3节](../需求文档-V2.md#53-订单相关接口)  
→ 协议相关接口：[需求文档 5.11节](../需求文档-V2.md#511-协议相关接口)

---

## 9. 风险管理与缓解策略

### 9.1 技术风险

**风险**：支付回调处理失败导致订单状态异常  
**应对**：
- 实现支付结果主动查询机制
- 定时任务检查异常订单
- 支付回调幂等性处理

### 9.2 业务风险

**风险**：功德分/积分计算错误导致财务损失  
**应对**：
- 多重校验机制
- 人工审核大额积分
- 可回滚机制

### 9.3 合规风险

**风险**：推荐分佣机制违反法律规定  
**应对**：
- 只设置直接推荐关系（无多层级）
- 咨询法律顾问
- 避免传销嫌疑

### 9.4 运营风险

**风险**：恶意刷单和虚假推荐  
**应对**：
- 风控系统
- 异常订单人工审核
- 黑名单机制

### 9.5 积分风险

**风险**：积分解冻机制被恶意利用  
**应对**：
- 严格审核提现申请
- 限制提现频率
- 设置提现阈值

### 9.6 推荐人变更风险

#### 风险1：用户频繁修改推荐人套取奖励
**应对**：
- 7天内只能修改一次推荐人
- 记录所有变更日志，后台可审计
- 异常检测系统，自动标记高风险行为
- 支付成功后推荐人不可修改

#### 风险2：用户和推荐人串通刷单
**应对**：
- 同一IP短时间内多次修改推荐人：标记异常
- 同一推荐人短时间内被大量用户设置：刷单嫌疑
- 用户在多个推荐人之间频繁切换：高风险标记
- 后台人工审核可疑订单

#### 风险3：循环推荐和自己推荐自己
**应对**：
- 系统校验：不允许自己推荐自己
- 系统校验：不允许下级推荐上级
- 数据完整性约束

#### 风险4：首次购买后恶意修改推荐人
**应对**：
- 首次购买支付成功后推荐人永久锁定
- 订单推荐人在支付成功后不可修改
- 管理员修改需特殊权限并记录详细日志

### 📖 详细内容

→ 项目关键风险详情：[需求文档 第九章](../需求文档-V2.md#九项目关键风险)  
→ 推荐人变更风险：[需求文档 9.6节](../需求文档-V2.md#96-推荐人变更风险)

---

## 10. 实施计划与验收标准

### 10.1 版本迭代规划

#### V1.0（基础版）
**核心功能**：
- 用户注册登录
- 课程浏览和购买
- 电子协议签署系统
- 基础推荐关系
- 功德分系统
- 积分系统（冻结/解冻/提现）
- 消息提醒功能
- 后台管理
- 协议模板管理
- 协议签署记录管理

#### V1.1（优化版）
- 在线客服
- 商城用品兑换
- 直播课程
- 课程评价
- 优惠券系统

#### V2.0（增强版）
- 社区功能
- 学习打卡
- 作业提交
- 在线考试
- 学习证书

#### V3.0（生态版）
- 知识付费
- 内容传播
- 私域流量运营
- 数据大屏
- AI智能推荐

### 10.2 上线检查清单（核心项）

#### 小程序审核准备
- ☐ 小程序基本信息完善
- ☐ 营业执照和资质上传
- ☐ 类目选择（教育/在线教育）
- ☐ 隐私政策和用户协议
- ☐ 支付功能申请
- ☐ 测试账号提供

#### 功能测试
- ☐ 登录授权流程
- ☐ 课程浏览和购买
- ☐ 支付流程（实际支付测试）
- ☐ 功德分计算准确性
- ☐ 积分冻结解冻准确性
- ☐ 推荐关系建立和修改流程
- ☐ 推荐人资格验证
- ☐ 奖励发放准确性
- ☐ 大使申请流程
- ☐ 协议签署流程
- ☐ 上课记录和签到管理
- ☐ 意见反馈提交和管理
- ☐ 后台推荐人变更审计功能

#### 数据准备
- ☐ 初始课程数据录入
- ☐ 传播大使协议模板准备
- ☐ 通知公告发布
- ☐ 商学院介绍内容
- ☐ 朋友圈素材准备
- ☐ 学员案例录入
- ☐ 后台管理员账号创建

### 10.3 验收标准

**性能标准**：
- 页面加载时间 < 2秒
- 云函数响应时间 < 500ms
- 支持同时在线用户 > 1000人

**功能标准**：
- 所有核心功能正常运行
- 推荐人机制运转正常
- 奖励发放准确无误
- 协议签署流程完整

**安全标准**：
- HTTPS加密传输
- 支付安全验证
- 积分提现双重验证
- 协议签署安全记录

### 📖 详细内容

→ 后续迭代规划：[需求文档 第八章](../需求文档-V2.md#八后续迭代规划)  
→ 上线检查清单：[需求文档 第七章](../需求文档-V2.md#七上线检查清单)  
→ 非功能性需求：[需求文档 第六章](../需求文档-V2.md#六非功能性需求)

---

## 11. 附录：术语表

### 核心术语

| 术语 | 定义 |
|------|------|
| **初探班** | 入门级课程，价格1688元 |
| **密训班** | 高级课程套餐，价格38888元，默认包含初探班课程，可直接购买 |
| **复训** | 已购课程学员重复上课（第二次及之后都称作复训） |
| **预览模式** | 未完善资料的用户只能浏览，无法购买、预约等操作 |

### 大使等级

| 术语 | 定义 |
|------|------|
| **普通学员** | 无推广权益，不能作为推荐人 |
| **准青鸾大使** | 购买密训班并通过面试后的中间级别，可作为推荐人但暂无推广奖励，只能推荐初探班学员 |
| **青鸾大使** | 正式的传播大使，成为时获得1688冻结积分，第1次推荐初探班解冻积分，第2次起推荐只获得功德分 |
| **鸿鹄大使** | 高级传播大使，推荐只获得积分，不获得功德分 |
| **金凤大使** | 最高级别传播大使，更高比例积分奖励 |

### 奖励系统

| 术语 | 定义 |
|------|------|
| **功德分** | 虚拟奖励分，不可提现，只能在商城兑换。获得途径：①青鸾大使推荐（第2次起），②所有大使担任辅导员/义工 |
| **积分** | 可提现的现金分，青鸾大使第1次推荐解冻，鸿鹄及以上大使推荐获得 |
| **冻结积分** | 固定额度的积分（青鸾1688，鸿鹄16880），只能通过推荐初探班解冻 |
| **可提现积分** | 可以申请提现的积分，来源：①冻结积分解冻，②推荐其他课程直接发放 |
| **积分解冻** | 推荐初探班时，将冻结积分转为可提现积分的过程 |
| **积分直接发放** | 推荐密训班/咨询/顾问时，不消耗冻结积分，直接按比例加到可提现积分 |
| **互斥规则** | 功德分和积分不可同时发放，每次奖励只发放其中一种 |
| **首次推荐标识** | 青鸾大使专用字段，标识是否已完成第1次推荐并解冻积分 |

### 推荐人机制

| 术语 | 定义 |
|------|------|
| **直接推荐关系** | 传播大使与其直接推荐的学员之间的一对一推荐关系 |
| **推荐人确定机制** | 用户的推荐人可在注册、个人资料、订单确认时多次修改，首次购买支付成功后最终确定并永久锁定 |
| **临时推荐人** | 用户注册时通过扫码带来的推荐人ID，保存在用户资料中但可修改 |
| **订单推荐人** | 订单中记录的推荐人ID，可在支付前修改，支付成功后不可修改 |
| **最终推荐人** | 用户首次购买支付成功后，订单中的推荐人即为最终推荐人，后续不可修改 |
| **推荐人确认** | 首次购买支付成功后，用户的is_referee_confirmed设为1，推荐人被永久锁定 |
| **推荐人变更日志** | 记录所有推荐人修改操作的日志表，用于审计和风控 |
| **推荐人修改频率限制** | 用户7天内只能修改一次推荐人，防止恶意刷单 |
| **奖励发放依据** | 奖励发放给订单中最终确定的推荐人，而非用户资料中的推荐人 |

### 推荐人资格

| 术语 | 定义 |
|------|------|
| **推荐人资格限制** | 普通学员不能作为推荐人；准青鸾大使可作为推荐人，但只能推荐初探班；青鸾及以上大使可推荐所有课程 |
| **推荐人资格验证** | 创建订单和修改订单推荐人时，系统验证推荐人等级与课程类型的匹配关系，验证失败则阻止操作并提示用户更换推荐人 |

### 协议系统

| 术语 | 定义 |
|------|------|
| **电子协议** | 传播大使在小程序中以电子方式签署的法律协议，具有法律效力 |
| **协议模板** | 后台预设的协议内容模板，支持变量替换，可版本管理 |
| **协议签署** | 大使通过勾选同意并输入手机号后四位确认的电子签署行为 |
| **传播大使合作协议** | 准青鸾升级为正式青鸾大使时签署的合作协议，合同期1年 |
| **鸿鹄大使补充协议** | 青鸾大使升级为鸿鹄大使时签署的补充协议 |
| **协议版本** | 协议模板的版本号（如v1.0），每次修改内容自动生成新版本 |
| **协议快照** | 大使签署时保存的协议完整内容，保证签署内容不可篡改 |
| **合同期** | 传播大使合作协议的有效期限，默认1年，到期需续签 |
| **协议前置条件** | 准青鸾大使无需签署协议，只有正式青鸾大使及以上等级才需要签署协议 |

### 📖 详细内容

→ 完整术语表：[需求文档 10.1节](../需求文档-V2.md#101-术语表)

---

## 文档版本历史

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| V1.0 | 2026-01-21 | 初始版本，基于需求文档-V2.md (V2.5)创建需求规则概述文档 |

---

## 文档说明

本文档为**需求规则概述文档**，提供项目的核心要点和快速索引。所有详细内容通过引用链接到 [`需求文档-V2.md`](../需求文档-V2.md)。

**使用建议**：
- 快速了解项目：阅读本文档
- 深入了解细节：点击引用链接查看原需求文档
- 开发参考：本文档 + 原需求文档结合使用

**文档维护**：
- 本文档：概述和索引（定期同步）
- 原需求文档：详细规格和规范（持续更新）

