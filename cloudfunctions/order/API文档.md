# Order äº‘å‡½æ•° API æ–‡æ¡£

**äº‘å‡½æ•°åç§°**: `order`
**ç‰ˆæœ¬**: V1.0
**æ›´æ–°æ—¶é—´**: 2026-02-10
**è¿è¡Œæ—¶**: Nodejs18.15

---

## ğŸ“‹ ç›®å½•

1. [å…¬å¼€æ¥å£](#å…¬å¼€æ¥å£)ï¼ˆ1ä¸ªï¼‰
2. [å®¢æˆ·ç«¯æ¥å£](#å®¢æˆ·ç«¯æ¥å£)ï¼ˆ8ä¸ªï¼‰
3. [ç®¡ç†ç«¯æ¥å£](#ç®¡ç†ç«¯æ¥å£)ï¼ˆ4ä¸ªï¼‰

---

## è°ƒç”¨æ–¹å¼

### äº‘å‡½æ•°è°ƒç”¨
```javascript
wx.cloud.callFunction({
  name: 'order',
  data: {
    action: 'create',  // æ¥å£åç§°
    // å…¶ä»–å‚æ•°...
  }
})
```

### é€šç”¨å“åº”æ ¼å¼
```json
{
  "code": 0,           // 0æˆåŠŸï¼Œé0å¤±è´¥
  "message": "æˆåŠŸ",
  "data": {}           // ä¸šåŠ¡æ•°æ®
}
```

### å¸¸è§é”™è¯¯ç 
- `401`: æœªç™»å½•æˆ–ç™»å½•æ€å¤±æ•ˆ
- `403`: èµ„æ–™æœªå®Œå–„ï¼ˆéœ€è¦å®Œå–„èµ„æ–™ï¼‰
- `404`: èµ„æºä¸å­˜åœ¨
- `422`: å‚æ•°éªŒè¯å¤±è´¥
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## å…¬å¼€æ¥å£

### 1. paymentCallback - æ”¯ä»˜å›è°ƒ

**Action**: `paymentCallback`
**æƒé™**: å…¬å¼€ï¼ˆæ— éœ€ç™»å½•ï¼‰
**çŠ¶æ€**: âš ï¸ åŠŸèƒ½å¼€å‘ä¸­

**è¯´æ˜**: å¾®ä¿¡æ”¯ä»˜æˆåŠŸå›è°ƒï¼Œæ ¹æ®ä¸åŒè®¢å•ç±»å‹æ‰§è¡Œç›¸åº”ä¸šåŠ¡é€»è¾‘

**è¯·æ±‚å‚æ•°**: ç”±å¾®ä¿¡æœåŠ¡å™¨å‘é€

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æ”¯ä»˜å›è°ƒåŠŸèƒ½å¼€å‘ä¸­",
  "data": {
    "status": "developing",
    "message": "æ”¯ä»˜å›è°ƒåŠŸèƒ½å¼€å‘ä¸­ï¼Œå¾…é…ç½®å•†æˆ·ä¿¡æ¯åå¯ç”¨"
  }
}
```

**æ³¨æ„**: å¾…é…ç½®å¾®ä¿¡å•†æˆ·ä¿¡æ¯åå¯ç”¨

---

## å®¢æˆ·ç«¯æ¥å£

### 1. create - åˆ›å»ºè®¢å•

**Action**: `create`
**æƒé™**: éœ€è¦ç™»å½•
**èµ„æ–™æ£€æŸ¥**: âœ… éœ€è¦å®Œå–„èµ„æ–™

**è¯´æ˜**: ç»Ÿä¸€è®¢å•åˆ›å»ºæ¥å£ï¼Œä»…ç”¨äºæ¶‰åŠçœŸå®é‡‘é’±çš„äº¤æ˜“åœºæ™¯

**é€‚ç”¨åœºæ™¯**:
- `order_type=1`: è¯¾ç¨‹è´­ä¹°ï¼ˆåˆæ¢ç­/å¯†è®­ç­ï¼‰
- `order_type=2`: å¤è®­è´¹æ”¯ä»˜
- `order_type=4`: éœ€æ”¯ä»˜çš„å¤§ä½¿å‡çº§

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "create",
  "order_type": 1,           // å¿…å¡«ï¼Œ1è¯¾ç¨‹/2å¤è®­/4å‡çº§
  "item_id": 1,              // å¿…å¡«ï¼Œé¡¹ç›®IDï¼ˆæ ¹æ®order_typeå«ä¹‰ä¸åŒï¼‰
  "class_record_id": 5,      // å¯é€‰ï¼Œä¸Šè¯¾è®°å½•IDï¼ˆå¤è®­ä¸“ç”¨ï¼‰
  "referee_id": 100          // å¯é€‰ï¼Œæ¨èäººIDï¼ˆä¸ä¼ åˆ™ä½¿ç”¨ç”¨æˆ·èµ„æ–™ä¸­çš„æ¨èäººï¼‰
}
```

**å‚æ•°è¯´æ˜**:
- `order_type=1` æ—¶ï¼Œ`item_id` ä¸ºè¯¾ç¨‹ID
- `order_type=2` æ—¶ï¼Œ`item_id` ä¸ºç”¨æˆ·è¯¾ç¨‹IDï¼Œ`class_record_id` å¿…å¡«
- `order_type=4` æ—¶ï¼Œ`item_id` ä¸ºç›®æ ‡ç­‰çº§

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "è®¢å•åˆ›å»ºæˆåŠŸ",
  "data": {
    "order_no": "ORD202602100001",
    "order_type": 1,
    "order_name": "åˆæ¢ç­",
    "amount": 1688.00,
    "referee_id": 100,
    "referee_uid": "cloud-uid-100",
    "referee_name": "æ¨èäººå§“å",
    "referee_level": 2,
    "status": 0,
    "expires_at": "2026-02-10 11:00:00"
  }
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å®Œå–„ï¼ˆ`profile_completed = 1`ï¼‰
2. æ ¹æ® `order_type` éªŒè¯ä¸åŒä¸šåŠ¡è§„åˆ™
3. ç”Ÿæˆè®¢å•å·ï¼ˆORD + å¹´æœˆæ—¥ + 10ä½éšæœºæ•°ï¼‰
4. è®¾ç½®30åˆ†é’Ÿè¿‡æœŸæ—¶é—´
5. è¿”å›è®¢å•ä¿¡æ¯

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "code": 403,
  "message": "è¯·å…ˆå®Œå–„èµ„æ–™",
  "data": {
    "action": "complete_profile",
    "redirect_url": "/pages/auth/complete-profile/index"
  }
}
```

---

### 2. createPayment - å‘èµ·æ”¯ä»˜

**Action**: `createPayment`
**æƒé™**: éœ€è¦ç™»å½•
**çŠ¶æ€**: âš ï¸ åŠŸèƒ½å¼€å‘ä¸­

**è¯´æ˜**: è°ƒç”¨å¾®ä¿¡æ”¯ä»˜ç»Ÿä¸€ä¸‹å•ï¼Œè¿”å›æ”¯ä»˜å‚æ•°

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "createPayment",
  "order_no": "ORD202602100001"  // å¿…å¡«ï¼Œè®¢å•å·
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æ”¯ä»˜åŠŸèƒ½å¼€å‘ä¸­",
  "data": {
    "status": "developing",
    "message": "æ”¯ä»˜åŠŸèƒ½å¼€å‘ä¸­ï¼Œå¾…é…ç½®å•†æˆ·ä¿¡æ¯åå¯ç”¨",
    "order_no": "ORD202602100001",
    "amount": 1688.00
  }
}
```

**æ³¨æ„**: å¾…é…ç½®å¾®ä¿¡å•†æˆ·ä¿¡æ¯åå¯ç”¨

---

### 3. getDetail - è®¢å•è¯¦æƒ…

**Action**: `getDetail`
**æƒé™**: éœ€è¦ç™»å½•

**è¯´æ˜**: æŸ¥è¯¢è®¢å•è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getDetail",
  "order_no": "ORD202602100001"  // å¿…å¡«ï¼Œè®¢å•å·
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "order_no": "ORD202602100001",
    "user_id": 1,
    "order_type": 1,
    "order_name": "åˆæ¢ç­",
    "original_amount": 1688.00,
    "final_amount": 1688.00,
    "pay_status": 0,
    "pay_status_name": "å¾…æ”¯ä»˜",
    "pay_time": null,
    "pay_method": null,
    "transaction_id": null,
    "is_reward_granted": false,
    "reward_granted_at": null,
    "created_at": "2026-02-10 10:00:00",
    "expires_at": "2026-02-10 10:30:00",
    "referee_id": 100,
    "referee_uid": "cloud-uid-100",
    "referee_name": "æ¨èäººå§“å",
    "referee_level": 2,
    "course_id": 1,
    "course_name": "åˆæ¢ç­",
    "course_type": 1
  }
}
```

**æ”¯ä»˜çŠ¶æ€è¯´æ˜**:
- `0`: å¾…æ”¯ä»˜
- `1`: å·²æ”¯ä»˜
- `2`: å·²å–æ¶ˆ
- `3`: å·²å…³é—­
- `4`: å·²é€€æ¬¾

---

### 4. getList - è®¢å•åˆ—è¡¨

**Action**: `getList`
**æƒé™**: éœ€è¦ç™»å½•

**è¯´æ˜**: æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getList",
  "status": 1,        // å¯é€‰ï¼Œæ”¯ä»˜çŠ¶æ€ç­›é€‰ï¼ˆ0å¾…æ”¯ä»˜/1å·²æ”¯ä»˜/2å·²å–æ¶ˆ/3å·²å…³é—­/4å·²é€€æ¬¾ï¼‰
  "page": 1,          // å¯é€‰ï¼Œé¡µç ï¼Œé»˜è®¤1
  "page_size": 10     // å¯é€‰ï¼Œæ¯é¡µæ•°é‡ï¼Œé»˜è®¤10
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 10,
    "page": 1,
    "page_size": 10,
    "list": [
      {
        "order_no": "ORD202602100001",
        "order_type": 1,
        "order_name": "åˆæ¢ç­",
        "final_amount": 1688.00,
        "pay_status": 1,
        "pay_status_name": "å·²æ”¯ä»˜",
        "pay_time": "2026-02-10 10:30:00",
        "referee_name": "æ¨èäºº",
        "is_reward_granted": true,
        "created_at": "2026-02-10 10:00:00",
        "expires_at": "2026-02-10 10:30:00"
      }
    ]
  }
}
```

---

### 5. cancel - å–æ¶ˆè®¢å•

**Action**: `cancel`
**æƒé™**: éœ€è¦ç™»å½•

**è¯´æ˜**: å–æ¶ˆå¾…æ”¯ä»˜è®¢å•

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "cancel",
  "order_no": "ORD202602100001",  // å¿…å¡«ï¼Œè®¢å•å·
  "cancel_reason": "ä¸æƒ³ä¹°äº†"      // å¯é€‰ï¼Œå–æ¶ˆåŸå› 
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "è®¢å•å·²å–æ¶ˆ",
  "data": {
    "order_no": "ORD202602100001",
    "status": 2,
    "status_name": "å·²å–æ¶ˆ"
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
- åªèƒ½å–æ¶ˆå¾…æ”¯ä»˜è®¢å•ï¼ˆ`pay_status = 0`ï¼‰
- å·²æ”¯ä»˜ã€å·²å–æ¶ˆã€å·²å…³é—­çš„è®¢å•ä¸èƒ½å–æ¶ˆ

---

### 6. getMallGoods - å•†åŸå•†å“åˆ—è¡¨

**Action**: `getMallGoods`
**æƒé™**: éœ€è¦ç™»å½•

**è¯´æ˜**: æŸ¥è¯¢å•†åŸå¯å…‘æ¢å•†å“åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getMallGoods",
  "keyword": "åˆæ¢ç­",  // å¯é€‰ï¼Œå…³é”®è¯æœç´¢
  "page": 1,           // å¯é€‰ï¼Œé¡µç ï¼Œé»˜è®¤1
  "page_size": 10      // å¯é€‰ï¼Œæ¯é¡µæ•°é‡ï¼Œé»˜è®¤10
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 10,
    "page": 1,
    "page_size": 10,
    "list": [
      {
        "id": 1,
        "goods_name": "åˆæ¢ç­åé¢åˆ¸",
        "goods_image": "https://example.com/image.jpg",
        "merit_points_price": 1688.00,
        "stock_quantity": 50,
        "sold_quantity": 20,
        "description": "å•†å“æè¿°",
        "is_unlimited_stock": false,
        "can_exchange": true
      }
    ]
  }
}
```

**å­—æ®µè¯´æ˜**:
- `stock_quantity = -1`: æ— é™åº“å­˜
- `is_unlimited_stock`: æ˜¯å¦æ— é™åº“å­˜
- `can_exchange`: æ˜¯å¦å¯å…‘æ¢ï¼ˆæœ‰åº“å­˜æˆ–æ— é™åº“å­˜ï¼‰

---

### 7. exchangeGoods - åŠŸå¾·åˆ†å…‘æ¢å•†å“

**Action**: `exchangeGoods`
**æƒé™**: éœ€è¦ç™»å½•
**èµ„æ–™æ£€æŸ¥**: âœ… éœ€è¦å®Œå–„èµ„æ–™

**è¯´æ˜**: ä½¿ç”¨åŠŸå¾·åˆ†ï¼ˆ+ç§¯åˆ†ï¼‰å…‘æ¢å•†å“ï¼Œç›´æ¥å®Œæˆæ‰£é™¤

**é‡è¦è¯´æ˜**:
- ä¸èµ°æ”¯ä»˜æ¥å£ï¼Œåœ¨å•†åŸé¡µé¢ç›´æ¥å®Œæˆ
- ä¸åˆ›å»º orders è¡¨è®°å½•
- ç›´æ¥æ‰£é™¤åŠŸå¾·åˆ†/ç§¯åˆ†å¹¶åˆ›å»ºå…‘æ¢è®°å½•

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "exchangeGoods",
  "goods_id": 1,                          // å¿…å¡«ï¼Œå•†å“ID
  "quantity": 1,                          // å¯é€‰ï¼Œæ•°é‡ï¼Œé»˜è®¤1
  "use_cash_points_if_not_enough": true   // å¯é€‰ï¼ŒåŠŸå¾·åˆ†ä¸è¶³æ—¶æ˜¯å¦ä½¿ç”¨ç§¯åˆ†è¡¥å……ï¼Œé»˜è®¤false
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "å…‘æ¢æˆåŠŸ",
  "data": {
    "exchange_no": "EX202602100001",
    "goods_name": "åˆæ¢ç­åé¢åˆ¸",
    "quantity": 1,
    "merit_points_used": 1500.00,
    "cash_points_used": 188.00,
    "total_cost": 1688.00,
    "status": "å…‘æ¢æˆåŠŸ",
    "pickup_info": "è¯·å‡­å…‘æ¢å•å·åˆ°å‰å°é¢†å–"
  }
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å®Œå–„
2. éªŒè¯å•†å“å­˜åœ¨ä¸”ä¸Šæ¶
3. æ£€æŸ¥åº“å­˜å……è¶³
4. è®¡ç®—æ··åˆæ”¯ä»˜ï¼š
   - åŠŸå¾·åˆ†è¶³å¤Ÿï¼šå…¨éƒ¨ä½¿ç”¨åŠŸå¾·åˆ†
   - åŠŸå¾·åˆ†ä¸è¶³ä¸”å…è®¸è¡¥å……ï¼šä½¿ç”¨åŠŸå¾·åˆ† + ç§¯åˆ†
   - åŠŸå¾·åˆ†ä¸è¶³ä¸”ä¸å…è®¸è¡¥å……ï¼šè¿”å›é”™è¯¯
5. äº‹åŠ¡å¤„ç†ï¼š
   - æ‰£é™¤åŠŸå¾·åˆ†å’Œç§¯åˆ†
   - æ›´æ–°å•†å“åº“å­˜
   - åˆ›å»ºå…‘æ¢è®°å½•
   - æ’å…¥åŠŸå¾·åˆ†/ç§¯åˆ†æ˜ç»†è®°å½•

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "code": 400,
  "message": "ç°é‡‘ç§¯åˆ†ä¸è¶³ï¼Œè¿˜éœ€ 188 ç§¯åˆ†"
}
```

---

### 8. getExchangeRecords - å…‘æ¢è®°å½•åˆ—è¡¨

**Action**: `getExchangeRecords`
**æƒé™**: éœ€è¦ç™»å½•

**è¯´æ˜**: æŸ¥è¯¢ç”¨æˆ·çš„åŠŸå¾·åˆ†å…‘æ¢è®°å½•

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getExchangeRecords",
  "status": 1,        // å¯é€‰ï¼ŒçŠ¶æ€ç­›é€‰ï¼ˆ1å·²å…‘æ¢/2å·²é¢†å–/3å·²å–æ¶ˆï¼‰
  "page": 1,          // å¯é€‰ï¼Œé¡µç ï¼Œé»˜è®¤1
  "page_size": 10     // å¯é€‰ï¼Œæ¯é¡µæ•°é‡ï¼Œé»˜è®¤10
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 5,
    "page": 1,
    "page_size": 10,
    "list": [
      {
        "exchange_no": "EX202602100001",
        "goods_name": "åˆæ¢ç­åé¢åˆ¸",
        "quantity": 1,
        "merit_points_used": 1500.00,
        "cash_points_used": 188.00,
        "total_cost": 1688.00,
        "status": 1,
        "status_name": "å·²å…‘æ¢",
        "created_at": "2026-02-10 10:00:00"
      }
    ]
  }
}
```

**å…‘æ¢çŠ¶æ€è¯´æ˜**:
- `1`: å·²å…‘æ¢
- `2`: å·²é¢†å–
- `3`: å·²å–æ¶ˆ

---

## ç®¡ç†ç«¯æ¥å£

### 1. getOrderList - è®¢å•åˆ—è¡¨ï¼ˆç®¡ç†ç«¯ï¼‰

**Action**: `getOrderList`
**æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯´æ˜**: ç®¡ç†å‘˜æŸ¥è¯¢æ‰€æœ‰è®¢å•åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getOrderList",
  "pay_status": 1,              // å¯é€‰ï¼Œæ”¯ä»˜çŠ¶æ€ç­›é€‰
  "start_date": "2026-02-01",   // å¯é€‰ï¼Œå¼€å§‹æ—¥æœŸ
  "end_date": "2026-02-28",     // å¯é€‰ï¼Œç»“æŸæ—¥æœŸ
  "keyword": "å¼ ä¸‰",             // å¯é€‰ï¼Œå…³é”®è¯ï¼ˆç”¨æˆ·å§“å/æ‰‹æœºå·/è®¢å•å·ï¼‰
  "page": 1,                    // å¯é€‰ï¼Œé¡µç ï¼Œé»˜è®¤1
  "page_size": 20               // å¯é€‰ï¼Œæ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "list": [
      {
        "order_no": "ORD202602100001",
        "user_name": "å¼ ä¸‰",
        "user_phone": "138****8000",
        "order_type": 1,
        "order_name": "åˆæ¢ç­",
        "final_amount": 1688.00,
        "pay_status": 1,
        "pay_status_name": "å·²æ”¯ä»˜",
        "pay_time": "2026-02-10 10:30:00",
        "referee_name": "æ¨èäºº",
        "is_reward_granted": true,
        "created_at": "2026-02-10 10:00:00"
      }
    ]
  }
}
```

---

### 2. getOrderDetail - è®¢å•è¯¦æƒ…ï¼ˆç®¡ç†ç«¯ï¼‰

**Action**: `getOrderDetail`
**æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯´æ˜**: ç®¡ç†å‘˜æŸ¥è¯¢è®¢å•è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "getOrderDetail",
  "order_no": "ORD202602100001"  // å¿…å¡«ï¼Œè®¢å•å·
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "order_no": "ORD202602100001",
    "user_id": 1,
    "user_name": "å¼ ä¸‰",
    "user_phone": "13800138000",
    "order_type": 1,
    "order_name": "åˆæ¢ç­",
    "original_amount": 1688.00,
    "final_amount": 1688.00,
    "pay_status": 1,
    "pay_status_name": "å·²æ”¯ä»˜",
    "pay_time": "2026-02-10 10:30:00",
    "pay_method": "å¾®ä¿¡æ”¯ä»˜",
    "transaction_id": "wx_trans_id",
    "prepay_id": "prepay_id",
    "is_reward_granted": true,
    "reward_granted_at": "2026-02-10 10:31:00",
    "cancel_reason": null,
    "cancel_time": null,
    "refund_reason": null,
    "refund_time": null,
    "created_at": "2026-02-10 10:00:00",
    "expires_at": "2026-02-10 10:30:00",
    "order_metadata": null,
    "referee_id": 100,
    "referee_uid": "cloud-uid-100",
    "referee_name": "æ¨èäººå§“å",
    "referee_phone": "13900139000",
    "referee_level": 2,
    "course_id": 1,
    "course_name": "åˆæ¢ç­",
    "course_type": 1
  }
}
```

---

### 3. refund - è®¢å•é€€æ¬¾

**Action**: `refund`
**æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™
**çŠ¶æ€**: âš ï¸ åŠŸèƒ½å¼€å‘ä¸­

**è¯´æ˜**: ç®¡ç†å‘˜æ‰§è¡Œè®¢å•é€€æ¬¾

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "refund",
  "order_no": "ORD202602100001",  // å¿…å¡«ï¼Œè®¢å•å·
  "refund_reason": "ç”¨æˆ·ç”³è¯·é€€æ¬¾"  // å¿…å¡«ï¼Œé€€æ¬¾åŸå› 
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 0,
  "message": "é€€æ¬¾åŠŸèƒ½å¼€å‘ä¸­",
  "data": {
    "status": "developing",
    "message": "é€€æ¬¾åŠŸèƒ½å¼€å‘ä¸­ï¼Œå¾…é…ç½®å•†æˆ·ä¿¡æ¯åå¯ç”¨",
    "order_no": "ORD202602100001",
    "refund_amount": 1688.00
  }
}
```

**æ³¨æ„**: å¾…é…ç½®å¾®ä¿¡å•†æˆ·ä¿¡æ¯åå¯ç”¨

---

### 4. withdrawAudit - æç°å®¡æ ¸

**Action**: `withdrawAudit`
**æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯´æ˜**: ç®¡ç†å‘˜å®¡æ ¸ç”¨æˆ·æç°ç”³è¯·

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "withdrawAudit",
  "withdrawal_id": 1,                // å¿…å¡«ï¼Œæç°è®°å½•ID
  "status": 1,                       // å¿…å¡«ï¼Œå®¡æ ¸ç»“æœï¼ˆ1é€šè¿‡/2æ‹’ç»ï¼‰
  "reject_reason": "ä¿¡æ¯ä¸å®Œæ•´"       // å¯é€‰ï¼Œæ‹’ç»åŸå› ï¼ˆstatus=2æ—¶å¿…å¡«ï¼‰
}
```

**å“åº”æ•°æ®ï¼ˆå®¡æ ¸é€šè¿‡ï¼‰**:
```json
{
  "code": 0,
  "message": "å®¡æ ¸é€šè¿‡",
  "data": {
    "withdrawal_id": 1,
    "status": 1,
    "status_name": "å®¡æ ¸é€šè¿‡"
  }
}
```

**å“åº”æ•°æ®ï¼ˆå®¡æ ¸æ‹’ç»ï¼‰**:
```json
{
  "code": 0,
  "message": "å®¡æ ¸æ‹’ç»",
  "data": {
    "withdrawal_id": 1,
    "status": 2,
    "status_name": "å®¡æ ¸æ‹’ç»",
    "reject_reason": "ä¿¡æ¯ä¸å®Œæ•´"
  }
}
```

**ä¸šåŠ¡é€»è¾‘**:
- **å®¡æ ¸é€šè¿‡**ï¼šæ‰£é™¤å†»ç»“ç§¯åˆ†ï¼Œè®°å½•ç§¯åˆ†å˜åŠ¨
- **å®¡æ ¸æ‹’ç»**ï¼šè§£å†»ç§¯åˆ†é€€å›åˆ°å¯ç”¨ç§¯åˆ†ï¼Œè®°å½•ç§¯åˆ†å˜åŠ¨

---

## ğŸ“Š æ•°æ®åº“è¡¨å…³ç³»

### ä¸»è¦æ“ä½œè¡¨
- `orders` - è®¢å•è¡¨
- `courses` - è¯¾ç¨‹è¡¨
- `user_courses` - ç”¨æˆ·è¯¾ç¨‹è¡¨
- `mall_goods` - å•†åŸå•†å“è¡¨
- `mall_exchange_records` - å…‘æ¢è®°å½•è¡¨
- `merit_points_records` - åŠŸå¾·åˆ†æ˜ç»†è¡¨
- `cash_points_records` - ç§¯åˆ†æ˜ç»†è¡¨
- `withdrawals` - æç°è®°å½•è¡¨
- `class_records` - ä¸Šè¯¾è®°å½•è¡¨
- `appointments` - é¢„çº¦è®°å½•è¡¨
- `ambassador_level_configs` - å¤§ä½¿ç­‰çº§é…ç½®è¡¨
- `ambassador_quotas` - å¤§ä½¿åé¢è¡¨

---

## ğŸ”§ æŠ€æœ¯è§„èŒƒ

### 1. æ•°æ®åº“è¿æ¥
ä½¿ç”¨ CloudBase SDK `rdb()` æ–¹æ³•è¿æ¥æ•°æ®åº“ï¼Œæ— éœ€é…ç½®ç¯å¢ƒå˜é‡ã€‚

### 2. å­—æ®µæ˜ å°„
- âœ… ä½¿ç”¨ `referee_code`ï¼ˆä¸æ˜¯ referral_codeï¼‰
- âœ… ä½¿ç”¨ `cash_points_available`ï¼ˆä¸æ˜¯ cash_pointsï¼‰
- âœ… ä½¿ç”¨ `cash_points_frozen`ï¼ˆä¸æ˜¯ frozen_cash_pointsï¼‰

### 3. å“åº”æ ¼å¼
ç»Ÿä¸€ä½¿ç”¨ `response.success()` å’Œ `response.error()` è¿”å›æ•°æ®ã€‚

### 4. é”™è¯¯å¤„ç†
æ‰€æœ‰æ¥å£éƒ½åŒ…å«å®Œæ•´çš„ try-catch é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ”¯ä»˜åŠŸèƒ½
ä»¥ä¸‹æ¥å£æš‚æ—¶è¿”å›"åŠŸèƒ½å¼€å‘ä¸­"ï¼Œå¾…é…ç½®å¾®ä¿¡å•†æˆ·ä¿¡æ¯åå¯ç”¨ï¼š
- `createPayment` - å‘èµ·æ”¯ä»˜
- `paymentCallback` - æ”¯ä»˜å›è°ƒ
- `refund` - è®¢å•é€€æ¬¾

### 2. èµ„æ–™å®Œå–„æ£€æŸ¥
ä»¥ä¸‹æ¥å£éœ€è¦æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å®Œå–„ï¼ˆ`profile_completed = 1`ï¼‰ï¼š
- `create` - åˆ›å»ºè®¢å•
- `exchangeGoods` - åŠŸå¾·åˆ†å…‘æ¢å•†å“

æœªå®Œå–„èµ„æ–™æ—¶è¿”å› 403 é”™è¯¯ï¼Œå¼•å¯¼ç”¨æˆ·å®Œå–„èµ„æ–™ã€‚

### 3. è®¢å•è¿‡æœŸæ—¶é—´
åˆ›å»ºè®¢å•åï¼Œè®¢å•æœ‰æ•ˆæœŸä¸º 30 åˆ†é’Ÿï¼Œè¶…æ—¶åè®¢å•çŠ¶æ€è‡ªåŠ¨å˜ä¸º"å·²å…³é—­"ã€‚

### 4. æ··åˆæ”¯ä»˜
åŠŸå¾·åˆ†å…‘æ¢å•†å“æ”¯æŒæ··åˆæ”¯ä»˜ï¼š
- åŠŸå¾·åˆ†è¶³å¤Ÿï¼šå…¨éƒ¨ä½¿ç”¨åŠŸå¾·åˆ†
- åŠŸå¾·åˆ†ä¸è¶³ï¼šå¯é€‰æ‹©ä½¿ç”¨ç§¯åˆ†è¡¥å……ï¼ˆéœ€è®¾ç½® `use_cash_points_if_not_enough = true`ï¼‰

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### V1.0 (2026-02-10)
- âœ… å®Œæˆ 13 ä¸ªæ¥å£å¼€å‘
- âœ… éµå¾ªäº‘å‡½æ•°æ ‡å‡†éƒ¨ç½²è§„èŒƒ V2.0
- âœ… ä½¿ç”¨ CloudBase SDK rdb() è¿æ¥æ•°æ®åº“
- âœ… ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåæ˜ å°„
- âš ï¸ æ”¯ä»˜åŠŸèƒ½æš‚æ—¶è¿”å›"åŠŸèƒ½å¼€å‘ä¸­"

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2026-02-10
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
**è”ç³»æ–¹å¼**: å‚è€ƒé¡¹ç›®æ–‡æ¡£
