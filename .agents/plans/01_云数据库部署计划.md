# å¤©é“æ–‡åŒ–å°ç¨‹åº - äº‘æ•°æ®åº“éƒ¨ç½²è®¡åˆ’

> **ç‰ˆæœ¬**: V1.0
> **åˆ›å»ºæ—¶é—´**: 2026-02-04
> **çŠ¶æ€**: å¾…æ‰§è¡Œ

---

## ğŸ“‹ è®¡åˆ’æ¦‚è¿°

**ç›®æ ‡**: éƒ¨ç½² CloudBase MySQL æ•°æ®åº“ï¼ˆ28å¼ è¡¨ï¼‰

**ç¯å¢ƒä¿¡æ¯**:
- CloudBase ç¯å¢ƒ ID: `cloud1-0gnn3mn17b581124`
- MySQL å®ä¾‹: `tnt-e300s320g`
- åŒºåŸŸ: `ap-shanghai`
- æ•°æ®åº“åç§°: `tiandao_culture`
- å­—ç¬¦é›†: `utf8mb4`
- æ’åºè§„åˆ™: `utf8mb4_unicode_ci`

**éƒ¨ç½²æ–¹å¼**: é€šè¿‡ Node.js è„šæœ¬ä½¿ç”¨ CloudBase SDK æ‰§è¡Œ SQLï¼ˆå›  CloudBase MCP ä¸å…¼å®¹ Claude Codeï¼‰

---

## ğŸ¯ å®æ–½æ­¥éª¤

### æ­¥éª¤ä¸€ï¼šåˆ›å»ºéƒ¨ç½²è„šæœ¬

**æ–‡ä»¶ä½ç½®**: `D:\project\cursor\work\xcx\scripts\deploy-database.js`

**è„šæœ¬åŠŸèƒ½**:
1. è¿æ¥ CloudBase MySQL æ•°æ®åº“
2. åˆ›å»ºæ•°æ®åº“ `tiandao_culture`
3. æŒ‰é¡ºåºæ‰§è¡Œå»ºè¡¨ SQL
4. éªŒè¯è¡¨åˆ›å»ºç»“æœ
5. è¾“å‡ºéƒ¨ç½²æŠ¥å‘Š

**ä¾èµ–å®‰è£…**:
```bash
cd D:\project\cursor\work\xcx
npm init -y
npm install @cloudbase/node-sdk mysql2
```

### æ­¥éª¤äºŒï¼šæå–å»ºè¡¨ SQL

ä» `docs/database/` å„æ¨¡å—æ–‡æ¡£çš„ "2. è¡¨ç»“æ„" ç« èŠ‚æå– CREATE TABLE è¯­å¥ã€‚

**å»ºè¡¨é¡ºåºï¼ˆæŒ‰ä¾èµ–å…³ç³»ï¼‰**:

| é¡ºåº | æ¨¡å—æ–‡æ¡£ | è¡¨å | è¡¨æ•°é‡ |
|-----|---------|------|-------|
| 1 | 01_ç”¨æˆ·æ¨¡å—.md | users, referee_change_logs | 2 |
| 2 | 02_è¯¾ç¨‹æ¨¡å—.md | courses, user_courses | 2 |
| 3 | 03_è®¢å•æ¨¡å—.md | orders | 1 |
| 4 | 04_é¢„çº¦æ¨¡å—.md | class_records, appointments | 2 |
| 5 | 05_å¤§ä½¿æ¨¡å—.md | ambassador_applications, ambassador_quotas, quota_usage_records, merit_points_records, cash_points_records, withdrawals, ambassador_upgrade_logs | 7 |
| 6 | 06_å•†å­¦é™¢å•†åŸæ¨¡å—.md | academy_intro, academy_materials, academy_cases, mall_goods, mall_exchange_records | 5 |
| 7 | 07_åè®®æ¨¡å—.md | contract_templates, contract_signatures | 2 |
| 8 | 08_åé¦ˆæ¶ˆæ¯æ¨¡å—.md | feedbacks, notification_configs, notification_logs | 3 |
| 9 | 09_åå°ç®¡ç†æ¨¡å—.md | admin_users, admin_operation_logs, system_configs, announcements | 4 |

**æ€»è®¡: 28 å¼ è¡¨**

### æ­¥éª¤ä¸‰ï¼šé¦–æ¬¡éªŒè¯éƒ¨ç½²ï¼ˆç”¨æˆ·æ¨¡å—ï¼‰

**ç›®çš„**: å…ˆéƒ¨ç½²ç¬¬ä¸€ä¸ªæ¨¡å—ï¼ˆç”¨æˆ·æ¨¡å—ï¼‰çš„è¡¨ï¼ŒéªŒè¯éƒ¨ç½²æµç¨‹å’Œè„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆä»…éƒ¨ç½²ç”¨æˆ·æ¨¡å—ï¼‰
node scripts/deploy-database.js --module=users
```

**é¦–æ¬¡éªŒè¯ SQL**:
```sql
-- 1. æ£€æŸ¥ç”¨æˆ·æ¨¡å—è¡¨æ•°é‡ï¼ˆåº”ä¸º 2ï¼‰
SELECT COUNT(*) as table_count
FROM information_schema.tables
WHERE table_schema = 'tiandao_culture';

-- 2. åˆ—å‡ºå·²åˆ›å»ºçš„è¡¨
SHOW TABLES;

-- 3. æ£€æŸ¥ users è¡¨ç»“æ„
DESCRIBE users;

-- 4. æ£€æŸ¥ referee_change_logs è¡¨ç»“æ„
DESCRIBE referee_change_logs;

-- 5. éªŒè¯å­—ç¬¦é›†
SELECT table_name, table_collation
FROM information_schema.tables
WHERE table_schema = 'tiandao_culture';

-- 6. éªŒè¯ç´¢å¼•åˆ›å»º
SHOW INDEX FROM users;
SHOW INDEX FROM referee_change_logs;
```

**éªŒè¯é€šè¿‡æ ‡å‡†**:
- [ ] 2 å¼ è¡¨ï¼ˆusers, referee_change_logsï¼‰åˆ›å»ºæˆåŠŸ
- [ ] users è¡¨æœ‰ `_openid` å­—æ®µ
- [ ] å­—ç¬¦é›†ä¸º utf8mb4_unicode_ci
- [ ] ç´¢å¼•åˆ›å»ºæ­£ç¡®

> âš ï¸ **é‡è¦**: åªæœ‰é¦–æ¬¡éªŒè¯å…¨éƒ¨é€šè¿‡åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œæ­¥éª¤å››éƒ¨ç½²å‰©ä½™æ¨¡å—ã€‚

---

### æ­¥éª¤å››ï¼šéƒ¨ç½²å‰©ä½™æ¨¡å—

**å‰ææ¡ä»¶**: æ­¥éª¤ä¸‰é¦–æ¬¡éªŒè¯å·²é€šè¿‡ âœ…

```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆéƒ¨ç½²å‰©ä½™æ‰€æœ‰æ¨¡å—ï¼‰
node scripts/deploy-database.js --module=remaining
```

**éƒ¨ç½²é¡ºåº**:
| é¡ºåº | æ¨¡å— | è¡¨æ•°é‡ |
|-----|------|-------|
| 2 | è¯¾ç¨‹æ¨¡å— | 2 |
| 3 | è®¢å•æ¨¡å— | 1 |
| 4 | é¢„çº¦æ¨¡å— | 2 |
| 5 | å¤§ä½¿æ¨¡å— | 7 |
| 6 | å•†å­¦é™¢å•†åŸæ¨¡å— | 5 |
| 7 | åè®®æ¨¡å— | 2 |
| 8 | åé¦ˆæ¶ˆæ¯æ¨¡å— | 3 |
| 9 | åå°ç®¡ç†æ¨¡å— | 4 |

---

### æ­¥éª¤äº”ï¼šå®Œæ•´éªŒè¯éƒ¨ç½²ç»“æœ

**éªŒè¯ SQL**:
```sql
-- 1. æ£€æŸ¥è¡¨æ•°é‡ï¼ˆåº”ä¸º 28ï¼‰
SELECT COUNT(*) as table_count
FROM information_schema.tables
WHERE table_schema = 'tiandao_culture';

-- 2. åˆ—å‡ºæ‰€æœ‰è¡¨
SHOW TABLES;

-- 3. æ£€æŸ¥å…³é”®è¡¨ç»“æ„
DESCRIBE users;
DESCRIBE courses;
DESCRIBE orders;

-- 4. æ£€æŸ¥ _openid å­—æ®µï¼ˆåº”æœ‰ 15 å¼ è¡¨ï¼‰
SELECT table_name
FROM information_schema.columns
WHERE table_schema = 'tiandao_culture'
  AND column_name = '_openid'
ORDER BY table_name;
```

### æ­¥éª¤å…­ï¼šé…ç½®å®‰å…¨è§„åˆ™

**è§„åˆ™**: æ‰€æœ‰ 28 å¼ è¡¨ç»Ÿä¸€è®¾ä¸º `ADMINONLY`

**é…ç½®æ–¹å¼**: åœ¨ CloudBase æ§åˆ¶å°æ‰‹åŠ¨é…ç½®ï¼Œæˆ–é€šè¿‡è„šæœ¬æ‰¹é‡è®¾ç½®

**è¡¨æ¸…å•**:
```javascript
const tables = [
  // ç”¨æˆ·æ¨¡å—ï¼ˆ2å¼ è¡¨ï¼‰
  'users', 'referee_change_logs',
  // è¯¾ç¨‹æ¨¡å—ï¼ˆ2å¼ è¡¨ï¼‰
  'courses', 'user_courses',
  // è®¢å•æ¨¡å—ï¼ˆ1å¼ è¡¨ï¼‰
  'orders',
  // é¢„çº¦æ¨¡å—ï¼ˆ2å¼ è¡¨ï¼‰
  'class_records', 'appointments',
  // å¤§ä½¿æ¨¡å—ï¼ˆ7å¼ è¡¨ï¼‰
  'ambassador_applications', 'ambassador_quotas', 'quota_usage_records',
  'merit_points_records', 'cash_points_records', 'withdrawals', 'ambassador_upgrade_logs',
  // å•†å­¦é™¢/å•†åŸæ¨¡å—ï¼ˆ5å¼ è¡¨ï¼‰
  'academy_intro', 'academy_materials', 'academy_cases',
  'mall_goods', 'mall_exchange_records',
  // åè®®æ¨¡å—ï¼ˆ2å¼ è¡¨ï¼‰
  'contract_templates', 'contract_signatures',
  // åé¦ˆ/æ¶ˆæ¯æ¨¡å—ï¼ˆ3å¼ è¡¨ï¼‰
  'feedbacks', 'notification_configs', 'notification_logs',
  // åå°ç®¡ç†æ¨¡å—ï¼ˆ4å¼ è¡¨ï¼‰
  'admin_users', 'admin_operation_logs', 'system_configs', 'announcements'
];
```

### æ­¥éª¤ä¸ƒï¼šæ’å…¥åˆå§‹æ•°æ®

**åˆå§‹æ•°æ®å†…å®¹**:

```sql
-- ç³»ç»Ÿé…ç½®
INSERT INTO system_configs (config_key, config_value, description) VALUES
('points_to_cash_ratio', '100', 'ç§¯åˆ†å…‘æ¢ç°é‡‘æ¯”ä¾‹ï¼š100ç§¯åˆ†=1å…ƒ'),
('retrain_price_ratio', '0.3', 'å¤è®­ä»·æ ¼æ¯”ä¾‹ï¼šè¯¾ç¨‹åŸä»·çš„30%'),
('merit_points_ratio', '0.1', 'åŠŸå¾·åˆ†æ¯”ä¾‹ï¼šè®¢å•é‡‘é¢çš„10%');

-- è¯¾ç¨‹æ•°æ®
INSERT INTO courses (name, type, current_price, original_price, retrain_price, description, status) VALUES
('åˆæ¢ç­', 1, 1688.00, 1688.00, 500.00, 'å¤©é“æ–‡åŒ–åˆæ¢ç­è¯¾ç¨‹', 1),
('å¯†è®­ç­', 2, 38888.00, 38888.00, 11666.00, 'å¤©é“æ–‡åŒ–å¯†è®­ç­è¯¾ç¨‹', 1);

-- ç®¡ç†å‘˜è´¦å·ï¼ˆå¯é€‰ï¼‰
INSERT INTO admin_users (username, password_hash, real_name, role, status) VALUES
('admin', 'hashed_password_here', 'ç³»ç»Ÿç®¡ç†å‘˜', 'super_admin', 1);
```

---

## ğŸ“ éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `scripts/deploy-database.js` | æ•°æ®åº“éƒ¨ç½²è„šæœ¬ |
| `scripts/init-data.js` | åˆå§‹æ•°æ®æ’å…¥è„šæœ¬ï¼ˆå¯é€‰ï¼‰ |
| `scripts/verify-database.js` | æ•°æ®åº“éªŒè¯è„šæœ¬ï¼ˆå¯é€‰ï¼‰ |

---

## ğŸ“ éœ€è¦è¯»å–çš„æ–‡ä»¶ï¼ˆSQL æ¥æºï¼‰

| æ–‡ä»¶è·¯å¾„ | æå–å†…å®¹ |
|---------|---------|
| `docs/database/01_ç”¨æˆ·æ¨¡å—.md` | users, referee_change_logs å»ºè¡¨ SQL |
| `docs/database/02_è¯¾ç¨‹æ¨¡å—.md` | courses, user_courses å»ºè¡¨ SQL |
| `docs/database/03_è®¢å•æ¨¡å—.md` | orders å»ºè¡¨ SQL |
| `docs/database/04_é¢„çº¦æ¨¡å—.md` | class_records, appointments å»ºè¡¨ SQL |
| `docs/database/05_å¤§ä½¿æ¨¡å—.md` | 7å¼ è¡¨å»ºè¡¨ SQL |
| `docs/database/06_å•†å­¦é™¢å•†åŸæ¨¡å—.md` | 5å¼ è¡¨å»ºè¡¨ SQL |
| `docs/database/07_åè®®æ¨¡å—.md` | contract_templates, contract_signatures å»ºè¡¨ SQL |
| `docs/database/08_åé¦ˆæ¶ˆæ¯æ¨¡å—.md` | feedbacks, notification_configs, notification_logs å»ºè¡¨ SQL |
| `docs/database/09_åå°ç®¡ç†æ¨¡å—.md` | 4å¼ è¡¨å»ºè¡¨ SQL |

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] CloudBase ç¯å¢ƒå·²ç™»å½•
- [ ] MySQL å®ä¾‹å·²å¯ç”¨
- [ ] Node.js ç¯å¢ƒå·²å®‰è£…
- [ ] ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆ@cloudbase/node-sdk, mysql2ï¼‰

### éƒ¨ç½²åéªŒè¯
- [ ] æ•°æ®åº“ `tiandao_culture` å·²åˆ›å»º
- [ ] 28 å¼ è¡¨å…¨éƒ¨åˆ›å»ºæˆåŠŸ
- [ ] 15 å¼ ç”¨æˆ·æ•°æ®è¡¨æœ‰ `_openid` å­—æ®µ
- [ ] æ‰€æœ‰ç´¢å¼•åˆ›å»ºæˆåŠŸ
- [ ] å­—ç¬¦é›†ä¸º utf8mb4
- [ ] å®‰å…¨è§„åˆ™å·²é…ç½®ä¸º ADMINONLY
- [ ] åˆå§‹æ•°æ®å·²æ’å…¥

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../docs/database/README.md)
- [éƒ¨ç½²æ£€æŸ¥æ¸…å•](../docs/database/DEPLOYMENT_CHECKLIST.md)
- [åç«¯APIæ¥å£æ–‡æ¡£](../åç«¯APIæ¥å£æ–‡æ¡£.md)
-[æ•°æ®åº“sdkæ–‡æ¡£](../../docs/database/SDK_GUIDE.md)
-[å¿«é€Ÿå‚è€ƒå¡](../../docs/database/QUICK_REFERENCE.md)
---

## ğŸ“ æ‰§è¡Œè®°å½•

| æ­¥éª¤ | çŠ¶æ€ | æ‰§è¡Œæ—¶é—´ | å¤‡æ³¨ |
|-----|------|---------|------|
| æ­¥éª¤ä¸€ï¼šåˆ›å»ºéƒ¨ç½²è„šæœ¬ | â³ å¾…æ‰§è¡Œ | | |
| æ­¥éª¤äºŒï¼šæå–å»ºè¡¨ SQL | â³ å¾…æ‰§è¡Œ | | |
| æ­¥éª¤ä¸‰ï¼šé¦–æ¬¡éªŒè¯éƒ¨ç½²ï¼ˆç”¨æˆ·æ¨¡å—ï¼‰ | â³ å¾…æ‰§è¡Œ | | å…ˆéƒ¨ç½²ç”¨æˆ·æ¨¡å—éªŒè¯æµç¨‹ |
| æ­¥éª¤å››ï¼šéƒ¨ç½²å‰©ä½™æ¨¡å— | â³ å¾…æ‰§è¡Œ | | é¦–æ¬¡éªŒè¯é€šè¿‡åæ‰§è¡Œ |
| æ­¥éª¤äº”ï¼šå®Œæ•´éªŒè¯éƒ¨ç½²ç»“æœ | â³ å¾…æ‰§è¡Œ | | |
| æ­¥éª¤å…­ï¼šé…ç½®å®‰å…¨è§„åˆ™ | â³ å¾…æ‰§è¡Œ | | |
| æ­¥éª¤ä¸ƒï¼šæ’å…¥åˆå§‹æ•°æ® | â³ å¾…æ‰§è¡Œ | | |
