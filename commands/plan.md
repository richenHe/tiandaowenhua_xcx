---
description: 通过深度分析创建全面的功能实施计划
---

# /plan - 规划功能

## 命令说明

通过深度分析创建全面的功能实施计划。此命令在功能开发前运行，收集所有必要信息，为 `/execute` 命令提供一次成功所需的所有上下文。

## 核心原则

- **上下文为王**：充分理解功能和代码库后再行动
- **此阶段不写代码**：专注于分析和规划，不实现功能
- **信息完整性**：为执行代理提供一次成功所需的所有信息

## 适用场景

- 新功能开发前的深度规划
- 复杂功能需要全面了解上下文
- 需要系统性分析依赖和集成点
- 确保执行阶段无需额外研究

## 工作流程

### 第一阶段 - 功能理解

深入理解待开发功能：

- **提取核心问题**：明确功能要解决的根本问题
- **识别用户价值**：确定功能为用户带来的价值
- **评估复杂度**：评估实现难度和技术挑战
- **创建用户故事**：编写清晰的用户故事和验收标准

用户故事模板：
```markdown
**作为** [用户角色]
**我希望** [功能/行为]
**以便** [价值/收益]

**验收标准：**
1. [可验证的条件]
2. [可验证的条件]
3. [可验证的条件]
```

### 第二阶段 - 代码库智能收集

系统分析现有代码库：

- **项目结构分析**：理解项目目录结构和组织方式
- **模式识别**：识别现有代码模式和最佳实践
- **依赖项分析**：分析功能涉及的依赖关系
- **测试模式**：了解现有测试策略和框架
- **集成点映射**：识别功能需要集成的组件和接口

### 第三阶段 - 外部研究

收集外部参考资料：

- **文档收集**：查阅相关技术文档和API参考
- **最佳实践研究**：研究业界最佳实践和解决方案
- **编译参考资源**：整理可用的参考资源和示例

### 第四阶段 - 深度战略思考

进行战略性规划：

- **架构适配**：确保实现方案与现有架构一致
- **设计决策**：做出关键设计决策并记录理由
- **风险评估**：识别潜在风险并制定缓解策略

### 第五阶段 - 计划生成

生成完整的实施计划：

#### 计划内容

1. **功能描述和用户故事**
   - 功能概述
   - 用户故事
   - 验收标准

2. **上下文引用**
   - 必读文件列表
   - 需要创建的新文件
   - 相关文档和资源

3. **要遵循的模式**
   - 代码风格和规范
   - 设计模式
   - 项目约定

4. **实施计划**
   - 准备阶段
   - 核心实现阶段
   - 测试阶段
   - 验证阶段

5. **逐步任务**
   - 原子化任务划分
   - 可测试的交付物
   - 任务依赖关系

6. **测试策略**
   - 单元测试范围
   - 集成测试场景
   - E2E 测试（如适用）

7. **验证命令**
   - 运行测试的命令
   - 代码检查命令
   - 构建验证命令

8. **验收标准**
   - 功能验收标准
   - 质量验收标准
   - 性能验收标准（如适用）

## 输出格式

计划文件输出到 `.agents/plans/[kebab-case-name].md`：

```markdown
# [功能名称] 实施计划

## 功能概述

[功能描述]

## 用户故事

[用户故事内容]

## 上下文引用

### 必读文件
- [文件路径]: [原因]

### 需要创建的文件
- [文件路径]: [用途]

### 参考资源
- [资源描述]: [链接/路径]

## 实施计划

### 阶段 1: [阶段名称]
- [任务描述]

### 阶段 2: [阶段名称]
- [任务描述]

...

## 逐步任务

- [ ] 1. [原子化任务]
- [ ] 2. [原子化任务]
- [ ] 3. [原子化任务]

## 验收标准

1. [标准1]
2. [标准2]
3. [标准3]

## 验证命令

```bash
# 测试命令
npm test

# 类型检查
npm run type-check

# 构建验证
npm run build
```

## 风险和缓解

| 风险 | 影响 | 缓解策略 |
|-----|-----|---------|
| [风险] | [影响] | [策略] |
```

## 质量标准

计划必须满足以下质量标准：

- ✅ **上下文完整性**：包含所有必要的上下文信息
- ✅ **实施就绪**：执行代理可以立即开始实施
- ✅ **模式一致性**：遵循项目现有的代码模式
- ✅ **信息密度**：信息充分但不冗余

## 成功指标

- 执行代理能够一次实现，无需额外研究
- 计划覆盖所有边界情况和异常处理
- 任务划分粒度适中，可独立测试

## 与 /execute 命令的衔接

```
/plan → .agents/plans/[name].md → /execute → 完成实施
```

### Plan 输出 → Execute 输入

| Plan 产出 | Execute 使用方式 |
|----------|----------------|
| 功能描述和用户故事 | 理解目标 |
| 逐步任务 | 按序执行 |
| 验收标准 | 验证完成 |
| 验证命令 | 执行验证 |
| 上下文引用 | 阅读理解 |

## 注意事项

- 不要跳过任何分析阶段
- 保持计划文档的完整性和可读性
- 确保任务划分原子化且可测试
- 明确记录设计决策的理由
- 预见可能的风险并提前规划应对
