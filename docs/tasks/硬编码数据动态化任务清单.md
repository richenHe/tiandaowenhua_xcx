# ç¡¬ç¼–ç æ•°æ®åŠ¨æ€åŒ–ä»»åŠ¡æ¸…å•

> åˆ›å»ºæ—¶é—´ï¼š2026-02-11
> çŠ¶æ€ï¼šå¾…å¼€å‘
> ä¼˜å…ˆçº§ï¼šé«˜

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

å°†å°ç¨‹åºä¸­çš„ç¡¬ç¼–ç æ•°æ®æ”¹ä¸ºä»åç«¯APIåŠ¨æ€è·å–ï¼Œæå‡æ•°æ®çš„å®æ—¶æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

---

## ğŸ¯ æ¶‰åŠé¡µé¢å’Œæ•°æ®

### 1. **å¤§ä½¿ç­‰çº§é¡µ** (`pages/ambassador/level/index.vue`)

#### éœ€è¦åŠ¨æ€åŒ–çš„æ•°æ®ï¼š

**ç¬¬15-20è¡Œï¼šå½“å‰ç­‰çº§å¡ç‰‡**
```vue
<!-- å½“å‰ç¡¬ç¼–ç  -->
<view>ğŸ¦ é’é¸¾å¤§ä½¿</view>
<view>å½“å‰ç­‰çº§ Â· å·²æ¨è2äºº</view>
<view>æˆä¸ºå¤§ä½¿æ—¶é—´</view>
<view>2024-01-15</view>
```

**éœ€è¦çš„æ•°æ®ï¼š**
- âœ… ç­‰çº§åç§°ï¼ˆä» `users.ambassador_level` æ˜ å°„ï¼‰
- âœ… æ¨èäººæ•°ï¼ˆæŸ¥è¯¢ `users` è¡¨ç»Ÿè®¡ `referee_id = å½“å‰ç”¨æˆ·ID`ï¼‰
- âœ… æˆä¸ºå¤§ä½¿æ—¶é—´ï¼ˆä» `users.ambassador_start_date` è·å–ï¼‰

**ç¬¬31ã€40è¡Œï¼šåŠŸå¾·åˆ†å’Œç§¯åˆ†**
```vue
<!-- å½“å‰ç¡¬ç¼–ç  -->
<view>1250.0</view> <!-- åŠŸå¾·åˆ† -->
<view>1250.0</view> <!-- å¯æç°ç§¯åˆ† -->
```

**éœ€è¦çš„æ•°æ®ï¼š**
- âœ… åŠŸå¾·åˆ†ï¼ˆä» `users.merit_points` è·å–ï¼‰
- âœ… å¯æç°ç§¯åˆ†ï¼ˆä» `users.cash_points_available` è·å–ï¼‰

**éœ€è¦çš„APIï¼š**
- `UserApi.getReferralStats()` - è·å–æ¨èç»Ÿè®¡ä¿¡æ¯

---

### 2. **é¢„çº¦ç¡®è®¤é¡µ** (`pages/course/appointment-confirm/index.vue`)

#### éœ€è¦åŠ¨æ€åŒ–çš„æ•°æ®ï¼š

**ç¬¬28è¡Œï¼šå®¢æœç”µè¯**
```vue
<!-- å½“å‰ç¡¬ç¼–ç  -->
<view>3. å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœï¼š400-123-4567</view>
```

**éœ€è¦çš„æ•°æ®ï¼š**
- âœ… å®¢æœç”µè¯ï¼ˆä» `system_configs` è¡¨è·å–ï¼‰

**éœ€è¦çš„APIï¼š**
- `SystemApi.getSystemConfig(key)` - è·å–ç³»ç»Ÿé…ç½®

**éœ€è¦çš„æ•°æ®åº“é…ç½®ï¼š**
```sql
INSERT INTO system_configs (config_key, config_value, config_type, config_group, config_name, config_desc, is_system, status)
VALUES (
  'customer_service_phone',
  '400-123-4567',
  'string',
  'contact',
  'å®¢æœç”µè¯',
  'å¹³å°å®¢æœè”ç³»ç”µè¯',
  1,
  1
)
ON DUPLICATE KEY UPDATE
  config_value = VALUES(config_value),
  updated_at = CURRENT_TIMESTAMP;
```

---

### 3. **ä¸ªäººä¸­å¿ƒé¡µ** (`pages/mine/index.vue`)

#### éœ€è¦åŠ¨æ€åŒ–çš„æ•°æ®ï¼š

**ç¬¬210-230è¡Œï¼šè®¾ç½®èœå•**
```javascript
// å½“å‰ç¡¬ç¼–ç 
const settingsMenu = computed(() => [
  {
    type: 'referral-list',
    icon: 'ğŸ‡',
    label: 'å¼•èäººåˆ—è¡¨',
    badge: '5äºº',  // ç¡¬ç¼–ç 
    badgeTheme: 'primary'
  },
  // ...
]);
```

**éœ€è¦çš„æ•°æ®ï¼š**
- âœ… å¼•èäººåˆ—è¡¨æ•°é‡ï¼ˆæŸ¥è¯¢ `users` è¡¨ç»Ÿè®¡ï¼‰

**éœ€è¦çš„APIï¼š**
- `UserApi.getReferralStats()` - è·å–æ¨èç»Ÿè®¡ä¿¡æ¯ï¼ˆä¸å¤§ä½¿ç­‰çº§é¡µå…±ç”¨ï¼‰

**ç¬¬233-237è¡Œï¼šå¸®åŠ©èœå•**
```javascript
// å½“å‰ç¡¬ç¼–ç 
const helpMenu = ref([
  { type: 'feedback', icon: 'ğŸ“', label: 'æ„è§åé¦ˆ' },
  { type: 'announcement', icon: 'ğŸ“¢', label: 'å¹³å°å…¬å‘Š', badge: '3', badgeTheme: 'error' }  // éœ€è¦åˆ é™¤å¾½ç« 
]);
```

**éœ€è¦ä¿®æ”¹ï¼š**
- âŒ åˆ é™¤å…¬å‘Šæ•°é‡å¾½ç« ï¼ˆç§»é™¤ `badge: '3'` å’Œ `badgeTheme: 'error'`ï¼‰

---

### 4. **æˆé•¿ç­‰çº§å¯è§†åŒ–ç³»ç»Ÿ**ï¼ˆæ–°åŠŸèƒ½ï¼‰

#### åŠŸèƒ½è¯´æ˜ï¼š

åœ¨ä¸ªäººä¸­å¿ƒé¡µç”¨æˆ·å¤´åƒæ—è¾¹æ˜¾ç¤ºæˆé•¿ç­‰çº§å›¾æ ‡ï¼Œæ ¹æ®ç´¯è®¡æ´»åŠ¨æ¬¡æ•°åŠ¨æ€å±•ç¤ºã€‚

#### ç­‰çº§è§„åˆ™ï¼š
- ğŸƒ **ç­‰çº§ä¸€ï¼šç»¿å¶** - æ–°ç”Ÿã€èµ·ç‚¹ï¼Œä»£è¡¨åˆçº§æˆå‘˜ï¼ˆ1-3æ¬¡æ´»åŠ¨ï¼‰
- ğŸŒ¸ **ç­‰çº§äºŒï¼šèŠ±æœµ** - ç»½æ”¾ã€æ´»è·ƒï¼Œä»£è¡¨è¿›é˜¶è´¡çŒ®ï¼ˆ4-15æ¬¡æ´»åŠ¨ï¼Œ4ä¸ªç»¿å¶ = 1ä¸ªèŠ±æœµï¼‰
- ğŸ **ç­‰çº§ä¸‰ï¼šæœå®** - æ²‰æ·€ã€ä»·å€¼ï¼Œä»£è¡¨æ ¸å¿ƒæˆå‘˜ï¼ˆ16-63æ¬¡æ´»åŠ¨ï¼Œ4ä¸ªèŠ±æœµ = 1ä¸ªæœå®ï¼‰
- ğŸŒ³ **ç­‰çº§å››ï¼šå¤§æ ‘** - æœ€é«˜ç­‰çº§ï¼ˆ64+æ¬¡æ´»åŠ¨ï¼Œ4ä¸ªæœå® = 1ä¸ªå¤§æ ‘ï¼‰

#### ç§¯åˆ†æ¢ç®—å…³ç³»ï¼š
```
1 ç»¿å¶ = 1 æ´»åŠ¨æ¬¡æ•°
1 èŠ±æœµ = 4 ç»¿å¶ = 4 æ´»åŠ¨æ¬¡æ•°
1 æœå® = 4 èŠ±æœµ = 16 æ´»åŠ¨æ¬¡æ•°
1 å¤§æ ‘ = 4 æœå® = 64 æ´»åŠ¨æ¬¡æ•°
```

#### å±•ç¤ºé€»è¾‘ï¼š
```javascript
/**
 * æ ¹æ®æ´»åŠ¨æ¬¡æ•°è®¡ç®—æˆé•¿ç­‰çº§æ˜¾ç¤º
 * @param {number} activityCount - ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
 * @returns {string} - æ˜¾ç¤ºçš„å›¾æ ‡å­—ç¬¦ä¸²
 */
function getGrowthLevelDisplay(activityCount) {
  const trees = Math.floor(activityCount / 64);      // å¤§æ ‘æ•°é‡
  const fruits = Math.floor((activityCount % 64) / 16);  // æœå®æ•°é‡
  const flowers = Math.floor((activityCount % 16) / 4);  // èŠ±æœµæ•°é‡
  const leaves = activityCount % 4;                   // ç»¿å¶æ•°é‡

  let display = '';

  // åªæ˜¾ç¤ºæœ€é«˜ç­‰çº§
  if (trees > 0) {
    display = 'ğŸŒ³'.repeat(trees);
  } else if (fruits > 0) {
    display = 'ğŸ'.repeat(fruits);
  } else if (flowers > 0) {
    display = 'ğŸŒ¸'.repeat(flowers);
  } else if (leaves > 0) {
    display = 'ğŸƒ'.repeat(leaves);
  } else {
    display = 'ğŸƒ'; // é»˜è®¤æ˜¾ç¤º1ä¸ªç»¿å¶
  }

  return display;
}
```

#### æ•°æ®æ¥æºï¼š
- ç´¯è®¡æ´»åŠ¨æ¬¡æ•°æ¥è‡ª `ambassador_activity_records` è¡¨ï¼ˆéœ€è¦æ–°å»ºï¼‰

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ–°å¢è¡¨ï¼š`ambassador_activity_records` - å¤§ä½¿æ´»åŠ¨è®°å½•è¡¨

```sql
CREATE TABLE IF NOT EXISTS ambassador_activity_records (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ´»åŠ¨è®°å½•ID',
  user_id INT NOT NULL COMMENT 'å¤§ä½¿ç”¨æˆ·ID',
  user_uid VARCHAR(64) DEFAULT NULL COMMENT 'å¤§ä½¿ç”¨æˆ·UID',
  _openid VARCHAR(64) NOT NULL DEFAULT '' COMMENT 'CloudBase ç”¨æˆ·æ ‡è¯†',

  activity_type TINYINT NOT NULL COMMENT 'æ´»åŠ¨ç±»å‹ï¼š1è¾…å¯¼å‘˜/2ä¼šåŠ¡ä¹‰å·¥/3æ²™é¾™ç»„ç»‡/4å…¶ä»–',
  activity_name VARCHAR(100) NOT NULL COMMENT 'æ´»åŠ¨åç§°',
  activity_desc VARCHAR(500) DEFAULT NULL COMMENT 'æ´»åŠ¨æè¿°',

  class_record_id INT DEFAULT NULL COMMENT 'å…³è”ä¸Šè¯¾è®¡åˆ’IDï¼ˆè¾…å¯¼å‘˜ä¸“ç”¨ï¼‰',
  course_name VARCHAR(100) DEFAULT NULL COMMENT 'è¯¾ç¨‹åç§°ï¼ˆè¾…å¯¼å‘˜ä¸“ç”¨ï¼‰',

  location VARCHAR(200) DEFAULT NULL COMMENT 'æ´»åŠ¨åœ°ç‚¹',
  start_time DATETIME NOT NULL COMMENT 'æ´»åŠ¨å¼€å§‹æ—¶é—´',
  end_time DATETIME DEFAULT NULL COMMENT 'æ´»åŠ¨ç»“æŸæ—¶é—´',
  duration VARCHAR(50) DEFAULT NULL COMMENT 'æ´»åŠ¨æ—¶é•¿ï¼ˆå¦‚ï¼š3å¤©ã€5å°æ—¶ï¼‰',

  participant_count INT DEFAULT NULL COMMENT 'å‚ä¸äººæ•°',
  merit_points DECIMAL(10,2) DEFAULT 0.00 COMMENT 'è·å¾—åŠŸå¾·åˆ†',

  note TEXT DEFAULT NULL COMMENT 'æ´»åŠ¨å¤‡æ³¨/æ€»ç»“',
  images JSON DEFAULT NULL COMMENT 'æ´»åŠ¨å›¾ç‰‡åˆ—è¡¨',

  status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0æ— æ•ˆ/1æœ‰æ•ˆ/2å¾…å®¡æ ¸',
  audit_admin_id INT DEFAULT NULL COMMENT 'å®¡æ ¸ç®¡ç†å‘˜ID',
  audit_time DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  audit_remark VARCHAR(500) DEFAULT NULL COMMENT 'å®¡æ ¸å¤‡æ³¨',

  created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

  INDEX idx_user_id (user_id),
  INDEX idx_activity_type (activity_type),
  INDEX idx_class_record_id (class_record_id),
  INDEX idx_start_time (start_time),
  INDEX idx_status (status),
  INDEX idx_user_type (user_id, activity_type),

  CONSTRAINT fk_activity_records_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_activity_records_class_record FOREIGN KEY (class_record_id) REFERENCES class_records(id) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å¤§ä½¿æ´»åŠ¨è®°å½•è¡¨';
```

### æ–°å¢å­—æ®µï¼š`users` è¡¨

```sql
-- åœ¨ users è¡¨æ–°å¢ç´¯è®¡æ´»åŠ¨æ¬¡æ•°å­—æ®µ
ALTER TABLE users
ADD COLUMN total_activity_count INT DEFAULT 0 COMMENT 'ç´¯è®¡æ´»åŠ¨æ¬¡æ•°ï¼ˆç”¨äºæˆé•¿ç­‰çº§è®¡ç®—ï¼‰',
ADD INDEX idx_total_activity_count (total_activity_count);
```

---

## ğŸ”§ éœ€è¦æ–°å¢çš„äº‘å‡½æ•°

### 1. **user äº‘å‡½æ•°**

#### æ–°å¢ handler: `getReferralStats.js`

**è·¯å¾„ï¼š** `cloudfunctions/user/handlers/client/getReferralStats.js`

**åŠŸèƒ½ï¼š** è·å–æ¨èç»Ÿè®¡ä¿¡æ¯

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  total_referrals: 5,                    // æ€»æ¨èäººæ•°
  ambassador_start_date: '2024-01-15',   // æˆä¸ºå¤§ä½¿æ—¶é—´
  total_activity_count: 12               // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
}
```

**SQLæŸ¥è¯¢ï¼š**
```sql
-- ç»Ÿè®¡æ¨èäººæ•°
SELECT COUNT(*) as total_referrals
FROM users
WHERE referee_id = ? AND referee_confirmed_at IS NOT NULL;

-- è·å–æˆä¸ºå¤§ä½¿æ—¶é—´å’Œæ´»åŠ¨æ¬¡æ•°
SELECT ambassador_start_date, total_activity_count
FROM users
WHERE id = ?;
```

---

### 2. **system äº‘å‡½æ•°**

#### æ–°å¢ handler: `getSystemConfig.js`

**è·¯å¾„ï¼š** `cloudfunctions/system/handlers/client/getSystemConfig.js`

**åŠŸèƒ½ï¼š** è·å–ç³»ç»Ÿé…ç½®

**è¯·æ±‚å‚æ•°ï¼š**
```javascript
{
  key: 'customer_service_phone'  // é…ç½®é”®
}
```

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  value: '400-123-4567'
}
```

**SQLæŸ¥è¯¢ï¼š**
```sql
SELECT config_value
FROM system_configs
WHERE config_key = ? AND status = 1;
```

---

### 3. **ambassador äº‘å‡½æ•°**ï¼ˆæ–°å»ºï¼‰

#### æ–°å¢ handler: `getActivityRecords.js`

**è·¯å¾„ï¼š** `cloudfunctions/ambassador/handlers/client/getActivityRecords.js`

**åŠŸèƒ½ï¼š** è·å–æ´»åŠ¨è®°å½•åˆ—è¡¨

**è¯·æ±‚å‚æ•°ï¼š**
```javascript
{
  activity_type: 0,  // æ´»åŠ¨ç±»å‹ç­›é€‰ï¼š0å…¨éƒ¨/1è¾…å¯¼å‘˜/2ä¹‰å·¥/3æ²™é¾™/4å…¶ä»–
  page: 1,
  page_size: 10
}
```

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  list: [
    {
      id: 1,
      activity_type: 1,
      activity_name: 'æ‹…ä»»è¾…å¯¼å‘˜',
      activity_desc: 'åˆæ¢ç­ç¬¬12æœŸ',
      location: 'åŒ—äº¬å¸‚æœé˜³åŒº',
      start_time: '2024-01-15 09:00:00',
      duration: '3å¤©',
      participant_count: 30,
      merit_points: 500.00,
      note: 'ååŠ©è®²å¸ˆæ•™å­¦...',
      created_at: '2024-01-15 09:00:00'
    }
  ],
  total: 12,
  stats: {
    total_count: 12,           // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
    total_merit_points: 3850,  // ç´¯è®¡åŠŸå¾·åˆ†
    month_count: 5,            // æœ¬æœˆæ´»åŠ¨æ¬¡æ•°
    type_stats: {              // æ´»åŠ¨ç±»å‹ç»Ÿè®¡
      1: 5,  // è¾…å¯¼å‘˜ 5æ¬¡
      2: 4,  // ä¹‰å·¥ 4æ¬¡
      3: 2,  // æ²™é¾™ 2æ¬¡
      4: 1   // å…¶ä»– 1æ¬¡
    }
  }
}
```

#### æ–°å¢ handler: `getActivityStats.js`

**è·¯å¾„ï¼š** `cloudfunctions/ambassador/handlers/client/getActivityStats.js`

**åŠŸèƒ½ï¼š** è·å–æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  total_count: 12,           // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
  total_merit_points: 3850,  // ç´¯è®¡åŠŸå¾·åˆ†
  month_count: 5,            // æœ¬æœˆæ´»åŠ¨æ¬¡æ•°
  type_stats: {              // æ´»åŠ¨ç±»å‹ç»Ÿè®¡
    1: 5,  // è¾…å¯¼å‘˜
    2: 4,  // ä¹‰å·¥
    3: 2,  // æ²™é¾™
    4: 1   // å…¶ä»–
  }
}
```

---

## ğŸ“ å‰ç«¯ä¿®æ”¹æ¸…å•

### 1. **ç±»å‹å®šä¹‰**

#### `src/api/types/user.ts`

æ–°å¢æ¥å£ï¼š
```typescript
/**
 * æ¨èç»Ÿè®¡ä¿¡æ¯
 */
export interface ReferralStats {
  /** æ€»æ¨èäººæ•° */
  total_referrals: number;
  /** æˆä¸ºå¤§ä½¿æ—¶é—´ */
  ambassador_start_date: string | null;
  /** ç´¯è®¡æ´»åŠ¨æ¬¡æ•° */
  total_activity_count: number;
}
```

#### `src/api/types/system.ts`

æ–°å¢æ¥å£ï¼š
```typescript
/**
 * è·å–ç³»ç»Ÿé…ç½®è¯·æ±‚å‚æ•°
 */
export interface GetSystemConfigParams {
  /** é…ç½®é”® */
  key: string;
}

/**
 * è·å–ç³»ç»Ÿé…ç½®å“åº”æ•°æ®
 */
export interface GetSystemConfigResponse {
  /** é…ç½®å€¼ */
  value: string;
}
```

#### `src/api/types/ambassador.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
/**
 * æ´»åŠ¨ç±»å‹
 */
export enum ActivityType {
  /** è¾…å¯¼å‘˜ */
  TUTOR = 1,
  /** ä¼šåŠ¡ä¹‰å·¥ */
  VOLUNTEER = 2,
  /** æ²™é¾™ç»„ç»‡ */
  SALON = 3,
  /** å…¶ä»–æ´»åŠ¨ */
  OTHER = 4
}

/**
 * æ´»åŠ¨è®°å½•
 */
export interface ActivityRecord {
  id: number;
  activity_type: ActivityType;
  activity_name: string;
  activity_desc: string | null;
  location: string | null;
  start_time: string;
  duration: string | null;
  participant_count: number | null;
  merit_points: number;
  note: string | null;
  created_at: string;
}

/**
 * æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯
 */
export interface ActivityStats {
  /** ç´¯è®¡æ´»åŠ¨æ¬¡æ•° */
  total_count: number;
  /** ç´¯è®¡åŠŸå¾·åˆ† */
  total_merit_points: number;
  /** æœ¬æœˆæ´»åŠ¨æ¬¡æ•° */
  month_count: number;
  /** æ´»åŠ¨ç±»å‹ç»Ÿè®¡ */
  type_stats: {
    [key: number]: number;
  };
}

/**
 * è·å–æ´»åŠ¨è®°å½•è¯·æ±‚å‚æ•°
 */
export interface GetActivityRecordsParams extends PaginationParams {
  /** æ´»åŠ¨ç±»å‹ç­›é€‰ï¼š0å…¨éƒ¨ */
  activity_type?: number;
}

/**
 * è·å–æ´»åŠ¨è®°å½•å“åº”æ•°æ®
 */
export interface GetActivityRecordsResponse extends PaginationResponse<ActivityRecord> {
  /** ç»Ÿè®¡ä¿¡æ¯ */
  stats: ActivityStats;
}
```

---

### 2. **API æ¨¡å—**

#### `src/api/modules/user.ts`

æ–°å¢æ–¹æ³•ï¼š
```typescript
/**
 * è·å–æ¨èç»Ÿè®¡ä¿¡æ¯
 */
static async getReferralStats(): Promise<ReferralStats> {
  return callCloudFunction<ReferralStats>({
    name: 'user',
    action: 'getReferralStats',
    showLoading: false
  })
}
```

#### `src/api/modules/system.ts`

æ–°å¢æ–¹æ³•ï¼š
```typescript
/**
 * è·å–ç³»ç»Ÿé…ç½®
 */
static async getSystemConfig(params: GetSystemConfigParams): Promise<GetSystemConfigResponse> {
  return callCloudFunction<GetSystemConfigResponse>({
    name: 'system',
    action: 'getSystemConfig',
    data: params,
    showLoading: false
  })
}
```

#### `src/api/modules/ambassador.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
import { callCloudFunction } from '../request'
import type {
  GetActivityRecordsParams,
  GetActivityRecordsResponse,
  ActivityStats
} from '../types/ambassador'

export class AmbassadorApi {
  /**
   * è·å–æ´»åŠ¨è®°å½•åˆ—è¡¨
   */
  static async getActivityRecords(params?: GetActivityRecordsParams): Promise<GetActivityRecordsResponse> {
    return callCloudFunction<GetActivityRecordsResponse>({
      name: 'ambassador',
      action: 'getActivityRecords',
      data: params,
      showLoading: false
    })
  }

  /**
   * è·å–æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯
   */
  static async getActivityStats(): Promise<ActivityStats> {
    return callCloudFunction<ActivityStats>({
      name: 'ambassador',
      action: 'getActivityStats',
      showLoading: false
    })
  }
}

export default AmbassadorApi
```

---

### 3. **å·¥å…·å‡½æ•°**

#### `src/utils/growth-level.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
/**
 * æˆé•¿ç­‰çº§å·¥å…·å‡½æ•°
 */

/**
 * æ ¹æ®æ´»åŠ¨æ¬¡æ•°è®¡ç®—æˆé•¿ç­‰çº§æ˜¾ç¤º
 * @param activityCount - ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
 * @returns æ˜¾ç¤ºçš„å›¾æ ‡å­—ç¬¦ä¸²
 */
export function getGrowthLevelDisplay(activityCount: number): string {
  const trees = Math.floor(activityCount / 64)      // å¤§æ ‘æ•°é‡
  const fruits = Math.floor((activityCount % 64) / 16)  // æœå®æ•°é‡
  const flowers = Math.floor((activityCount % 16) / 4)  // èŠ±æœµæ•°é‡
  const leaves = activityCount % 4                   // ç»¿å¶æ•°é‡

  let display = ''

  // åªæ˜¾ç¤ºæœ€é«˜ç­‰çº§
  if (trees > 0) {
    display = 'ğŸŒ³'.repeat(trees)
  } else if (fruits > 0) {
    display = 'ğŸ'.repeat(fruits)
  } else if (flowers > 0) {
    display = 'ğŸŒ¸'.repeat(flowers)
  } else if (leaves > 0) {
    display = 'ğŸƒ'.repeat(leaves)
  } else {
    display = 'ğŸƒ' // é»˜è®¤æ˜¾ç¤º1ä¸ªç»¿å¶
  }

  return display
}

/**
 * è·å–æˆé•¿ç­‰çº§åç§°
 * @param activityCount - ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
 * @returns ç­‰çº§åç§°
 */
export function getGrowthLevelName(activityCount: number): string {
  if (activityCount >= 64) return 'å¤§æ ‘'
  if (activityCount >= 16) return 'æœå®'
  if (activityCount >= 4) return 'èŠ±æœµ'
  return 'ç»¿å¶'
}

/**
 * è·å–æˆé•¿ç­‰çº§æè¿°
 * @param activityCount - ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
 * @returns ç­‰çº§æè¿°
 */
export function getGrowthLevelDesc(activityCount: number): string {
  if (activityCount >= 64) return 'æœ€é«˜ç­‰çº§'
  if (activityCount >= 16) return 'æ²‰æ·€ã€ä»·å€¼ï¼Œä»£è¡¨æ ¸å¿ƒæˆå‘˜'
  if (activityCount >= 4) return 'ç»½æ”¾ã€æ´»è·ƒï¼Œä»£è¡¨è¿›é˜¶è´¡çŒ®'
  return 'æ–°ç”Ÿã€èµ·ç‚¹ï¼Œä»£è¡¨åˆçº§æˆå‘˜'
}
```

---

### 4. **é¡µé¢ç»„ä»¶ä¿®æ”¹**

#### `pages/ambassador/level/index.vue`

ä¿®æ”¹å†…å®¹ï¼š
1. å¯¼å…¥ `UserApi.getReferralStats()`
2. åœ¨ `onMounted` ä¸­è°ƒç”¨APIè·å–æ•°æ®
3. æ›¿æ¢ç¡¬ç¼–ç çš„ç­‰çº§åç§°ã€æ¨èäººæ•°ã€æˆä¸ºå¤§ä½¿æ—¶é—´
4. åŠŸå¾·åˆ†å’Œç§¯åˆ†å·²ç»é€šè¿‡ `loadPoints()` è·å–ï¼Œæ— éœ€ä¿®æ”¹

#### `pages/course/appointment-confirm/index.vue`

ä¿®æ”¹å†…å®¹ï¼š
1. å¯¼å…¥ `SystemApi.getSystemConfig()`
2. åœ¨ `onMounted` ä¸­è°ƒç”¨APIè·å–å®¢æœç”µè¯
3. æ›¿æ¢ç¡¬ç¼–ç çš„å®¢æœç”µè¯

#### `pages/mine/index.vue`

ä¿®æ”¹å†…å®¹ï¼š
1. å¯¼å…¥ `UserApi.getReferralStats()`
2. åœ¨ `loadUserProfile()` ä¸­è°ƒç”¨APIè·å–æ¨èäººæ•°
3. æ›¿æ¢ç¡¬ç¼–ç çš„å¼•èäººåˆ—è¡¨æ•°é‡
4. åˆ é™¤å¸®åŠ©èœå•ä¸­çš„å…¬å‘Šæ•°é‡å¾½ç« 
5. å¯¼å…¥ `getGrowthLevelDisplay()` å·¥å…·å‡½æ•°
6. åœ¨ç”¨æˆ·åæ—è¾¹æ˜¾ç¤ºæˆé•¿ç­‰çº§å›¾æ ‡

#### `pages/ambassador/activity-records/index.vue`

ä¿®æ”¹å†…å®¹ï¼š
1. å¯¼å…¥ `AmbassadorApi`
2. æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç çš„æ´»åŠ¨æ•°æ®
3. å®ç°åˆ†é¡µåŠ è½½
4. å®ç°Tabç­›é€‰åŠŸèƒ½

---

## âœ… å¼€å‘æ­¥éª¤

### é˜¶æ®µä¸€ï¼šæ•°æ®åº“å’Œäº‘å‡½æ•°ï¼ˆä¼˜å…ˆï¼‰

1. âœ… åˆ›å»º `ambassador_activity_records` è¡¨
2. âœ… åœ¨ `users` è¡¨æ–°å¢ `total_activity_count` å­—æ®µ
3. âœ… æ’å…¥å®¢æœç”µè¯é…ç½®åˆ° `system_configs` è¡¨
4. âœ… å¼€å‘ `user/getReferralStats.js` äº‘å‡½æ•°
5. âœ… å¼€å‘ `system/getSystemConfig.js` äº‘å‡½æ•°
6. âœ… å¼€å‘ `ambassador/getActivityRecords.js` äº‘å‡½æ•°
7. âœ… å¼€å‘ `ambassador/getActivityStats.js` äº‘å‡½æ•°

### é˜¶æ®µäºŒï¼šå‰ç«¯ç±»å‹å’ŒAPI

8. âœ… æ–°å¢ç±»å‹å®šä¹‰
9. âœ… æ–°å¢APIæ–¹æ³•
10. âœ… åˆ›å»ºæˆé•¿ç­‰çº§å·¥å…·å‡½æ•°

### é˜¶æ®µä¸‰ï¼šé¡µé¢ç»„ä»¶ä¿®æ”¹

11. âœ… ä¿®æ”¹å¤§ä½¿ç­‰çº§é¡µ
12. âœ… ä¿®æ”¹é¢„çº¦ç¡®è®¤é¡µ
13. âœ… ä¿®æ”¹ä¸ªäººä¸­å¿ƒé¡µ
14. âœ… ä¿®æ”¹æ´»åŠ¨è®°å½•é¡µ

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**ï¼š`users.total_activity_count` éœ€è¦åœ¨æ–°å¢æ´»åŠ¨è®°å½•æ—¶åŒæ­¥æ›´æ–°
2. **æƒé™æ§åˆ¶**ï¼šæ´»åŠ¨è®°å½•åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¨èäººæ•°ç»Ÿè®¡å¯ä»¥è€ƒè™‘ç¼“å­˜
4. **å‘åå…¼å®¹**ï¼šè€ç”¨æˆ·çš„ `ambassador_start_date` å¯èƒ½ä¸ºç©ºï¼Œéœ€è¦å¤„ç†
5. **æµ‹è¯•æ•°æ®**ï¼šå¼€å‘å®Œæˆåéœ€è¦æ’å…¥æµ‹è¯•æ•°æ®éªŒè¯åŠŸèƒ½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è¯¦ç»†ä¿¡æ¯](../database/æ•°æ®åº“è¯¦ç»†ä¿¡æ¯.md)
- [äº‘å‡½æ•°å¼€å‘è§„èŒƒ](../development/äº‘å‡½æ•°å¼€å‘è§„èŒƒ.md)
- [APIæ¥å£æ–‡æ¡£](../api/APIæ¥å£æ–‡æ¡£.md)

---

**æ–‡æ¡£åˆ›å»ºå®Œæ¯• âœ…**
