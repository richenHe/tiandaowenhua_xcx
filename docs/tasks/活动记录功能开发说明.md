## æ´»åŠ¨è®°å½•åŠŸèƒ½å¼€å‘è¯´æ˜

### ğŸ“Š æ•°æ®åº“è¡¨å·²åˆ›å»º

SQLæ–‡ä»¶ä½ç½®ï¼š`docs/database/æ´»åŠ¨è®°å½•è¡¨SQL.sql`

è¯·å…ˆæ‰§è¡Œè¯¥SQLæ–‡ä»¶åˆ›å»ºä»¥ä¸‹å†…å®¹ï¼š
1. `ambassador_activity_records` è¡¨ - å¤§ä½¿æ´»åŠ¨è®°å½•è¡¨
2. `users.total_activity_count` å­—æ®µ - ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
3. `system_configs` å®¢æœç”µè¯é…ç½®

### ğŸ”§ éœ€è¦å¼€å‘çš„äº‘å‡½æ•°

#### 1. user äº‘å‡½æ•°æ–°å¢ action

**æ–‡ä»¶ï¼š** `cloudfunctions/user/handlers/client/getReferralStats.js`

**åŠŸèƒ½ï¼š** è·å–æ¨èç»Ÿè®¡ä¿¡æ¯ï¼ˆæ¨èäººæ•°ã€æˆä¸ºå¤§ä½¿æ—¶é—´ã€ç´¯è®¡æ´»åŠ¨æ¬¡æ•°ï¼‰

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  total_referrals: 5,                    // æ€»æ¨èäººæ•°
  ambassador_start_date: '2024-01-15',   // æˆä¸ºå¤§ä½¿æ—¶é—´
  total_activity_count: 12               // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
}
```

**éœ€è¦åœ¨ `cloudfunctions/user/index.js` ä¸­æ³¨å†Œï¼š**
```javascript
const clientHandlers = {
  // ... ç°æœ‰handlers
  getReferralStats: require('./handlers/client/getReferralStats')
};
```

---

#### 2. system äº‘å‡½æ•°æ–°å¢ action

**æ–‡ä»¶ï¼š** `cloudfunctions/system/handlers/client/getSystemConfig.js`

**åŠŸèƒ½ï¼š** è·å–ç³»ç»Ÿé…ç½®ï¼ˆå¦‚å®¢æœç”µè¯ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```javascript
{
  key: 'customer_service_phone'  // é…ç½®é”®
}
```

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  value: '400-123-4567'
}
```

**éœ€è¦åœ¨ `cloudfunctions/system/index.js` ä¸­æ³¨å†Œï¼š**
```javascript
const clientHandlers = {
  // ... ç°æœ‰handlers
  getSystemConfig: require('./handlers/client/getSystemConfig')
};
```

---

#### 3. ambassador äº‘å‡½æ•°æ–°å¢ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰

**æ–‡ä»¶ç»“æ„ï¼š**
```
cloudfunctions/ambassador/
â”œâ”€â”€ index.js                                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ response.js                             # å“åº”å°è£…
â”‚   â””â”€â”€ auth.js                                 # é‰´æƒ
â”œâ”€â”€ handlers/
â”‚   â””â”€â”€ client/
â”‚       â”œâ”€â”€ getActivityRecords.js               # è·å–æ´»åŠ¨è®°å½•åˆ—è¡¨
â”‚       â””â”€â”€ getActivityStats.js                 # è·å–æ´»åŠ¨ç»Ÿè®¡
```

**3.1 getActivityRecords.js**

**åŠŸèƒ½ï¼š** è·å–æ´»åŠ¨è®°å½•åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œç­›é€‰ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```javascript
{
  activity_type: 0,  // æ´»åŠ¨ç±»å‹ç­›é€‰ï¼š0å…¨éƒ¨/1è¾…å¯¼å‘˜/2ä¹‰å·¥/3æ²™é¾™/4å…¶ä»–
  page: 1,
  page_size: 10
}
```

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  list: [
    {
      id: 1,
      activity_type: 1,
      activity_name: 'æ‹…ä»»è¾…å¯¼å‘˜',
      activity_desc: 'åˆæ¢ç­ç¬¬12æœŸ',
      location: 'åŒ—äº¬å¸‚æœé˜³åŒº',
      start_time: '2024-01-15 09:00:00',
      duration: '3å¤©',
      participant_count: 30,
      merit_points: 500.00,
      note: 'ååŠ©è®²å¸ˆæ•™å­¦...',
      created_at: '2024-01-15 09:00:00'
    }
  ],
  total: 12,
  stats: {
    total_count: 12,           // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
    total_merit_points: 3850,  // ç´¯è®¡åŠŸå¾·åˆ†
    month_count: 5,            // æœ¬æœˆæ´»åŠ¨æ¬¡æ•°
    type_stats: {              // æ´»åŠ¨ç±»å‹ç»Ÿè®¡
      1: 5,  // è¾…å¯¼å‘˜ 5æ¬¡
      2: 4,  // ä¹‰å·¥ 4æ¬¡
      3: 2,  // æ²™é¾™ 2æ¬¡
      4: 1   // å…¶ä»– 1æ¬¡
    }
  }
}
```

**3.2 getActivityStats.js**

**åŠŸèƒ½ï¼š** è·å–æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆç”¨äºé¡µé¢é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ï¼‰

**è¿”å›æ•°æ®ï¼š**
```javascript
{
  total_count: 12,           // ç´¯è®¡æ´»åŠ¨æ¬¡æ•°
  total_merit_points: 3850,  // ç´¯è®¡åŠŸå¾·åˆ†
  month_count: 5,            // æœ¬æœˆæ´»åŠ¨æ¬¡æ•°
  type_stats: {              // æ´»åŠ¨ç±»å‹ç»Ÿè®¡
    1: 5,  // è¾…å¯¼å‘˜
    2: 4,  // ä¹‰å·¥
    3: 2,  // æ²™é¾™
    4: 1   // å…¶ä»–
  }
}
```

---

### ğŸ“ å‰ç«¯ç±»å‹å®šä¹‰

éœ€è¦æ–°å¢çš„ç±»å‹æ–‡ä»¶ï¼š`src/api/types/ambassador.ts`

```typescript
import type { PaginationParams, PaginationResponse } from './index'

/**
 * æ´»åŠ¨ç±»å‹
 */
export enum ActivityType {
  /** è¾…å¯¼å‘˜ */
  TUTOR = 1,
  /** ä¼šåŠ¡ä¹‰å·¥ */
  VOLUNTEER = 2,
  /** æ²™é¾™ç»„ç»‡ */
  SALON = 3,
  /** å…¶ä»–æ´»åŠ¨ */
  OTHER = 4
}

/**
 * æ´»åŠ¨è®°å½•
 */
export interface ActivityRecord {
  id: number
  activity_type: ActivityType
  activity_name: string
  activity_desc: string | null
  location: string | null
  start_time: string
  duration: string | null
  participant_count: number | null
  merit_points: number
  note: string | null
  created_at: string
}

/**
 * æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯
 */
export interface ActivityStats {
  /** ç´¯è®¡æ´»åŠ¨æ¬¡æ•° */
  total_count: number
  /** ç´¯è®¡åŠŸå¾·åˆ† */
  total_merit_points: number
  /** æœ¬æœˆæ´»åŠ¨æ¬¡æ•° */
  month_count: number
  /** æ´»åŠ¨ç±»å‹ç»Ÿè®¡ */
  type_stats: {
    [key: number]: number
  }
}

/**
 * è·å–æ´»åŠ¨è®°å½•è¯·æ±‚å‚æ•°
 */
export interface GetActivityRecordsParams extends PaginationParams {
  /** æ´»åŠ¨ç±»å‹ç­›é€‰ï¼š0å…¨éƒ¨ */
  activity_type?: number
}

/**
 * è·å–æ´»åŠ¨è®°å½•å“åº”æ•°æ®
 */
export interface GetActivityRecordsResponse extends PaginationResponse<ActivityRecord> {
  /** ç»Ÿè®¡ä¿¡æ¯ */
  stats: ActivityStats
}
```

---

### ğŸ”„ å¼€å‘æµç¨‹

1. âœ… **æ‚¨æ‰§è¡ŒSQL** - åˆ›å»ºæ•°æ®åº“è¡¨å’Œå­—æ®µ
2. â³ **æˆ‘å¼€å‘äº‘å‡½æ•°** - åˆ›å»º3ä¸ªäº‘å‡½æ•°handler
3. â³ **æˆ‘å¼€å‘å‰ç«¯API** - åˆ›å»ºç±»å‹å®šä¹‰å’ŒAPIæ–¹æ³•
4. â³ **æˆ‘ä¿®æ”¹é¡µé¢** - æ¥å…¥APIæ›¿æ¢ç¡¬ç¼–ç æ•°æ®

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘½åè§„èŒƒ**ï¼š
   - å‰ç«¯APIå‚æ•°ï¼šcamelCaseï¼ˆactivityTypeï¼‰
   - äº‘å‡½æ•°æ¥æ”¶ï¼šcamelCaseï¼ˆactivityTypeï¼‰
   - æ•°æ®åº“å­—æ®µï¼šsnake_caseï¼ˆactivity_typeï¼‰
   - äº‘å‡½æ•°è¿”å›ï¼šsnake_caseï¼ˆactivity_typeï¼‰

2. **å­—æ®µå¯¹é½**ï¼š
   - æ‰€æœ‰å­—æ®µä»¥ `docs/database/æ•°æ®åº“è¯¦ç»†ä¿¡æ¯.md` ä¸ºå‡†
   - äº‘å‡½æ•°è¿”å›æ•°æ®åº“åŸå§‹å­—æ®µåï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰

3. **ä¸ä¿®æ”¹å‰ç«¯é¡µé¢å…ƒç´ **ï¼š
   - åªæ·»åŠ APIè°ƒç”¨é€»è¾‘
   - ä¸æ”¹å˜é¡µé¢ç»“æ„å’Œæ ·å¼

---

### ğŸ“Œ ç­‰å¾…ç¡®è®¤

è¯·ç¡®è®¤ï¼š
1. SQLæ˜¯å¦å·²æ‰§è¡ŒæˆåŠŸï¼Ÿ
2. æ˜¯å¦éœ€è¦æˆ‘ç»§ç»­å¼€å‘äº‘å‡½æ•°ä»£ç ï¼Ÿ

ç¡®è®¤åæˆ‘å°†ç»§ç»­å¼€å‘ã€‚
