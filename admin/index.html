<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤©é“æ–‡åŒ–åå°ç®¡ç†</title>
  
  <!-- TDesign CSSï¼ˆæœ¬åœ°ï¼‰-->
  <link rel="stylesheet" href="./assets/libs/tdesign.min.css">
  
  <!-- è‡ªå®šä¹‰æ ·å¼ -->
  <link rel="stylesheet" href="./assets/css/tokens.css">
  
  <style>
    .t-layout {
      height: 100vh;
    }
    
    .t-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 24px;
      background: #fff;
      border-bottom: 1px solid #dcdcdc;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .system-name {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .t-aside {
      background: #fff;
      border-right: 1px solid #dcdcdc;
    }
    
    .t-content {
      padding: 24px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    
    .welcome-card {
      margin-bottom: 24px;
    }
    
    .stats-row {
      margin-bottom: 24px;
    }
  </style>
</head>
<body>
  <div id="app">
    <t-layout>
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <t-header height="64px">
        <div class="header-left">
          <span class="system-name">ğŸ¨ å¤©é“æ–‡åŒ–åå°ç®¡ç†</span>
        </div>
        <div class="header-right">
          <span>{{ adminInfo?.real_name || 'ç®¡ç†å‘˜' }}</span>
          <t-button size="small" @click="handleLogout">é€€å‡º</t-button>
        </div>
      </t-header>
      
      <t-layout>
        <!-- ä¾§è¾¹èœå• -->
        <t-aside width="240px">
          <t-menu
            v-model:value="activeMenu"
            :default-expanded="['user', 'order', 'course', 'ambassador', 'system']"
            theme="light"
            @change="handleMenuChange"
          >
            <t-menu-item value="dashboard">
              <template #icon><t-icon name="dashboard" /></template>
              æ•°æ®æ¦‚è§ˆ
            </t-menu-item>
            
            <t-submenu value="user">
              <template #icon><t-icon name="user" /></template>
              <template #title>ç”¨æˆ·ç®¡ç†</template>
              <t-menu-item value="user-list">å­¦å‘˜åˆ—è¡¨</t-menu-item>
              <t-menu-item value="user-referee">æ¨èäººç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="order">
              <template #icon><t-icon name="order" /></template>
              <template #title>è®¢å•ç®¡ç†</template>
              <t-menu-item value="order-list">è®¢å•åˆ—è¡¨</t-menu-item>
              <t-menu-item value="order-refund">é€€æ¬¾ç®¡ç†</t-menu-item>
              <t-menu-item value="withdraw-audit">æç°å®¡æ ¸</t-menu-item>
            </t-submenu>
            
            <t-submenu value="course">
              <template #icon><t-icon name="file" /></template>
              <template #title>è¯¾ç¨‹ç®¡ç†</template>
              <t-menu-item value="course-list">è¯¾ç¨‹åˆ—è¡¨</t-menu-item>
              <t-menu-item value="schedule-list">æ’æœŸç®¡ç†</t-menu-item>
              <t-menu-item value="appointment-list">é¢„çº¦ç®¡ç†</t-menu-item>
              <t-menu-item value="case-list">æ¡ˆä¾‹ç®¡ç†</t-menu-item>
              <t-menu-item value="material-list">èµ„æ–™ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="ambassador">
              <template #icon><t-icon name="usergroup" /></template>
              <template #title>å¤§ä½¿ç®¡ç†</template>
              <t-menu-item value="ambassador-list">å¤§ä½¿åˆ—è¡¨</t-menu-item>
              <t-menu-item value="application-audit">ç”³è¯·å®¡æ ¸</t-menu-item>
              <t-menu-item value="activity-list">æ´»åŠ¨ç®¡ç†</t-menu-item>
              <t-menu-item value="contract-list">åˆçº¦ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="system">
              <template #icon><t-icon name="setting" /></template>
              <template #title>ç³»ç»Ÿç®¡ç†</template>
              <t-menu-item value="admin-list">ç®¡ç†å‘˜ç®¡ç†</t-menu-item>
              <t-menu-item value="config">ç³»ç»Ÿé…ç½®</t-menu-item>
              <t-menu-item value="announcement-list">å…¬å‘Šç®¡ç†</t-menu-item>
              <t-menu-item value="feedback-list">åé¦ˆç®¡ç†</t-menu-item>
              <t-menu-item value="notification-list">é€šçŸ¥ç®¡ç†</t-menu-item>
              <t-menu-item value="level-config">ç­‰çº§é…ç½®</t-menu-item>
            </t-submenu>
            
            <t-menu-item value="playground">
              <template #icon><t-icon name="play" /></template>
              ç»„ä»¶å±•ç¤º
            </t-menu-item>
          </t-menu>
        </t-aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <t-content>
          <!-- æ¬¢è¿å¡ç‰‡ -->
          <t-card class="welcome-card" title="æ¬¢è¿å›æ¥">
            <p>å½“å‰ç™»å½•ï¼š{{ adminInfo?.real_name || 'ç®¡ç†å‘˜' }} ({{ adminInfo?.role }})</p>
          </t-card>
          
          <!-- ç»Ÿè®¡æ•°æ® -->
          <div v-if="activeMenu === 'dashboard'">
            <t-row :gutter="16" class="stats-row">
              <t-col :span="6">
                <t-card :bordered="true">
                  <t-statistic
                    title="æ€»ç”¨æˆ·æ•°"
                    :value="stats.users?.total || 0"
                    :trend="stats.users?.today > 0 ? 'increase' : null"
                    :trend-num="stats.users?.today || 0"
                  />
                </t-card>
              </t-col>
              
              <t-col :span="6">
                <t-card :bordered="true">
                  <t-statistic
                    title="æ€»è®¢å•æ•°"
                    :value="stats.orders?.total || 0"
                    :trend="stats.orders?.today > 0 ? 'increase' : null"
                    :trend-num="stats.orders?.today || 0"
                  />
                </t-card>
              </t-col>
              
              <t-col :span="6">
                <t-card :bordered="true">
                  <t-statistic
                    title="æ€»é¢„çº¦æ•°"
                    :value="stats.courses?.total_appointments || 0"
                  />
                </t-card>
              </t-col>
              
              <t-col :span="6">
                <t-card :bordered="true">
                  <t-statistic
                    title="å¤§ä½¿æ•°"
                    :value="stats.ambassadors?.total || 0"
                  />
                </t-card>
              </t-col>
            </t-row>
            
            <t-card title="ä»Šæ—¥æ•°æ®">
              <p>æ–°å¢ç”¨æˆ·ï¼š{{ stats.today?.users || 0 }}</p>
              <p>æ–°å¢è®¢å•ï¼š{{ stats.today?.orders || 0 }}</p>
              <p>æ–°å¢é¢„çº¦ï¼š{{ stats.today?.appointments || 0 }}</p>
            </t-card>
          </div>
          
          <!-- å…¶ä»–é¡µé¢å ä½ -->
          <t-card v-else :title="getPageTitle()">
            <p>{{ getPageTitle() }}åŠŸèƒ½å¼€å‘ä¸­...</p>
            <p style="margin-top: 16px; color: #999;">
              æç¤ºï¼šå…·ä½“é¡µé¢è¯·ä½¿ç”¨ Claude Code æˆ–å…¶ä»–å·¥å…·å®ç°
            </p>
          </t-card>
        </t-content>
      </t-layout>
    </t-layout>
  </div>

  <!-- Vue 3ï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/vue.global.js"></script>
  
  <!-- TDesign Vueï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/tdesign.min.js"></script>
  
  <!-- CloudBase SDKï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/tcb.js"></script>
  
  <!-- é…ç½®æ–‡ä»¶ -->
  <script src="./assets/js/config.js"></script>
  
  <!-- API å°è£… -->
  <script src="./assets/js/admin-api.js"></script>
  
  <script>
    const { createApp, ref, onMounted } = Vue;
    
    const app = createApp({
      setup() {
        const activeMenu = ref('dashboard');
        const adminInfo = ref(null);
        const stats = ref({});
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const checkAuth = () => {
          adminInfo.value = AdminAPI.getCurrentAdmin();
          
          if (!adminInfo.value) {
            window.location.href = 'login.html';
            return false;
          }
          
          return true;
        };
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        const loadStats = async () => {
          try {
            const data = await AdminAPI.getStatistics();
            stats.value = data;
          } catch (error) {
            console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            TDesign.MessagePlugin.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥');
          }
        };
        
        // é€€å‡ºç™»å½•
        const handleLogout = () => {
          TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤é€€å‡º',
            body: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
            onConfirm: () => {
              AdminAPI.logout();
            }
          });
        };
        
        // èœå•åˆ‡æ¢
        const handleMenuChange = (value) => {
          // ç»„ä»¶å±•ç¤ºè·³è½¬åˆ°æ–°é¡µé¢
          if (value === 'playground') {
            window.open('playground.html', '_blank');
            return;
          }
          
          // é¡µé¢è·¯ç”±æ˜ å°„
          const routes = {
            'dashboard': 'index.html',
            'user-list': 'pages/user/list.html',
            'user-referee': 'pages/user/referee.html',
            'order-list': 'pages/order/list.html',
            'order-refund': 'pages/order/refund.html',
            'withdraw-audit': 'pages/order/withdraw.html',
            'course-list': 'pages/course/list.html',
            'schedule-list': 'pages/course/schedule.html',
            'appointment-list': 'pages/course/appointment.html',
            'case-list': 'pages/course/case.html',
            'material-list': 'pages/course/material.html',
            'ambassador-list': 'pages/ambassador/list.html',
            'application-audit': 'pages/ambassador/application.html',
            'activity-list': 'pages/ambassador/activity.html',
            'contract-list': 'pages/ambassador/contract.html',
            'admin-list': 'pages/system/admin.html',
            'config': 'pages/system/config.html',
            'announcement-list': 'pages/system/announcement.html',
            'feedback-list': 'pages/system/feedback.html',
            'notification-list': 'pages/system/notification.html',
            'level-config': 'pages/system/level.html',
          };
          
          // è·³è½¬é¡µé¢
          if (routes[value]) {
            window.location.href = routes[value];
          } else {
            activeMenu.value = value;
          }
        };
        
        // è·å–é¡µé¢æ ‡é¢˜
        const getPageTitle = () => {
          const titles = {
            'dashboard': 'æ•°æ®æ¦‚è§ˆ',
            'users': 'å­¦å‘˜åˆ—è¡¨',
            'orders': 'è®¢å•åˆ—è¡¨',
            'withdraw': 'æç°å®¡æ ¸',
            'courses': 'è¯¾ç¨‹åˆ—è¡¨',
            'appointments': 'é¢„çº¦ç®¡ç†',
            'ambassadors': 'å¤§ä½¿åˆ—è¡¨',
            'applications': 'ç”³è¯·å®¡æ ¸',
          };
          return titles[activeMenu.value] || 'é¡µé¢';
        };
        
        onMounted(() => {
          if (checkAuth()) {
            loadStats();
          }
        });
        
        return {
          activeMenu,
          adminInfo,
          stats,
          handleLogout,
          handleMenuChange,
          getPageTitle,
        };
      }
    });
    
    app.use(TDesign);
    app.mount('#app');
  </script>
</body>
</html>

