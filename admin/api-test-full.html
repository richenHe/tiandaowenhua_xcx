<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åå°æ¥å£å®Œæ•´æµ‹è¯•ï¼ˆå«å†™å…¥æ“ä½œï¼‰- å¤©é“æ–‡åŒ–</title>
  <link rel="stylesheet" href="./assets/libs/tdesign.min.css">
  <link rel="stylesheet" href="./assets/css/tokens.css">
  <style>
    body {
      background: #f5f5f5;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .test-container {
      max-width: 1600px;
      margin: 0 auto;
    }
    .test-header {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .test-header h1 {
      margin: 0 0 16px 0;
      color: #000;
      font-size: 24px;
    }
    .warning-box {
      background: #fff0ed;
      border: 1px solid #e34d59;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .warning-box h3 {
      margin: 0 0 8px 0;
      color: #e34d59;
      font-size: 16px;
    }
    .warning-box p {
      margin: 4px 0;
      color: #666;
      font-size: 14px;
    }
    .test-stats {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
      margin-top: 16px;
    }
    .stat-item {
      padding: 16px;
      border-radius: 6px;
      text-align: center;
    }
    .stat-item.total { background: #e8f3ff; color: #0052d9; }
    .stat-item.success { background: #e8f8f2; color: #00a870; }
    .stat-item.failed { background: #fff0ed; color: #e34d59; }
    .stat-item.pending { background: #fff4e8; color: #ed7b2f; }
    .stat-item.skipped { background: #f3f3f3; color: #999; }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.8;
    }
    .module-section {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e7e7e7;
    }
    .module-title {
      font-size: 18px;
      font-weight: 600;
      color: #000;
    }
    .module-progress {
      font-size: 14px;
      color: #666;
    }
    .test-item {
      display: flex;
      align-items: flex-start;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      background: #f5f5f5;
      transition: all 0.3s;
    }
    .test-item.testing {
      background: #fff4e8;
      border-left: 3px solid #ed7b2f;
    }
    .test-item.success {
      background: #e8f8f2;
      border-left: 3px solid #00a870;
    }
    .test-item.failed {
      background: #fff0ed;
      border-left: 3px solid #e34d59;
    }
    .test-item.skipped {
      background: #f3f3f3;
      border-left: 3px solid #999;
    }
    .test-info {
      flex: 1;
    }
    .test-name {
      font-size: 14px;
      color: #000;
      margin-bottom: 4px;
    }
    .test-desc {
      font-size: 12px;
      color: #666;
    }
    .test-status {
      margin-left: 12px;
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 12px;
      white-space: nowrap;
    }
    .test-status.pending { background: #e7e7e7; color: #666; }
    .test-status.testing { background: #ed7b2f; color: white; }
    .test-status.success { background: #00a870; color: white; }
    .test-status.failed { background: #e34d59; color: white; }
    .test-status.skipped { background: #999; color: white; }
    .test-error {
      color: #e34d59;
      font-size: 12px;
      margin-top: 8px;
      padding: 8px;
      background: #fff;
      border-radius: 4px;
      display: none;
      word-break: break-all;
    }
    .test-item.failed .test-error {
      display: block;
    }
    .test-result {
      color: #00a870;
      font-size: 12px;
      margin-top: 8px;
      padding: 8px;
      background: #fff;
      border-radius: 4px;
      display: none;
      word-break: break-all;
      max-height: 200px;
      overflow-y: auto;
    }
    .test-item.success .test-result {
      display: block;
    }
    .control-panel {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      align-items: center;
    }
    .export-btn {
      margin-left: auto;
    }
    .loading-spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #fff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin-right: 4px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .test-mode-switch {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .cleanup-option {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-left: 16px;
    }
  </style>
</head>
<body>
  <div id="app" class="test-container">
    <div class="test-header">
      <h1>åå°æ¥å£å®Œæ•´æµ‹è¯•ï¼ˆå«å†™å…¥æ“ä½œï¼‰</h1>
      
      <div class="warning-box">
        <h3>âš ï¸ é‡è¦æç¤º</h3>
        <p>1. æœ¬æµ‹è¯•å°†æ‰§è¡Œæ‰€æœ‰ 64 ä¸ªæ¥å£ï¼ŒåŒ…æ‹¬ CREATE/UPDATE/DELETE æ“ä½œ</p>
        <p>2. <strong>åŒ…å«é«˜é£é™©æ“ä½œ</strong>ï¼šé€€æ¬¾ã€æç°å®¡æ ¸ã€æ‰¹é‡ç­¾åˆ°ã€å®¡æ ¸ç”³è¯·ç­‰</p>
        <p>3. æµ‹è¯•ä¼šè‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®ï¼Œå»ºè®®åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒè¿è¡Œ</p>
        <p>4. æµ‹è¯•æ•°æ®ä¼šè‡ªåŠ¨æ·»åŠ æ ‡è®°ï¼ˆtest_data_å¼€å¤´ï¼‰ï¼Œä¾¿äºè¯†åˆ«å’Œæ¸…ç†</p>
        <p>5. æµ‹è¯•å®Œæˆåå¯é€‰æ‹©è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®</p>
      </div>

      <div class="control-panel">
        <div class="test-mode-switch">
          <t-checkbox v-model="testWriteOperations">æµ‹è¯•å†™å…¥æ“ä½œï¼ˆCREATE/UPDATE/DELETEï¼‰</t-checkbox>
        </div>
        <div class="cleanup-option">
          <t-checkbox v-model="autoCleanup">æµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®</t-checkbox>
        </div>
        <t-button theme="primary" @click="startTest" :disabled="testing">
          <span v-if="testing"><span class="loading-spinner"></span>æµ‹è¯•ä¸­...</span>
          <span v-else>å¼€å§‹å®Œæ•´æµ‹è¯•</span>
        </t-button>
        <t-button @click="clearResults" :disabled="testing">æ¸…ç©ºç»“æœ</t-button>
        <t-button @click="cleanupTestData" :disabled="testing" theme="warning">
          æ‰‹åŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
        </t-button>
        <t-button class="export-btn" theme="success" @click="exportReport" :disabled="testResults.length === 0">
          å¯¼å‡ºå®Œæ•´æŠ¥å‘Š
        </t-button>
      </div>

      <div class="test-stats">
        <div class="stat-item total">
          <div class="stat-value">{{ totalTests }}</div>
          <div class="stat-label">æ€»æ¥å£æ•°</div>
        </div>
        <div class="stat-item success">
          <div class="stat-value">{{ successCount }}</div>
          <div class="stat-label">æµ‹è¯•é€šè¿‡</div>
        </div>
        <div class="stat-item failed">
          <div class="stat-value">{{ failedCount }}</div>
          <div class="stat-label">æµ‹è¯•å¤±è´¥</div>
        </div>
        <div class="stat-item pending">
          <div class="stat-value">{{ pendingCount }}</div>
          <div class="stat-label">å¾…æµ‹è¯•</div>
        </div>
        <div class="stat-item skipped">
          <div class="stat-value">{{ skippedCount }}</div>
          <div class="stat-label">å·²è·³è¿‡</div>
        </div>
      </div>
    </div>

    <!-- ç³»ç»Ÿæ¨¡å— -->
    <div class="module-section">
      <div class="module-header">
        <div class="module-title">âš™ï¸ ç³»ç»Ÿæ¨¡å—ï¼ˆ21ä¸ªæ¥å£ï¼‰</div>
        <div class="module-progress">{{ getModuleProgress('system') }}</div>
      </div>
      <div class="test-item" :class="test.status" v-for="test in systemTests" :key="test.id">
        <div class="test-info">
          <div class="test-name">{{ test.name }}</div>
          <div class="test-desc" v-if="test.desc">{{ test.desc }}</div>
          <div class="test-error" v-if="test.error">{{ test.error }}</div>
          <div class="test-result" v-if="test.result">{{ formatResult(test.result) }}</div>
        </div>
        <span class="test-status" :class="test.status">{{ getStatusText(test.status) }}</span>
      </div>
    </div>

    <!-- ç”¨æˆ·æ¨¡å— -->
    <div class="module-section">
      <div class="module-header">
        <div class="module-title">ğŸ‘¥ ç”¨æˆ·æ¨¡å—ï¼ˆ4ä¸ªæ¥å£ï¼‰</div>
        <div class="module-progress">{{ getModuleProgress('user') }}</div>
      </div>
      <div class="test-item" :class="test.status" v-for="test in userTests" :key="test.id">
        <div class="test-info">
          <div class="test-name">{{ test.name }}</div>
          <div class="test-desc" v-if="test.desc">{{ test.desc }}</div>
          <div class="test-error" v-if="test.error">{{ test.error }}</div>
          <div class="test-result" v-if="test.result">{{ formatResult(test.result) }}</div>
        </div>
        <span class="test-status" :class="test.status">{{ getStatusText(test.status) }}</span>
      </div>
    </div>

    <!-- è®¢å•æ¨¡å— -->
    <div class="module-section">
      <div class="module-header">
        <div class="module-title">ğŸ“¦ è®¢å•æ¨¡å—ï¼ˆ4ä¸ªæ¥å£ï¼‰</div>
        <div class="module-progress">{{ getModuleProgress('order') }}</div>
      </div>
      <div class="test-item" :class="test.status" v-for="test in orderTests" :key="test.id">
        <div class="test-info">
          <div class="test-name">{{ test.name }}</div>
          <div class="test-desc" v-if="test.desc">{{ test.desc }}</div>
          <div class="test-error" v-if="test.error">{{ test.error }}</div>
          <div class="test-result" v-if="test.result">{{ formatResult(test.result) }}</div>
        </div>
        <span class="test-status" :class="test.status">{{ getStatusText(test.status) }}</span>
      </div>
    </div>

    <!-- è¯¾ç¨‹æ¨¡å— -->
    <div class="module-section">
      <div class="module-header">
        <div class="module-title">ğŸ“š è¯¾ç¨‹æ¨¡å—ï¼ˆ20ä¸ªæ¥å£ï¼‰</div>
        <div class="module-progress">{{ getModuleProgress('course') }}</div>
      </div>
      <div class="test-item" :class="test.status" v-for="test in courseTests" :key="test.id">
        <div class="test-info">
          <div class="test-name">{{ test.name }}</div>
          <div class="test-desc" v-if="test.desc">{{ test.desc }}</div>
          <div class="test-error" v-if="test.error">{{ test.error }}</div>
          <div class="test-result" v-if="test.result">{{ formatResult(test.result) }}</div>
        </div>
        <span class="test-status" :class="test.status">{{ getStatusText(test.status) }}</span>
      </div>
    </div>

    <!-- å¤§ä½¿æ¨¡å— -->
    <div class="module-section">
      <div class="module-header">
        <div class="module-title">ğŸ–ï¸ å¤§ä½¿æ¨¡å—ï¼ˆ15ä¸ªæ¥å£ï¼‰</div>
        <div class="module-progress">{{ getModuleProgress('ambassador') }}</div>
      </div>
      <div class="test-item" :class="test.status" v-for="test in ambassadorTests" :key="test.id">
        <div class="test-info">
          <div class="test-name">{{ test.name }}</div>
          <div class="test-desc" v-if="test.desc">{{ test.desc }}</div>
          <div class="test-error" v-if="test.error">{{ test.error }}</div>
          <div class="test-result" v-if="test.result">{{ formatResult(test.result) }}</div>
        </div>
        <span class="test-status" :class="test.status">{{ getStatusText(test.status) }}</span>
      </div>
    </div>
  </div>

  <script src="./assets/libs/vue.global.js"></script>
  <script src="./assets/libs/tdesign.min.js"></script>
  <script src="./assets/js/config.js"></script>
  <script src="./assets/js/admin-api.js"></script>

  <script>
    const { createApp, ref, computed } = Vue;

    const app = createApp({
      setup() {
        const testing = ref(false);
        const testResults = ref([]);
        const testWriteOperations = ref(true);
        const autoCleanup = ref(true);
        const createdTestData = ref({
          adminUsers: [],
          announcements: [],
          configs: [],
          feedbacks: [],
          notificationConfigs: [],
          courses: [],
          classRecords: [],
          cases: [],
          materials: [],
          activities: [],
          contractTemplates: []
        });

        // ç”Ÿæˆæµ‹è¯•æ•°æ®æ ‡è®°ï¼ˆç¼©çŸ­ä»¥ç¬¦åˆå­—æ®µé•¿åº¦é™åˆ¶ï¼‰
        const testPrefix = `t${Date.now().toString().slice(-8)}_`;

        // ç³»ç»Ÿæ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼ˆ21ä¸ªï¼‰
        const systemTests = ref([
          { id: 'sys-1', name: '1. login - ç®¡ç†å‘˜ç™»å½•', status: 'pending', module: 'system', type: 'read', api: 'login', desc: 'ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•' },
          { id: 'sys-2', name: '2. getStatistics - è·å–æ•°æ®ç»Ÿè®¡', status: 'pending', module: 'system', type: 'read', api: 'getStatistics', desc: 'è·å–ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®' },
          { id: 'sys-3', name: '3. getAdminUserList - è·å–ç®¡ç†å‘˜åˆ—è¡¨', status: 'pending', module: 'system', type: 'read', api: 'getAdminUserList', desc: 'åˆ†é¡µæŸ¥è¯¢ç®¡ç†å‘˜' },
          { id: 'sys-4', name: '4. createAdminUser - åˆ›å»ºç®¡ç†å‘˜', status: 'pending', module: 'system', type: 'write', api: 'createAdminUser', desc: 'åˆ›å»ºæµ‹è¯•ç®¡ç†å‘˜è´¦å·' },
          { id: 'sys-5', name: '5. updateAdminUser - æ›´æ–°ç®¡ç†å‘˜', status: 'pending', module: 'system', type: 'write', api: 'updateAdminUser', desc: 'æ›´æ–°æµ‹è¯•ç®¡ç†å‘˜ä¿¡æ¯' },
          { id: 'sys-6', name: '6. deleteAdminUser - åˆ é™¤ç®¡ç†å‘˜', status: 'pending', module: 'system', type: 'write', api: 'deleteAdminUser', desc: 'åˆ é™¤æµ‹è¯•ç®¡ç†å‘˜' },
          { id: 'sys-7', name: '7. getConfig - è·å–ç³»ç»Ÿé…ç½®', status: 'pending', module: 'system', type: 'read', api: 'getConfig', desc: 'æŸ¥è¯¢é…ç½®é¡¹' },
          { id: 'sys-8', name: '8. updateConfig - æ›´æ–°ç³»ç»Ÿé…ç½®', status: 'pending', module: 'system', type: 'write', api: 'updateConfig', desc: 'æ›´æ–°é…ç½®é¡¹' },
          { id: 'sys-9', name: '9. getAnnouncementList - è·å–å…¬å‘Šåˆ—è¡¨', status: 'pending', module: 'system', type: 'read', api: 'getAnnouncementList', desc: 'åˆ†é¡µæŸ¥è¯¢å…¬å‘Š' },
          { id: 'sys-10', name: '10. createAnnouncement - åˆ›å»ºå…¬å‘Š', status: 'pending', module: 'system', type: 'write', api: 'createAnnouncement', desc: 'åˆ›å»ºæµ‹è¯•å…¬å‘Š' },
          { id: 'sys-11', name: '11. updateAnnouncement - æ›´æ–°å…¬å‘Š', status: 'pending', module: 'system', type: 'write', api: 'updateAnnouncement', desc: 'æ›´æ–°æµ‹è¯•å…¬å‘Š' },
          { id: 'sys-12', name: '12. deleteAnnouncement - åˆ é™¤å…¬å‘Š', status: 'pending', module: 'system', type: 'write', api: 'deleteAnnouncement', desc: 'åˆ é™¤æµ‹è¯•å…¬å‘Š' },
          { id: 'sys-13', name: '13. getFeedbackList - è·å–åé¦ˆåˆ—è¡¨', status: 'pending', module: 'system', type: 'read', api: 'getFeedbackList', desc: 'åˆ†é¡µæŸ¥è¯¢åé¦ˆ' },
          { id: 'sys-14', name: '14. replyFeedback - å›å¤åé¦ˆ', status: 'pending', module: 'system', type: 'write', api: 'replyFeedback', desc: 'å›å¤ç”¨æˆ·åé¦ˆï¼ˆéœ€è¦çœŸå®åé¦ˆæ•°æ®ï¼‰', skipIfNoData: true },
          { id: 'sys-15', name: '15. getNotificationConfigList - è·å–é€šçŸ¥é…ç½®åˆ—è¡¨', status: 'pending', module: 'system', type: 'read', api: 'getNotificationConfigList', desc: 'æŸ¥è¯¢é€šçŸ¥æ¨¡æ¿' },
          { id: 'sys-16', name: '16. createNotificationConfig - åˆ›å»ºé€šçŸ¥é…ç½®', status: 'pending', module: 'system', type: 'write', api: 'createNotificationConfig', desc: 'åˆ›å»ºé€šçŸ¥æ¨¡æ¿' },
          { id: 'sys-17', name: '17. updateNotificationConfig - æ›´æ–°é€šçŸ¥é…ç½®', status: 'pending', module: 'system', type: 'write', api: 'updateNotificationConfig', desc: 'æ›´æ–°é€šçŸ¥æ¨¡æ¿' },
          { id: 'sys-18', name: '18. getNotificationLogs - è·å–é€šçŸ¥æ—¥å¿—', status: 'pending', module: 'system', type: 'read', api: 'getNotificationLogs', desc: 'æŸ¥è¯¢å‘é€è®°å½•' },
          { id: 'sys-19', name: '19. sendNotification - å‘é€é€šçŸ¥', status: 'pending', module: 'system', type: 'write', api: 'sendNotification', desc: 'å‘é€æµ‹è¯•é€šçŸ¥ï¼ˆéœ€è¦çœŸå®ç”¨æˆ·ï¼‰', skipIfNoData: true },
          { id: 'sys-20', name: '20. getAmbassadorLevelConfigs - è·å–ç­‰çº§é…ç½®', status: 'pending', module: 'system', type: 'read', api: 'getAmbassadorLevelConfigs', desc: 'æŸ¥è¯¢å¤§ä½¿ç­‰çº§' },
          { id: 'sys-21', name: '21. updateAmbassadorLevelConfig - æ›´æ–°ç­‰çº§é…ç½®', status: 'pending', module: 'system', type: 'write', api: 'updateAmbassadorLevelConfig', desc: 'æ›´æ–°ç­‰çº§é…ç½®', skipIfNoData: true },
        ]);

        // ç”¨æˆ·æ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼ˆ4ä¸ªï¼‰
        const userTests = ref([
          { id: 'user-1', name: '1. getUserList - è·å–å­¦å‘˜åˆ—è¡¨', status: 'pending', module: 'user', type: 'read', api: 'getUserList', desc: 'åˆ†é¡µæŸ¥è¯¢å­¦å‘˜' },
          { id: 'user-2', name: '2. getUserDetail - è·å–å­¦å‘˜è¯¦æƒ…', status: 'pending', module: 'user', type: 'read', api: 'getUserDetail', desc: 'æŸ¥è¯¢å­¦å‘˜è¯¦æƒ…', skipIfNoData: true },
          { id: 'user-3', name: '3. updateUserReferee - ä¿®æ”¹æ¨èäºº', status: 'pending', module: 'user', type: 'write', api: 'updateUserReferee', desc: 'ä¿®æ”¹å­¦å‘˜æ¨èäºº', skipIfNoData: true },
          { id: 'user-4', name: '4. getRefereeChangeLogs - è·å–æ¨èäººå˜æ›´è®°å½•', status: 'pending', module: 'user', type: 'read', api: 'getRefereeChangeLogs', desc: 'æŸ¥è¯¢å˜æ›´å†å²', skipIfNoData: true },
        ]);

        // è®¢å•æ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼ˆ4ä¸ªï¼‰
        const orderTests = ref([
          { id: 'order-1', name: '1. getOrderList - è·å–è®¢å•åˆ—è¡¨', status: 'pending', module: 'order', type: 'read', api: 'getOrderList', desc: 'åˆ†é¡µæŸ¥è¯¢è®¢å•' },
          { id: 'order-2', name: '2. getOrderDetail - è·å–è®¢å•è¯¦æƒ…', status: 'pending', module: 'order', type: 'read', api: 'getOrderDetail', desc: 'æŸ¥è¯¢è®¢å•è¯¦æƒ…', skipIfNoData: true },
          { id: 'order-3', name: '3. refund - æ‰§è¡Œé€€æ¬¾', status: 'pending', module: 'order', type: 'write', api: 'refund', desc: 'é€€æ¬¾æ“ä½œï¼ˆéœ€è¦å·²æ”¯ä»˜è®¢å•ï¼‰', skipIfNoData: true },
          { id: 'order-4', name: '4. withdrawAudit - å®¡æ ¸æç°', status: 'pending', module: 'order', type: 'write', api: 'withdrawAudit', desc: 'æç°å®¡æ ¸ï¼ˆéœ€è¦æç°ç”³è¯·ï¼‰', skipIfNoData: true },
        ]);

        // è¯¾ç¨‹æ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼ˆ20ä¸ªï¼‰
        const courseTests = ref([
          { id: 'course-1', name: '1. getCourseList - è·å–è¯¾ç¨‹åˆ—è¡¨', status: 'pending', module: 'course', type: 'read', api: 'getCourseList', desc: 'åˆ†é¡µæŸ¥è¯¢è¯¾ç¨‹' },
          { id: 'course-2', name: '2. createCourse - åˆ›å»ºè¯¾ç¨‹', status: 'pending', module: 'course', type: 'write', api: 'createCourse', desc: 'åˆ›å»ºæµ‹è¯•è¯¾ç¨‹' },
          { id: 'course-3', name: '3. updateCourse - æ›´æ–°è¯¾ç¨‹', status: 'pending', module: 'course', type: 'write', api: 'updateCourse', desc: 'æ›´æ–°æµ‹è¯•è¯¾ç¨‹' },
          { id: 'course-4', name: '4. deleteCourse - åˆ é™¤è¯¾ç¨‹', status: 'pending', module: 'course', type: 'write', api: 'deleteCourse', desc: 'åˆ é™¤æµ‹è¯•è¯¾ç¨‹' },
          { id: 'course-5', name: '5. getClassRecordList - è·å–æ’æœŸåˆ—è¡¨', status: 'pending', module: 'course', type: 'read', api: 'getClassRecordList', desc: 'åˆ†é¡µæŸ¥è¯¢æ’æœŸ' },
          { id: 'course-6', name: '6. createClassRecord - åˆ›å»ºæ’æœŸ', status: 'pending', module: 'course', type: 'write', api: 'createClassRecord', desc: 'åˆ›å»ºæµ‹è¯•æ’æœŸ' },
          { id: 'course-7', name: '7. updateClassRecord - æ›´æ–°æ’æœŸ', status: 'pending', module: 'course', type: 'write', api: 'updateClassRecord', desc: 'æ›´æ–°æµ‹è¯•æ’æœŸ' },
          { id: 'course-8', name: '8. deleteClassRecord - åˆ é™¤æ’æœŸ', status: 'pending', module: 'course', type: 'write', api: 'deleteClassRecord', desc: 'åˆ é™¤æµ‹è¯•æ’æœŸ' },
          { id: 'course-9', name: '9. getAppointmentList - è·å–é¢„çº¦åˆ—è¡¨', status: 'pending', module: 'course', type: 'read', api: 'getAppointmentList', desc: 'åˆ†é¡µæŸ¥è¯¢é¢„çº¦' },
          { id: 'course-10', name: '10. updateAppointmentStatus - æ›´æ–°é¢„çº¦çŠ¶æ€', status: 'pending', module: 'course', type: 'write', api: 'updateAppointmentStatus', desc: 'ä¿®æ”¹é¢„çº¦çŠ¶æ€', skipIfNoData: true },
          { id: 'course-11', name: '11. batchCheckin - æ‰¹é‡ç­¾åˆ°', status: 'pending', module: 'course', type: 'write', api: 'batchCheckin', desc: 'æ‰¹é‡ç­¾åˆ°ï¼ˆéœ€è¦é¢„çº¦è®°å½•ï¼‰', skipIfNoData: true },
          { id: 'course-12', name: '12. getCaseList - è·å–æ¡ˆä¾‹åˆ—è¡¨', status: 'pending', module: 'course', type: 'read', api: 'getCaseList', desc: 'åˆ†é¡µæŸ¥è¯¢æ¡ˆä¾‹' },
          { id: 'course-13', name: '13. createCase - åˆ›å»ºæ¡ˆä¾‹', status: 'pending', module: 'course', type: 'write', api: 'createCase', desc: 'åˆ›å»ºæµ‹è¯•æ¡ˆä¾‹' },
          { id: 'course-14', name: '14. updateCase - æ›´æ–°æ¡ˆä¾‹', status: 'pending', module: 'course', type: 'write', api: 'updateCase', desc: 'æ›´æ–°æµ‹è¯•æ¡ˆä¾‹' },
          { id: 'course-15', name: '15. deleteCase - åˆ é™¤æ¡ˆä¾‹', status: 'pending', module: 'course', type: 'write', api: 'deleteCase', desc: 'åˆ é™¤æµ‹è¯•æ¡ˆä¾‹' },
          { id: 'course-16', name: '16. getMaterialList - è·å–èµ„æ–™åˆ—è¡¨', status: 'pending', module: 'course', type: 'read', api: 'getMaterialList', desc: 'åˆ†é¡µæŸ¥è¯¢èµ„æ–™' },
          { id: 'course-17', name: '17. createMaterial - åˆ›å»ºèµ„æ–™', status: 'pending', module: 'course', type: 'write', api: 'createMaterial', desc: 'åˆ›å»ºæµ‹è¯•èµ„æ–™' },
          { id: 'course-18', name: '18. updateMaterial - æ›´æ–°èµ„æ–™', status: 'pending', module: 'course', type: 'write', api: 'updateMaterial', desc: 'æ›´æ–°æµ‹è¯•èµ„æ–™' },
          { id: 'course-19', name: '19. deleteMaterial - åˆ é™¤èµ„æ–™', status: 'pending', module: 'course', type: 'write', api: 'deleteMaterial', desc: 'åˆ é™¤æµ‹è¯•èµ„æ–™' },
          { id: 'course-20', name: '20. manageAcademyContent - ç®¡ç†å­¦é™¢å†…å®¹', status: 'pending', module: 'course', type: 'write', api: 'manageAcademyContent', desc: 'ç®¡ç†å­¦é™¢å†…å®¹', skipIfNoData: true },
        ]);

        // å¤§ä½¿æ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼ˆ15ä¸ªï¼‰
        const ambassadorTests = ref([
          { id: 'amb-1', name: '1. getAmbassadorList - è·å–å¤§ä½¿åˆ—è¡¨', status: 'pending', module: 'ambassador', type: 'read', api: 'getAmbassadorList', desc: 'åˆ†é¡µæŸ¥è¯¢å¤§ä½¿' },
          { id: 'amb-2', name: '2. getAmbassadorDetail - è·å–å¤§ä½¿è¯¦æƒ…', status: 'pending', module: 'ambassador', type: 'read', api: 'getAmbassadorDetail', desc: 'æŸ¥è¯¢å¤§ä½¿è¯¦æƒ…', skipIfNoData: true },
          { id: 'amb-3', name: '3. getApplicationList - è·å–ç”³è¯·åˆ—è¡¨', status: 'pending', module: 'ambassador', type: 'read', api: 'getApplicationList', desc: 'åˆ†é¡µæŸ¥è¯¢ç”³è¯·' },
          { id: 'amb-4', name: '4. auditApplication - å®¡æ ¸ç”³è¯·', status: 'pending', module: 'ambassador', type: 'write', api: 'auditApplication', desc: 'å®¡æ ¸ç”³è¯·ï¼ˆéœ€è¦ç”³è¯·è®°å½•ï¼‰', skipIfNoData: true },
          { id: 'amb-5', name: '5. getActivityList - è·å–æ´»åŠ¨åˆ—è¡¨', status: 'pending', module: 'ambassador', type: 'read', api: 'getActivityList', desc: 'åˆ†é¡µæŸ¥è¯¢æ´»åŠ¨' },
          { id: 'amb-6', name: '6. createActivity - åˆ›å»ºæ´»åŠ¨', status: 'pending', module: 'ambassador', type: 'write', api: 'createActivity', desc: 'åˆ›å»ºæµ‹è¯•æ´»åŠ¨' },
          { id: 'amb-7', name: '7. updateActivity - æ›´æ–°æ´»åŠ¨', status: 'pending', module: 'ambassador', type: 'write', api: 'updateActivity', desc: 'æ›´æ–°æµ‹è¯•æ´»åŠ¨' },
          { id: 'amb-8', name: '8. deleteActivity - åˆ é™¤æ´»åŠ¨', status: 'pending', module: 'ambassador', type: 'write', api: 'deleteActivity', desc: 'åˆ é™¤æµ‹è¯•æ´»åŠ¨' },
          { id: 'amb-9', name: '9. getContractTemplateList - è·å–åˆçº¦æ¨¡æ¿åˆ—è¡¨', status: 'pending', module: 'ambassador', type: 'read', api: 'getContractTemplateList', desc: 'åˆ†é¡µæŸ¥è¯¢æ¨¡æ¿' },
          { id: 'amb-10', name: '10. createContractTemplate - åˆ›å»ºåˆçº¦æ¨¡æ¿', status: 'pending', module: 'ambassador', type: 'write', api: 'createContractTemplate', desc: 'åˆ›å»ºæµ‹è¯•æ¨¡æ¿' },
          { id: 'amb-11', name: '11. updateContractTemplate - æ›´æ–°åˆçº¦æ¨¡æ¿', status: 'pending', module: 'ambassador', type: 'write', api: 'updateContractTemplate', desc: 'æ›´æ–°æµ‹è¯•æ¨¡æ¿' },
          { id: 'amb-12', name: '12. deleteContractTemplate - åˆ é™¤åˆçº¦æ¨¡æ¿', status: 'pending', module: 'ambassador', type: 'write', api: 'deleteContractTemplate', desc: 'åˆ é™¤æµ‹è¯•æ¨¡æ¿' },
          { id: 'amb-13', name: '13. getSignatureList - è·å–ç­¾çº¦åˆ—è¡¨', status: 'pending', module: 'ambassador', type: 'read', api: 'getSignatureList', desc: 'åˆ†é¡µæŸ¥è¯¢ç­¾çº¦' },
          { id: 'amb-14', name: '14. getContractVersions - è·å–åˆçº¦ç‰ˆæœ¬', status: 'pending', module: 'ambassador', type: 'read', api: 'getContractVersions', desc: 'æŸ¥è¯¢ç‰ˆæœ¬å†å²', skipIfNoData: true },
          { id: 'amb-15', name: '15. getExpiringContracts - è·å–å³å°†åˆ°æœŸåˆçº¦', status: 'pending', module: 'ambassador', type: 'read', api: 'getExpiringContracts', desc: 'æŸ¥è¯¢åˆ°æœŸæé†’' },
        ]);

        // æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
        const allTests = computed(() => [
          ...systemTests.value,
          ...userTests.value,
          ...orderTests.value,
          ...courseTests.value,
          ...ambassadorTests.value
        ]);

        // ç»Ÿè®¡æ•°æ®
        const totalTests = computed(() => allTests.value.length);
        const successCount = computed(() => allTests.value.filter(t => t.status === 'success').length);
        const failedCount = computed(() => allTests.value.filter(t => t.status === 'failed').length);
        const pendingCount = computed(() => allTests.value.filter(t => t.status === 'pending').length);
        const skippedCount = computed(() => allTests.value.filter(t => t.status === 'skipped').length);

        // è·å–æ¨¡å—è¿›åº¦
        const getModuleProgress = (module) => {
          const tests = allTests.value.filter(t => t.module === module);
          const success = tests.filter(t => t.status === 'success').length;
          const failed = tests.filter(t => t.status === 'failed').length;
          const skipped = tests.filter(t => t.status === 'skipped').length;
          const total = tests.length;
          return `${success + failed + skipped}/${total} (æˆåŠŸ: ${success}, å¤±è´¥: ${failed}, è·³è¿‡: ${skipped})`;
        };

        // è·å–çŠ¶æ€æ–‡æœ¬
        const getStatusText = (status) => {
          const map = {
            pending: 'å¾…æµ‹è¯•',
            testing: 'æµ‹è¯•ä¸­',
            success: 'é€šè¿‡',
            failed: 'å¤±è´¥',
            skipped: 'è·³è¿‡'
          };
          return map[status] || status;
        };

        // æ ¼å¼åŒ–ç»“æœ
        const formatResult = (result) => {
          if (typeof result === 'string') return result;
          return JSON.stringify(result, null, 2);
        };

        // æ‰§è¡Œå•ä¸ªæµ‹è¯•
        const runTest = async (test) => {
          // æ£€æŸ¥æ˜¯å¦è·³è¿‡å†™å…¥æ“ä½œ
          if (test.type === 'write' && !testWriteOperations.value) {
            test.status = 'skipped';
            test.result = 'å†™å…¥æ“ä½œå·²ç¦ç”¨';
            return;
          }

          test.status = 'testing';
          test.message = '';
          test.error = '';
          test.result = '';

          try {
            let result;

            // æ‰§è¡Œæµ‹è¯•
            switch (test.api) {
              // ç³»ç»Ÿæ¨¡å—
              case 'login':
                result = await AdminAPI.login('herichen', 'tiandaowenhua');
                break;
              case 'getStatistics':
                result = await AdminAPI.getStatistics();
                break;
              case 'getAdminUserList':
                result = await AdminAPI.getAdminUserList({ page: 1, pageSize: 10 });
                break;
              case 'createAdminUser':
                result = await AdminAPI.createAdminUser({
                  username: testPrefix + 'admin',
                  password: 'test123456',
                  real_name: 'æµ‹è¯•ç®¡ç†å‘˜',
                  role: 'admin'
                });
                if (result && result.id) {
                  createdTestData.value.adminUsers.push(result.id);
                }
                break;
              case 'updateAdminUser':
                if (createdTestData.value.adminUsers.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•ç®¡ç†å‘˜');
                }
                result = await AdminAPI.updateAdminUser({
                  id: createdTestData.value.adminUsers[0],
                  real_name: 'æµ‹è¯•ç®¡ç†å‘˜_å·²æ›´æ–°'
                });
                break;
              case 'deleteAdminUser':
                if (createdTestData.value.adminUsers.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•ç®¡ç†å‘˜');
                }
                const adminId = createdTestData.value.adminUsers.pop();
                result = await AdminAPI.deleteAdminUser(adminId);
                break;
              case 'getConfig':
                result = await AdminAPI.getConfig('system_name');
                break;
              case 'updateConfig':
                result = await AdminAPI.updateConfig(testPrefix + 'test_key', 'test_value');
                break;
              case 'getAnnouncementList':
                result = await AdminAPI.getAnnouncementList({ page: 1, pageSize: 10 });
                break;
              case 'createAnnouncement':
                result = await AdminAPI.createAnnouncement({
                  title: testPrefix + 'æµ‹è¯•å…¬å‘Š',
                  content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•å…¬å‘Šå†…å®¹',
                  type: 1,
                  status: 0
                });
                if (result && result.id) {
                  createdTestData.value.announcements.push(result.id);
                }
                break;
              case 'updateAnnouncement':
                if (createdTestData.value.announcements.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•å…¬å‘Š');
                }
                result = await AdminAPI.updateAnnouncement({
                  id: createdTestData.value.announcements[0],
                  title: testPrefix + 'æµ‹è¯•å…¬å‘Š_å·²æ›´æ–°'
                });
                break;
              case 'deleteAnnouncement':
                if (createdTestData.value.announcements.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•å…¬å‘Š');
                }
                const announcementId = createdTestData.value.announcements.pop();
                result = await AdminAPI.deleteAnnouncement(announcementId);
                break;
              case 'getFeedbackList':
                result = await AdminAPI.getFeedbackList({ page: 1, pageSize: 10 });
                break;
              case 'replyFeedback':
                // æŸ¥æ‰¾æœªå›å¤çš„åé¦ˆ
                const feedbackList = await AdminAPI.getFeedbackList({ page: 1, pageSize: 10, status: 0 });
                if (feedbackList && feedbackList.list && feedbackList.list.length > 0) {
                  result = await AdminAPI.replyFeedback(
                    feedbackList.list[0].id,
                    'æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•å›å¤'
                  );
                } else {
                  throw new Error('æ²¡æœ‰æœªå›å¤çš„åé¦ˆ');
                }
                break;
              case 'getNotificationConfigList':
                result = await AdminAPI.getNotificationConfigList({ page: 1, pageSize: 10 });
                break;
              case 'createNotificationConfig':
                result = await AdminAPI.createNotificationConfig({
                  name: testPrefix + 'æµ‹è¯•é€šçŸ¥æ¨¡æ¿',
                  description: 'æµ‹è¯•é€šçŸ¥æ¨¡æ¿æè¿°',
                  template_id: 'test_template_001',
                  scene: 'test_scene'
                });
                if (result && result.id) {
                  createdTestData.value.notificationConfigs.push(result.id);
                }
                break;
              case 'updateNotificationConfig':
                if (createdTestData.value.notificationConfigs.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•é€šçŸ¥é…ç½®');
                }
                result = await AdminAPI.updateNotificationConfig({
                  id: createdTestData.value.notificationConfigs[0],
                  template_name: testPrefix + 'æµ‹è¯•é€šçŸ¥æ¨¡æ¿_å·²æ›´æ–°'
                });
                break;
              case 'getNotificationLogs':
                result = await AdminAPI.getNotificationLogs({ page: 1, pageSize: 10 });
                break;
              case 'sendNotification':
                // æŸ¥æ‰¾ç”¨æˆ·åˆ—è¡¨
                const userListForNotif = await AdminAPI.getUserList({ page: 1, pageSize: 1 });
                if (userListForNotif && userListForNotif.list && userListForNotif.list.length > 0) {
                  result = await AdminAPI.sendNotification({
                    user_ids: [userListForNotif.list[0].id],
                    template_id: createdTestData.value.notificationConfigs[0] || 1,
                    content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•é€šçŸ¥'
                  });
                } else {
                  throw new Error('æ²¡æœ‰å¯ç”¨çš„ç”¨æˆ·å‘é€é€šçŸ¥');
                }
                break;
              case 'getAmbassadorLevelConfigs':
                result = await AdminAPI.getAmbassadorLevelConfigs();
                break;
              case 'updateAmbassadorLevelConfig':
                // è·å–ç­‰çº§é…ç½®
                const levelConfigs = await AdminAPI.getAmbassadorLevelConfigs();
                if (levelConfigs && levelConfigs.length > 0) {
                  result = await AdminAPI.updateAmbassadorLevelConfig({
                    level: levelConfigs[0].level,
                    name: levelConfigs[0].name + '_æµ‹è¯•æ›´æ–°'
                  });
                } else {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„ç­‰çº§é…ç½®');
                }
                break;

              // ç”¨æˆ·æ¨¡å—
              case 'getUserList':
                result = await AdminAPI.getUserList({ page: 1, pageSize: 10 });
                break;
              case 'getUserDetail':
                // ä»ç”¨æˆ·åˆ—è¡¨ä¸­è·å–ç¬¬ä¸€ä¸ªç”¨æˆ·
                const userListForDetail = await AdminAPI.getUserList({ page: 1, pageSize: 1 });
                if (userListForDetail && userListForDetail.list && userListForDetail.list.length > 0) {
                  result = await AdminAPI.getUserDetail(userListForDetail.list[0].id);
                } else {
                  throw new Error('æ²¡æœ‰å¯æŸ¥è¯¢çš„ç”¨æˆ·');
                }
                break;
              case 'updateUserReferee':
                // è·å–è‡³å°‘2ä¸ªç”¨æˆ·
                const usersForReferee = await AdminAPI.getUserList({ page: 1, pageSize: 2 });
                if (usersForReferee && usersForReferee.list && usersForReferee.list.length >= 2) {
                  result = await AdminAPI.updateUserReferee(
                    usersForReferee.list[0].id,
                    usersForReferee.list[1].id,
                    'æµ‹è¯•ä¿®æ”¹æ¨èäºº'
                  );
                } else {
                  throw new Error('æ²¡æœ‰è¶³å¤Ÿçš„ç”¨æˆ·è¿›è¡Œæ¨èäººä¿®æ”¹');
                }
                break;
              case 'getRefereeChangeLogs':
                // ä»ç”¨æˆ·åˆ—è¡¨ä¸­è·å–ç¬¬ä¸€ä¸ªç”¨æˆ·çš„å˜æ›´è®°å½•
                const userListForLogs = await AdminAPI.getUserList({ page: 1, pageSize: 1 });
                if (userListForLogs && userListForLogs.list && userListForLogs.list.length > 0) {
                  result = await AdminAPI.getRefereeChangeLogs(userListForLogs.list[0].id, { page: 1, pageSize: 10 });
                } else {
                  throw new Error('æ²¡æœ‰å¯æŸ¥è¯¢çš„ç”¨æˆ·');
                }
                break;

              // è®¢å•æ¨¡å—
              case 'getOrderList':
                result = await AdminAPI.getOrderList({ page: 1, pageSize: 10 });
                break;
              case 'getOrderDetail':
                // ä»è®¢å•åˆ—è¡¨ä¸­è·å–ç¬¬ä¸€ä¸ªè®¢å•
                const orderList = await AdminAPI.getOrderList({ page: 1, pageSize: 1 });
                if (orderList && orderList.list && orderList.list.length > 0) {
                  result = await AdminAPI.getOrderDetail(orderList.list[0].order_no);
                } else {
                  throw new Error('æ²¡æœ‰å¯æŸ¥è¯¢çš„è®¢å•');
                }
                break;
              case 'refund':
                // æŸ¥æ‰¾å·²æ”¯ä»˜çš„è®¢å•
                const paidOrders = await AdminAPI.getOrderList({ page: 1, pageSize: 10, status: 2 });
                if (paidOrders && paidOrders.list && paidOrders.list.length > 0) {
                  result = await AdminAPI.refund(
                    paidOrders.list[0].order_no,
                    'æµ‹è¯•é€€æ¬¾'
                  );
                } else {
                  throw new Error('æ²¡æœ‰å·²æ”¯ä»˜çš„è®¢å•å¯é€€æ¬¾');
                }
                break;
              case 'withdrawAudit':
                // æŸ¥æ‰¾å¾…å®¡æ ¸çš„æç°ç”³è¯·
                const withdrawList = await AdminAPI.getOrderList({ page: 1, pageSize: 10, type: 'withdraw', status: 0 });
                if (withdrawList && withdrawList.list && withdrawList.list.length > 0) {
                  result = await AdminAPI.withdrawAudit(
                    withdrawList.list[0].id,
                    1, // å®¡æ ¸é€šè¿‡
                    'æµ‹è¯•å®¡æ ¸é€šè¿‡'
                  );
                } else {
                  throw new Error('æ²¡æœ‰å¾…å®¡æ ¸çš„æç°ç”³è¯·');
                }
                break;

              // è¯¾ç¨‹æ¨¡å—
              case 'getCourseList':
                result = await AdminAPI.getCourseList({ page: 1, pageSize: 10 });
                break;
              case 'createCourse':
                result = await AdminAPI.createCourse({
                  name: testPrefix + 'æµ‹è¯•è¯¾ç¨‹',
                  type: 1,
                  price: 99900,
                  description: 'æµ‹è¯•è¯¾ç¨‹æè¿°'
                });
                if (result && result.id) {
                  createdTestData.value.courses.push(result.id);
                }
                break;
              case 'updateCourse':
                if (createdTestData.value.courses.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•è¯¾ç¨‹');
                }
                result = await AdminAPI.updateCourse({
                  id: createdTestData.value.courses[0],
                  name: testPrefix + 'æµ‹è¯•è¯¾ç¨‹_å·²æ›´æ–°'
                });
                break;
              case 'deleteCourse':
                if (createdTestData.value.courses.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•è¯¾ç¨‹');
                }
                const courseId = createdTestData.value.courses.pop();
                result = await AdminAPI.deleteCourse(courseId);
                break;
              case 'getClassRecordList':
                result = await AdminAPI.getClassRecordList({ page: 1, pageSize: 10 });
                break;
              case 'createClassRecord':
                if (createdTestData.value.courses.length === 0) {
                  // å…ˆåˆ›å»ºä¸€ä¸ªè¯¾ç¨‹
                  const course = await AdminAPI.createCourse({
                    name: testPrefix + 'æµ‹è¯•è¯¾ç¨‹_for_record',
                    type: 1,
                    price: 99900
                  });
                  createdTestData.value.courses.push(course.id);
                }
                result = await AdminAPI.createClassRecord({
                  course_id: createdTestData.value.courses[0],
                  class_date: '2026-03-01',
                  start_time: '09:00',
                  end_time: '12:00',
                  location: 'æµ‹è¯•åœ°ç‚¹',
                  max_students: 30
                });
                if (result && result.id) {
                  createdTestData.value.classRecords.push(result.id);
                }
                break;
              case 'updateClassRecord':
                if (createdTestData.value.classRecords.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•æ’æœŸ');
                }
                result = await AdminAPI.updateClassRecord({
                  id: createdTestData.value.classRecords[0],
                  location: 'æµ‹è¯•åœ°ç‚¹_å·²æ›´æ–°'
                });
                break;
              case 'deleteClassRecord':
                if (createdTestData.value.classRecords.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•æ’æœŸ');
                }
                const recordId = createdTestData.value.classRecords.pop();
                result = await AdminAPI.deleteClassRecord(recordId);
                break;
              case 'getAppointmentList':
                result = await AdminAPI.getAppointmentList({ page: 1, pageSize: 10 });
                break;
              case 'updateAppointmentStatus':
                // æŸ¥æ‰¾å¾…å®¡æ ¸çš„é¢„çº¦
                const appointments = await AdminAPI.getAppointmentList({ page: 1, pageSize: 10, status: 0 });
                if (appointments && appointments.list && appointments.list.length > 0) {
                  result = await AdminAPI.updateAppointmentStatus(
                    appointments.list[0].id,
                    1 // å®¡æ ¸é€šè¿‡
                  );
                } else {
                  throw new Error('æ²¡æœ‰å¾…å®¡æ ¸çš„é¢„çº¦');
                }
                break;
              case 'batchCheckin':
                // æŸ¥æ‰¾å·²é€šè¿‡çš„é¢„çº¦
                const approvedAppointments = await AdminAPI.getAppointmentList({ page: 1, pageSize: 10, status: 1 });
                if (approvedAppointments && approvedAppointments.list && approvedAppointments.list.length > 0) {
                  result = await AdminAPI.batchCheckin([approvedAppointments.list[0].id]);
                } else {
                  throw new Error('æ²¡æœ‰å·²é€šè¿‡çš„é¢„çº¦å¯ç­¾åˆ°');
                }
                break;
              case 'getCaseList':
                result = await AdminAPI.getCaseList({ page: 1, pageSize: 10 });
                break;
              case 'createCase':
                result = await AdminAPI.createCase({
                  title: testPrefix + 'æµ‹è¯•æ¡ˆä¾‹',
                  content: 'æµ‹è¯•æ¡ˆä¾‹å†…å®¹',
                  images: []
                });
                if (result && result.id) {
                  createdTestData.value.cases.push(result.id);
                }
                break;
              case 'updateCase':
                if (createdTestData.value.cases.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•æ¡ˆä¾‹');
                }
                result = await AdminAPI.updateCase({
                  id: createdTestData.value.cases[0],
                  title: testPrefix + 'æµ‹è¯•æ¡ˆä¾‹_å·²æ›´æ–°'
                });
                break;
              case 'deleteCase':
                if (createdTestData.value.cases.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•æ¡ˆä¾‹');
                }
                const caseId = createdTestData.value.cases.pop();
                result = await AdminAPI.deleteCase(caseId);
                break;
              case 'getMaterialList':
                result = await AdminAPI.getMaterialList({ page: 1, pageSize: 10 });
                break;
              case 'createMaterial':
                result = await AdminAPI.createMaterial({
                  title: testPrefix + 'æµ‹è¯•èµ„æ–™',
                  type: 1,
                  file_url: 'https://test.com/file.pdf'
                });
                if (result && result.id) {
                  createdTestData.value.materials.push(result.id);
                }
                break;
              case 'updateMaterial':
                if (createdTestData.value.materials.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•èµ„æ–™');
                }
                result = await AdminAPI.updateMaterial({
                  id: createdTestData.value.materials[0],
                  title: testPrefix + 'æµ‹è¯•èµ„æ–™_å·²æ›´æ–°'
                });
                break;
              case 'deleteMaterial':
                if (createdTestData.value.materials.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•èµ„æ–™');
                }
                const materialId = createdTestData.value.materials.pop();
                result = await AdminAPI.deleteMaterial(materialId);
                break;
              case 'manageAcademyContent':
                // ç®¡ç†å­¦é™¢å†…å®¹ï¼ˆåˆ›å»º/æ›´æ–°/åˆ é™¤ï¼‰
                result = await AdminAPI.manageAcademyContent({
                  action: 'create',
                  type: 'video',
                  title: testPrefix + 'æµ‹è¯•å­¦é™¢è§†é¢‘',
                  content_url: 'https://test.com/video.mp4'
                });
                break;

              // å¤§ä½¿æ¨¡å—
              case 'getAmbassadorList':
                result = await AdminAPI.getAmbassadorList({ page: 1, pageSize: 10 });
                break;
              case 'getAmbassadorDetail':
                // ä»å¤§ä½¿åˆ—è¡¨ä¸­è·å–ç¬¬ä¸€ä¸ªå¤§ä½¿
                const ambassadorList = await AdminAPI.getAmbassadorList({ page: 1, pageSize: 1 });
                if (ambassadorList && ambassadorList.list && ambassadorList.list.length > 0) {
                  result = await AdminAPI.getAmbassadorDetail(ambassadorList.list[0].id);
                } else {
                  throw new Error('æ²¡æœ‰å¯æŸ¥è¯¢çš„å¤§ä½¿');
                }
                break;
              case 'getApplicationList':
                result = await AdminAPI.getApplicationList({ page: 1, pageSize: 10 });
                break;
              case 'auditApplication':
                // æŸ¥æ‰¾å¾…å®¡æ ¸çš„ç”³è¯·
                const applicationList = await AdminAPI.getApplicationList({ page: 1, pageSize: 10, status: 0 });
                if (applicationList && applicationList.list && applicationList.list.length > 0) {
                  result = await AdminAPI.auditApplication(
                    applicationList.list[0].id,
                    1, // å®¡æ ¸é€šè¿‡
                    'æµ‹è¯•å®¡æ ¸é€šè¿‡'
                  );
                } else {
                  throw new Error('æ²¡æœ‰å¾…å®¡æ ¸çš„å¤§ä½¿ç”³è¯·');
                }
                break;
              case 'getActivityList':
                result = await AdminAPI.getActivityList({ page: 1, pageSize: 10 });
                break;
              case 'createActivity':
                result = await AdminAPI.createActivity({
                  name: testPrefix + 'æµ‹è¯•æ´»åŠ¨',
                  description: 'æµ‹è¯•æ´»åŠ¨æè¿°',
                  start_date: '2026-03-01',
                  end_date: '2026-03-31'
                });
                if (result && result.id) {
                  createdTestData.value.activities.push(result.id);
                }
                break;
              case 'updateActivity':
                if (createdTestData.value.activities.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•æ´»åŠ¨');
                }
                result = await AdminAPI.updateActivity({
                  id: createdTestData.value.activities[0],
                  name: testPrefix + 'æµ‹è¯•æ´»åŠ¨_å·²æ›´æ–°'
                });
                break;
              case 'deleteActivity':
                if (createdTestData.value.activities.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•æ´»åŠ¨');
                }
                const activityId = createdTestData.value.activities.pop();
                result = await AdminAPI.deleteActivity(activityId);
                break;
              case 'getContractTemplateList':
                result = await AdminAPI.getContractTemplateList({ page: 1, pageSize: 10 });
                break;
              case 'createContractTemplate':
                result = await AdminAPI.createContractTemplate({
                  template_name: testPrefix + 'æµ‹è¯•åˆçº¦æ¨¡æ¿',
                  content: 'æµ‹è¯•åˆçº¦å†…å®¹',
                  level: 1
                });
                if (result && result.id) {
                  createdTestData.value.contractTemplates.push(result.id);
                }
                break;
              case 'updateContractTemplate':
                if (createdTestData.value.contractTemplates.length === 0) {
                  throw new Error('æ²¡æœ‰å¯æ›´æ–°çš„æµ‹è¯•åˆçº¦æ¨¡æ¿');
                }
                result = await AdminAPI.updateContractTemplate({
                  id: createdTestData.value.contractTemplates[0],
                  template_name: testPrefix + 'æµ‹è¯•åˆçº¦æ¨¡æ¿_å·²æ›´æ–°'
                });
                break;
              case 'deleteContractTemplate':
                if (createdTestData.value.contractTemplates.length === 0) {
                  throw new Error('æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•åˆçº¦æ¨¡æ¿');
                }
                const templateId = createdTestData.value.contractTemplates.pop();
                result = await AdminAPI.deleteContractTemplate(templateId);
                break;
              case 'getSignatureList':
                result = await AdminAPI.getSignatureList({ page: 1, pageSize: 10 });
                break;
              case 'getContractVersions':
                // ä»åˆçº¦æ¨¡æ¿åˆ—è¡¨ä¸­è·å–ç¬¬ä¸€ä¸ªæ¨¡æ¿çš„ç‰ˆæœ¬å†å²
                const templateList = await AdminAPI.getContractTemplateList({ page: 1, pageSize: 1 });
                if (templateList && templateList.list && templateList.list.length > 0) {
                  result = await AdminAPI.getContractVersions(templateList.list[0].id);
                } else if (createdTestData.value.contractTemplates.length > 0) {
                  result = await AdminAPI.getContractVersions(createdTestData.value.contractTemplates[0]);
                } else {
                  throw new Error('æ²¡æœ‰å¯æŸ¥è¯¢ç‰ˆæœ¬çš„åˆçº¦æ¨¡æ¿');
                }
                break;
              case 'getExpiringContracts':
                result = await AdminAPI.getExpiringContracts(30);
                break;

              default:
                throw new Error('æœªå®ç°çš„æµ‹è¯•æ¥å£: ' + test.api);
            }

            test.status = 'success';
            test.result = result;
            testResults.value.push({
              ...test,
              result,
              timestamp: new Date().toISOString()
            });

          } catch (error) {
            if (test.skipIfNoData && (error.message.includes('ä¸å­˜åœ¨') || error.message.includes('æœªæ‰¾åˆ°'))) {
              test.status = 'success';
              test.result = 'æ¥å£æ­£å¸¸ï¼ˆæ•°æ®ä¸å­˜åœ¨ï¼‰';
            } else {
              test.status = 'failed';
              test.error = error.message;
            }

            testResults.value.push({
              ...test,
              error: error.message,
              timestamp: new Date().toISOString()
            });
          }

          // å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡å¿«
          await new Promise(resolve => setTimeout(resolve, 200));
        };

        // å¼€å§‹æµ‹è¯•
        const startTest = async () => {
          if (!confirm('ç¡®å®šè¦å¼€å§‹å®Œæ•´æµ‹è¯•å—ï¼Ÿè¿™å°†æ‰§è¡Œæ‰€æœ‰ 64 ä¸ªæ¥å£ï¼ˆåŒ…æ‹¬å†™å…¥æ“ä½œï¼‰ã€‚')) {
            return;
          }

          testing.value = true;
          testResults.value = [];
          createdTestData.value = {
            adminUsers: [],
            announcements: [],
            configs: [],
            feedbacks: [],
            notificationConfigs: [],
            courses: [],
            classRecords: [],
            cases: [],
            materials: [],
            activities: [],
            contractTemplates: []
          };

          // é‡ç½®æ‰€æœ‰æµ‹è¯•çŠ¶æ€
          [...systemTests.value, ...userTests.value, ...orderTests.value, ...courseTests.value, ...ambassadorTests.value]
            .forEach(test => {
              test.status = 'pending';
              test.message = '';
              test.error = '';
              test.result = '';
            });

          try {
            // 1. æµ‹è¯•ç™»å½•
            await runTest(systemTests.value[0]);

            if (systemTests.value[0].status === 'failed') {
              TDesign.MessagePlugin.error('ç™»å½•å¤±è´¥ï¼Œæ— æ³•ç»§ç»­æµ‹è¯•');
              testing.value = false;
              return;
            }

            // 2. æµ‹è¯•å…¶ä»–ç³»ç»Ÿæ¥å£
            for (let i = 1; i < systemTests.value.length; i++) {
              await runTest(systemTests.value[i]);
            }

            // 3. æµ‹è¯•ç”¨æˆ·æ¨¡å—
            for (const test of userTests.value) {
              await runTest(test);
            }

            // 4. æµ‹è¯•è®¢å•æ¨¡å—
            for (const test of orderTests.value) {
              await runTest(test);
            }

            // 5. æµ‹è¯•è¯¾ç¨‹æ¨¡å—
            for (const test of courseTests.value) {
              await runTest(test);
            }

            // 6. æµ‹è¯•å¤§ä½¿æ¨¡å—
            for (const test of ambassadorTests.value) {
              await runTest(test);
            }

            TDesign.MessagePlugin.success('æµ‹è¯•å®Œæˆï¼');

            // 7. è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
            if (autoCleanup.value) {
              await cleanupTestData();
            }

          } catch (error) {
            TDesign.MessagePlugin.error('æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š' + error.message);
          } finally {
            testing.value = false;
          }
        };

        // æ¸…ç†æµ‹è¯•æ•°æ®
        const cleanupTestData = async () => {
          if (!testing.value && !confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿ')) {
            return;
          }

          try {
            TDesign.MessagePlugin.info('æ­£åœ¨æ¸…ç†æµ‹è¯•æ•°æ®...');

            // æ¸…ç†é€»è¾‘ï¼ˆåå‘åˆ é™¤ï¼Œé¿å…å¤–é”®çº¦æŸï¼‰
            for (const id of createdTestData.value.classRecords) {
              try {
                await AdminAPI.deleteClassRecord(id);
              } catch (e) {
                console.error('åˆ é™¤æ’æœŸå¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.courses) {
              try {
                await AdminAPI.deleteCourse(id);
              } catch (e) {
                console.error('åˆ é™¤è¯¾ç¨‹å¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.announcements) {
              try {
                await AdminAPI.deleteAnnouncement(id);
              } catch (e) {
                console.error('åˆ é™¤å…¬å‘Šå¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.adminUsers) {
              try {
                await AdminAPI.deleteAdminUser(id);
              } catch (e) {
                console.error('åˆ é™¤ç®¡ç†å‘˜å¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.cases) {
              try {
                await AdminAPI.deleteCase(id);
              } catch (e) {
                console.error('åˆ é™¤æ¡ˆä¾‹å¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.materials) {
              try {
                await AdminAPI.deleteMaterial(id);
              } catch (e) {
                console.error('åˆ é™¤èµ„æ–™å¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.activities) {
              try {
                await AdminAPI.deleteActivity(id);
              } catch (e) {
                console.error('åˆ é™¤æ´»åŠ¨å¤±è´¥:', e);
              }
            }

            for (const id of createdTestData.value.contractTemplates) {
              try {
                await AdminAPI.deleteContractTemplate(id);
              } catch (e) {
                console.error('åˆ é™¤åˆçº¦æ¨¡æ¿å¤±è´¥:', e);
              }
            }

            TDesign.MessagePlugin.success('æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆï¼');

            // é‡ç½®
            createdTestData.value = {
              adminUsers: [],
              announcements: [],
              configs: [],
              feedbacks: [],
              notificationConfigs: [],
              courses: [],
              classRecords: [],
              cases: [],
              materials: [],
              activities: [],
              contractTemplates: []
            };

          } catch (error) {
            TDesign.MessagePlugin.error('æ¸…ç†æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ï¼š' + error.message);
          }
        };

        // æ¸…ç©ºç»“æœ
        const clearResults = () => {
          [...systemTests.value, ...userTests.value, ...orderTests.value, ...courseTests.value, ...ambassadorTests.value]
            .forEach(test => {
              test.status = 'pending';
              test.message = '';
              test.error = '';
              test.result = '';
            });
          testResults.value = [];
          TDesign.MessagePlugin.success('å·²æ¸…ç©ºæµ‹è¯•ç»“æœ');
        };

        // å¯¼å‡ºæŠ¥å‘Š
        const exportReport = () => {
          const report = {
            æµ‹è¯•æ—¶é—´: new Date().toLocaleString('zh-CN'),
            æµ‹è¯•æ¨¡å¼: testWriteOperations.value ? 'å®Œæ•´æµ‹è¯•ï¼ˆå«å†™å…¥ï¼‰' : 'åªè¯»æµ‹è¯•',
            æ€»æ¥å£æ•°: totalTests.value,
            æµ‹è¯•é€šè¿‡: successCount.value,
            æµ‹è¯•å¤±è´¥: failedCount.value,
            å·²è·³è¿‡: skippedCount.value,
            é€šè¿‡ç‡: ((successCount.value / (totalTests.value - skippedCount.value) * 100).toFixed(2) + '%'),
            åˆ›å»ºçš„æµ‹è¯•æ•°æ®: createdTestData.value,
            è¯¦ç»†ç»“æœ: testResults.value.map(t => ({
              æ¨¡å—: t.module,
              æ¥å£åç§°: t.name,
              API: t.api,
              ç±»å‹: t.type,
              çŠ¶æ€: getStatusText(t.status),
              æè¿°: t.desc,
              ç»“æœ: t.result,
              é”™è¯¯: t.error || '',
              æ—¶é—´: t.timestamp
            }))
          };

          const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `åå°æ¥å£å®Œæ•´æµ‹è¯•æŠ¥å‘Š_${new Date().getTime()}.json`;
          a.click();
          URL.revokeObjectURL(url);

          TDesign.MessagePlugin.success('æŠ¥å‘Šå·²å¯¼å‡º');
        };

        return {
          testing,
          testResults,
          testWriteOperations,
          autoCleanup,
          systemTests,
          userTests,
          orderTests,
          courseTests,
          ambassadorTests,
          totalTests,
          successCount,
          failedCount,
          pendingCount,
          skippedCount,
          getModuleProgress,
          getStatusText,
          formatResult,
          startTest,
          clearResults,
          cleanupTestData,
          exportReport
        };
      }
    });

    app.use(TDesign);
    app.mount('#app');
  </script>
</body>
</html>

