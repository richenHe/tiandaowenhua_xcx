# 后台接口自动化测试工具

## 📋 功能说明

这是一个全面的后台管理接口自动化测试HTML脚本，用于测试天道文化小程序的所有后台管理接口。

### 核心特性

- ✅ **全接口覆盖**: 测试所有 66 个后台管理接口，一个不漏
- ✅ **先写后读验证**: 写操作后自动读取数据验证
- ✅ **智能依赖处理**: 自动处理接口间的依赖关系（如先创建再更新）
- ✅ **实时可视化**: 实时显示测试进度和结果
- ✅ **详细日志**: 完整的测试日志和错误信息
- ✅ **报告导出**: 支持导出 JSON 格式测试报告

## 🚀 使用方法

### 1. 打开测试页面

```bash
# 在浏览器中打开
d:\project\cursor\work\xcx\admin\test-api.html
```

### 2. 配置测试参数

- **环境ID**: 默认 `cloud1-0gnn3mn17b581124`
- **管理员账号**: 默认 `admin`
- **管理员密码**: 默认 `admin123`

### 3. 开始测试

点击以下按钮之一：

- **🚀 开始全量测试**: 测试所有接口（包括读和写操作）
- **📖 仅测试读接口**: 只测试读操作，跳过写操作
- **🗑️ 清空结果**: 清空当前测试结果
- **📊 导出报告**: 导出 JSON 格式的测试报告

## 📊 测试覆盖

### 模块统计

| 模块 | 接口数 | 读操作 | 写操作 |
|------|--------|--------|--------|
| 系统管理 (System) | 21 | 9 | 12 |
| 用户管理 (User) | 4 | 3 | 1 |
| 订单管理 (Order) | 6 | 4 | 2 |
| 课程管理 (Course) | 20 | 8 | 12 |
| 大使管理 (Ambassador) | 15 | 7 | 8 |
| **总计** | **66** | **31** | **35** |

### 详细接口列表

#### 系统管理模块 (21个)

**身份认证**
- ✅ 管理员登录

**系统配置**
- ✅ 获取系统配置
- ✅ 更新系统配置
- ✅ 获取统计数据

**管理员管理**
- ✅ 获取管理员列表
- ✅ 创建管理员
- ✅ 更新管理员
- ✅ 删除管理员

**公告管理**
- ✅ 获取公告列表
- ✅ 创建公告
- ✅ 更新公告
- ✅ 删除公告

**反馈管理**
- ✅ 获取反馈列表
- ✅ 回复反馈

**通知管理**
- ✅ 获取通知配置列表
- ✅ 创建通知配置
- ✅ 更新通知配置
- ✅ 获取通知日志

**大使等级配置**
- ✅ 获取大使等级配置
- ✅ 更新大使等级配置
- ✅ 初始化大使等级配置

#### 用户管理模块 (4个)

- ✅ 获取学员列表
- ✅ 获取学员详情
- ✅ 修改学员推荐人
- ✅ 获取推荐人变更日志

#### 订单管理模块 (6个)

- ✅ 获取订单列表
- ✅ 获取订单详情
- ✅ 获取退款列表
- ✅ 管理员退款
- ✅ 获取提现列表
- ✅ 审核提现申请

#### 课程管理模块 (20个)

**课程管理**
- ✅ 获取课程列表
- ✅ 创建课程
- ✅ 更新课程
- ✅ 删除课程

**上课排期**
- ✅ 获取上课排期列表
- ✅ 创建上课排期
- ✅ 更新上课排期
- ✅ 删除上课排期

**预约管理**
- ✅ 获取预约列表
- ✅ 更新预约状态
- ✅ 批量签到

**案例管理**
- ✅ 获取案例列表
- ✅ 创建案例
- ✅ 更新案例
- ✅ 删除案例

**资料管理**
- ✅ 获取资料列表
- ✅ 创建资料
- ✅ 更新资料
- ✅ 删除资料

**商学院**
- ✅ 管理商学院内容

#### 大使管理模块 (15个)

**大使管理**
- ✅ 获取大使列表
- ✅ 获取大使详情

**申请管理**
- ✅ 获取大使申请列表
- ✅ 审核大使申请

**活动管理**
- ✅ 获取活动列表
- ✅ 创建活动
- ✅ 更新活动
- ✅ 删除活动

**协议模板**
- ✅ 获取协议模板列表
- ✅ 创建协议模板
- ✅ 更新协议模板
- ✅ 删除协议模板
- ✅ 获取协议版本历史

**签署管理**
- ✅ 获取签署列表
- ✅ 获取即将到期协议

## 🔍 测试标准

### 通过标准

1. **无报错**: 接口调用不抛出异常
2. **返回成功**: `result.success === true`
3. **数据验证**: 写操作能读到数据
4. **参数正确**: 返回预期的参数结构

### 写操作验证流程

```
创建 → 读取验证 → 更新 → 读取验证 → 删除 → 读取验证
```

例如：
1. 创建课程 → 保存课程ID
2. 获取课程列表 → 验证新课程存在
3. 更新课程 → 使用保存的ID
4. 获取课程详情 → 验证更新成功
5. 删除课程 → 使用保存的ID
6. 获取课程列表 → 验证已删除

## 📈 测试报告

### 实时统计

测试页面顶部显示实时统计：
- 总接口数
- 测试通过数
- 测试失败数
- 待测试数
- 进度条

### 模块结果

每个模块显示：
- 模块名称
- 总接口数
- 成功数
- 失败数
- 可展开查看详细结果

### 接口详情

每个接口显示：
- 接口名称
- 云函数名.action
- 操作类型（读/写）
- 测试状态（通过/失败/待测试）
- 响应时间（毫秒）
- 返回数据或错误信息

### 导出报告

点击"导出报告"按钮，生成 JSON 文件：

```json
{
  "timestamp": "2026-02-13T10:30:00.000Z",
  "summary": {
    "total": 66,
    "success": 60,
    "error": 6,
    "pending": 0,
    "successRate": "90.91%"
  },
  "modules": {
    "system": {
      "title": "系统管理模块 (21个接口)",
      "apis": [...]
    },
    ...
  }
}
```

## 🎨 界面特性

### 视觉设计

- 渐变色卡片设计
- 实时动画效果
- 响应式布局
- 暗色日志控制台

### 交互功能

- 点击模块标题展开/收起接口列表
- 实时滚动日志
- 进度条动画
- 状态图标（✓ 成功 / ✗ 失败 / ⏳ 待测试）

## ⚙️ 技术实现

### 依赖处理

自动识别接口依赖关系：

```javascript
// 更新操作依赖创建操作
if (api.action.includes('update')) {
  const createApi = findCreateApi();
  if (!testData.createdIds[createApi.action]) {
    await runApiTest(moduleName, createApi);
  }
}
```

### 数据存储

测试过程中保存创建的数据ID：

```javascript
testData = {
  createdIds: {
    adminUser: 'xxx',
    announcement: 'xxx',
    course: 'xxx',
    ...
  }
}
```

### 错误处理

完善的错误捕获和日志记录：

```javascript
try {
  const result = await api.test();
  if (result.success) {
    updateApiStatus('success', result.data);
  } else {
    updateApiStatus('error', result.error);
  }
} catch (error) {
  updateApiStatus('error', error.message);
}
```

## 🔧 自定义配置

### 修改测试参数

编辑 HTML 文件中的默认值：

```javascript
// 修改默认环境ID
<input type="text" id="envId" value="your-env-id">

// 修改默认账号
<input type="text" id="username" value="your-username">

// 修改默认密码
<input type="password" id="password" value="your-password">
```

### 调整测试延迟

修改请求间隔时间（避免请求过快）：

```javascript
// 默认 300ms
await new Promise(resolve => setTimeout(resolve, 300));
```

### 添加新接口测试

1. 在 `testAPIs` 对象中添加接口定义
2. 实现对应的测试函数
3. 刷新页面即可

## 📝 注意事项

### 测试环境

- 确保管理员账号有足够权限
- 建议在测试环境运行，避免影响生产数据
- 写操作会创建测试数据，测试后可能需要清理

### 数据依赖

某些接口需要数据库中已有数据：
- 订单退款：需要已支付订单
- 提现审核：需要待审核提现申请
- 预约签到：需要预约记录
- 大使申请审核：需要待审核申请

如果数据不存在，这些接口会返回"暂无数据"而非失败。

### 性能考虑

- 全量测试约需 3-5 分钟
- 请求间隔 300ms，避免触发限流
- 大量写操作可能影响数据库性能

## 🐛 故障排查

### 登录失败

- 检查环境ID是否正确
- 检查管理员账号密码
- 查看浏览器控制台错误

### 接口测试失败

- 查看详细错误信息
- 检查云函数是否部署
- 验证数据库权限配置

### 依赖接口失败

- 确保创建操作先执行
- 检查 testData.createdIds 是否保存ID
- 查看日志中的执行顺序

## 📞 技术支持

如有问题，请查看：
- 浏览器控制台日志
- 测试页面日志控制台
- 导出的测试报告

---

**版本**: 1.0.0
**更新时间**: 2026-02-13
**作者**: Claude Code
