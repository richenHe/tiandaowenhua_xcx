# Admin å­—æ®µå‘½åä¿®å¤è®¡åˆ’

> ç”Ÿæˆæ—¥æœŸï¼š2026-02-22  
> é—®é¢˜æ ¹æºï¼šAdmin å¼€å‘æ—¶æœªéµå®ˆ `.cursorrules` å­—æ®µå‘½åè§„èŒƒï¼Œå¯¼è‡´å‰ç«¯å­—æ®µåã€äº‘å‡½æ•°å‚æ•°åã€æ•°æ®åº“åˆ—åä¸‰å±‚ä¸ä¸€è‡´  
> ä¿®å¤åŸåˆ™ï¼š**å‰ç«¯ â†’ äº‘å‡½æ•°ä½¿ç”¨ camelCaseï¼Œäº‘å‡½æ•°å†…éƒ¨è½¬æ¢ä¸º snake_case å­˜å…¥æ•°æ®åº“**

---

## å½±å“ç­‰çº§è¯´æ˜

- ğŸ”´ **ä¸¥é‡**ï¼šç›´æ¥å¯¼è‡´æ•°æ®æ— æ³•ä¿å­˜æˆ–æ¥å£æŠ¥é”™
- ğŸŸ¡ **ä¸­ç­‰**ï¼šè¿åè§„èŒƒä½†åŠŸèƒ½å¯ç”¨ï¼Œå­˜åœ¨ç»´æŠ¤é£é™©

---

## æ¨¡å—1ï¼šæ’æœŸç®¡ç† ğŸ”´ ä¸¥é‡

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|---|---|
| å‰ç«¯é¡µé¢ | `admin/pages/course/schedule.html` |
| æ›´æ–°æ¥å£ | `cloudfunctions/course/handlers/admin/updateClassRecord.js` |
| åˆ›å»ºæ¥å£ | `cloudfunctions/course/handlers/admin/createClassRecord.js` |

### é—®é¢˜å¯¹ç…§è¡¨

| å‰ç«¯è¡¨å•å­—æ®µï¼ˆå½“å‰ï¼‰ | å‰ç«¯åº”æ”¹ä¸º | DB çœŸå®åˆ—å | å½“å‰çŠ¶æ€ |
|---|---|---|---|
| `formData.start_time` | `formData.startTime` | ï¼ˆåˆå¹¶ä¸º `class_time`ï¼‰ | ğŸ”´ column not found |
| `formData.end_time` | `formData.endTime` | ï¼ˆåˆå¹¶ä¸º `class_time`ï¼‰ | ğŸ”´ column not found |
| `formData.location` | `formData.classLocation` | `class_location` | ğŸ”´ column not found |
| `formData.note` | `formData.remark` | `remark` | ğŸ”´ allowedFields å†™çš„æ˜¯ `notes`ï¼ŒåŒé‡ä¸åŒ¹é… |
| `formData.course_id` | `formData.courseId` | `course_id` | è¿åè§„èŒƒ |
| `formData.class_date` | `formData.classDate` | `class_date` | è¿åè§„èŒƒ |
| `formData.total_quota` | `formData.totalQuota` | `total_quota` | è¿åè§„èŒƒ |

### ä¿®æ”¹æ–¹æ¡ˆ

#### `schedule.html` ä¿®æ”¹

1. è¡¨å•ç»‘å®šå­—æ®µå…¨éƒ¨æ”¹ä¸º camelCaseï¼š
   ```html
   <!-- æ”¹å‰ -->
   <t-time-picker v-model="formData.start_time" />
   <t-time-picker v-model="formData.end_time" />
   <t-input v-model="formData.location" />
   <t-textarea v-model="formData.note" />

   <!-- æ”¹å -->
   <t-time-picker v-model="formData.startTime" />
   <t-time-picker v-model="formData.endTime" />
   <t-input v-model="formData.classLocation" />
   <t-textarea v-model="formData.remark" />
   ```

2. `handleEdit(row)` ä¸­å°† DB è¿”å›çš„ snake_case å­—æ®µæ˜ å°„ä¸º camelCaseï¼š
   ```javascript
   const handleEdit = (row) => {
     formMode.value = 'edit';
     // DB è¿”å› class_time å¦‚ "09:00-17:00"ï¼Œæ‹†åˆ†ä¸º startTime/endTime
     const [startTime, endTime] = (row.class_time || '-').split('-');
     formData.value = {
       id: row.id,
       courseId: row.course_id,
       classDate: row.class_date,
       startTime: startTime || '',
       endTime: endTime || '',
       classLocation: row.class_location,
       totalQuota: row.total_quota,
       remark: row.remark,
       teacher: row.teacher,
       status: row.status
     };
     formVisible.value = true;
   };
   ```

3. è¡¨å•éªŒè¯è§„åˆ™ `rules` ä¸­çš„ name åŒæ­¥æ›´æ–°ï¼š
   ```javascript
   const rules = {
     courseId: [{ required: true, message: 'è¯·é€‰æ‹©è¯¾ç¨‹', type: 'error' }],
     classDate: [{ required: true, message: 'è¯·é€‰æ‹©ä¸Šè¯¾æ—¥æœŸ', type: 'error' }],
     startTime: [{ required: true, message: 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´', type: 'error' }],
     endTime: [{ required: true, message: 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´', type: 'error' }],
     classLocation: [{ required: true, message: 'è¯·è¾“å…¥ä¸Šè¯¾åœ°ç‚¹', type: 'error' }],
     totalQuota: [{ required: true, message: 'è¯·è¾“å…¥æ€»åé¢', type: 'error' }]
   };
   ```

#### `updateClassRecord.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCase å‚æ•°
const { id, courseId, classDate, startTime, endTime, classLocation, totalQuota, remark, teacher, status } = event;

// æ„å»º DB å­—æ®µï¼ˆæ³¨æ„ startTime + endTime åˆå¹¶ä¸º class_timeï¼‰
const fieldsToUpdate = {};
if (courseId !== undefined) fieldsToUpdate.course_id = courseId;
if (classDate !== undefined) fieldsToUpdate.class_date = classDate;
if (startTime !== undefined && endTime !== undefined) fieldsToUpdate.class_time = `${startTime}-${endTime}`;
if (classLocation !== undefined) fieldsToUpdate.class_location = classLocation;
if (totalQuota !== undefined) fieldsToUpdate.total_quota = totalQuota;
if (remark !== undefined) fieldsToUpdate.remark = remark;
if (teacher !== undefined) fieldsToUpdate.teacher = teacher;
if (status !== undefined) fieldsToUpdate.status = status;
```

#### `createClassRecord.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCaseï¼ˆç§»é™¤æ—§çš„å…¼å®¹ shimï¼‰
const { courseId, classDate, startTime, endTime, classLocation, totalQuota, remark, teacher } = event;

// å‚æ•°éªŒè¯
validateRequired({ courseId, classDate, startTime }, ['courseId', 'classDate', 'startTime']);

// å†™å…¥ DB
insert('class_records', {
  course_id: courseId,
  class_date: classDate,
  class_time: `${startTime}-${endTime}`,
  class_location: classLocation,
  teacher,
  total_quota: totalQuota || 30,
  remark: remark || '',
  booked_quota: 0,
  status: 1
});
```

---

## æ¨¡å—2ï¼šæ¡ˆä¾‹ç®¡ç† ğŸ”´ ä¸¥é‡

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|---|---|
| å‰ç«¯é¡µé¢ | `admin/pages/course/case.html` |
| æ›´æ–°æ¥å£ | `cloudfunctions/course/handlers/admin/updateCase.js` |
| åˆ›å»ºæ¥å£ | `cloudfunctions/course/handlers/admin/createCase.js` |

### é—®é¢˜å¯¹ç…§è¡¨

| å‰ç«¯å­—æ®µï¼ˆå½“å‰ï¼‰ | allowedFieldsï¼ˆå½“å‰ï¼‰ | DB çœŸå®åˆ—å | å½“å‰çŠ¶æ€ |
|---|---|---|---|
| `formData.cover` | `cover_image` | `student_avatar` | ğŸ”´ ä¸‰å±‚å…¨ä¸ä¸€è‡´ï¼Œæ•°æ®ä¸¢å¤± |
| `formData.description` | `summary` | `summary` | ğŸ”´ å‰ç«¯æ”¹äº†DBå°±æ”¶ä¸åˆ° |
| `formData.course_id` | æœªåŒ…å«ï¼ | `course_id` | ğŸ”´ è¯¾ç¨‹å…³è”ä¸¢å¤± |
| æ— æ­¤å­—æ®µ | `author` | DB æ—  `author` åˆ— | ğŸ”´ æ½œåœ¨ column error |
| `formData.cover` | `cover_image` | DB æ—  `cover_image` åˆ— | ğŸ”´ æ½œåœ¨ column error |

### ä¿®æ”¹æ–¹æ¡ˆ

#### `case.html` ä¿®æ”¹

1. è¡¨å•å­—æ®µæ˜ å°„ï¼š
   ```html
   <!-- æ”¹å‰ -->
   <t-input v-model="formData.cover" placeholder="å›¾ç‰‡URL"/>
   <t-textarea v-model="formData.description" />
   <t-select v-model="formData.course_id" />

   <!-- æ”¹å -->
   <t-input v-model="formData.studentAvatar" placeholder="å­¦å‘˜å¤´åƒURL"/>
   <t-textarea v-model="formData.summary" placeholder="æ¡ˆä¾‹æ‘˜è¦"/>
   <t-select v-model="formData.courseId" />
   <!-- æ–°å¢å¿…å¡«å­—æ®µ -->
   <t-input v-model="formData.studentName" placeholder="å­¦å‘˜å§“åï¼ˆå¿…å¡«ï¼‰"/>
   ```

2. `handleEdit(row)` æ˜ å°„ï¼š
   ```javascript
   const handleEdit = (row) => {
     formMode.value = 'edit';
     formData.value = {
       id: row.id,
       title: row.title,
       studentName: row.student_name,
       studentAvatar: row.student_avatar,
       summary: row.summary,
       content: row.content,
       courseId: row.course_id,
       status: row.status,
       sortOrder: row.sort_order
     };
     formVisible.value = true;
   };
   ```

#### `updateCase.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCase
const { id, title, studentName, studentAvatar, summary, content, courseId, status, sortOrder } = event;

// è½¬ä¸º DB å­—æ®µï¼ˆåªåŒ…å« academy_cases ä¸­çœŸå®å­˜åœ¨çš„åˆ—ï¼‰
const fieldsToUpdate = {};
if (title !== undefined) fieldsToUpdate.title = title;
if (studentName !== undefined) fieldsToUpdate.student_name = studentName;
if (studentAvatar !== undefined) fieldsToUpdate.student_avatar = studentAvatar;
if (summary !== undefined) fieldsToUpdate.summary = summary;
if (content !== undefined) fieldsToUpdate.content = content;
if (courseId !== undefined) fieldsToUpdate.course_id = courseId;
if (status !== undefined) fieldsToUpdate.status = status;
if (sortOrder !== undefined) fieldsToUpdate.sort_order = sortOrder;
```

#### `createCase.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCase
const { title, studentName, studentAvatar, studentTitle, summary, content, courseId, status, sortOrder } = event;

// éªŒè¯å¿…å¡«
validateRequired({ title, studentName }, ['title', 'studentName']);

// å†™å…¥ DB
insert('academy_cases', {
  title,
  student_name: studentName,
  student_avatar: studentAvatar || '',
  student_title: studentTitle || '',
  summary: summary || '',
  content: content || '',
  course_id: courseId || null,
  sort_order: sortOrder || 0,
  status: status !== undefined ? status : 1,
  view_count: 0,
  like_count: 0
});
```

---

## æ¨¡å—3ï¼šèµ„æ–™ç®¡ç† ğŸ”´ ä¸¥é‡

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|---|---|
| å‰ç«¯é¡µé¢ | `admin/pages/course/material.html` |
| æ›´æ–°æ¥å£ | `cloudfunctions/course/handlers/admin/updateMaterial.js` |
| åˆ›å»ºæ¥å£ | `cloudfunctions/course/handlers/admin/createMaterial.js` |

### é—®é¢˜å¯¹ç…§è¡¨

DB `academy_materials` å®é™…åˆ—ï¼š`title, category, image_url, video_url, content, tags, sort_order, status`

| å‰ç«¯å­—æ®µï¼ˆå½“å‰ï¼‰ | allowedFieldsï¼ˆå½“å‰ï¼‰ | DB çœŸå®åˆ—å | å½“å‰çŠ¶æ€ |
|---|---|---|---|
| `formData.type` | `type` | `category`ï¼ˆDB æ—  `type` åˆ—ï¼‰ | ğŸ”´ æ•°æ®ä¸¢å¤± |
| `formData.file_url` | `file_url` | DB æ— æ­¤åˆ— | ğŸ”´ æ•°æ®ä¸¢å¤± |
| `formData.size` | `file_size` | DB æ— æ­¤åˆ— | ğŸ”´ æ•°æ®ä¸¢å¤± |
| `formData.description` | `description` | DB æ— æ­¤åˆ— | ğŸ”´ æ•°æ®ä¸¢å¤± |
| `formData.course_id` | æ—  | DB æ—  `course_id` | è¡¨ä¸å«æ­¤å­—æ®µ |
| allowedFields: `cover_image` | `cover_image` | DB æ˜¯ `image_url` | ğŸ”´ column error |

### ä¿®æ”¹æ–¹æ¡ˆ

#### `material.html` ä¿®æ”¹

è¡¨å•å­—æ®µé‡è®¾è®¡ï¼Œè´´åˆ `academy_materials` å®é™…ç»“æ„ï¼š
```html
<!-- ç§»é™¤ï¼šcourse_id, file_url, size, description -->
<!-- ä¿®æ”¹ï¼štype â†’ categoryï¼Œé€‰é¡¹æ”¹ä¸º poster/copywriting/video -->
<!-- æ–°å¢ï¼šimageUrl, videoUrlï¼ˆå¯é€‰ï¼‰, contentï¼ˆæ–‡æ¡ˆï¼‰ -->

<t-select v-model="formData.category" :options="categoryOptions"/>
<!-- categoryOptions: [{label:'æµ·æŠ¥',value:'poster'},{label:'æ–‡æ¡ˆ',value:'copywriting'},{label:'è§†é¢‘',value:'video'}] -->

<t-input v-model="formData.imageUrl" placeholder="å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰"/>
<t-input v-model="formData.videoUrl" placeholder="è§†é¢‘URLï¼ˆå¯é€‰ï¼‰"/>
<t-textarea v-model="formData.content" placeholder="æ–‡æ¡ˆå†…å®¹ï¼ˆå¯é€‰ï¼‰"/>
<t-input-number v-model="formData.sortOrder" />
```

`handleEdit(row)` æ˜ å°„ï¼š
```javascript
formData.value = {
  id: row.id,
  title: row.title,
  category: row.category,
  imageUrl: row.image_url,
  videoUrl: row.video_url,
  content: row.content,
  sortOrder: row.sort_order,
  status: row.status
};
```

#### `updateMaterial.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCase
const { id, title, category, imageUrl, videoUrl, content, sortOrder, status } = event;

// è½¬ä¸º DB å­—æ®µ
const fieldsToUpdate = {};
if (title !== undefined) fieldsToUpdate.title = title;
if (category !== undefined) fieldsToUpdate.category = category;
if (imageUrl !== undefined) fieldsToUpdate.image_url = imageUrl;
if (videoUrl !== undefined) fieldsToUpdate.video_url = videoUrl;
if (content !== undefined) fieldsToUpdate.content = content;
if (sortOrder !== undefined) fieldsToUpdate.sort_order = sortOrder;
if (status !== undefined) fieldsToUpdate.status = status;
```

#### `createMaterial.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCaseï¼ˆå½“å‰æ¥æ”¶ snake_caseï¼Œéœ€æ”¹ï¼‰
const { title, category, imageUrl, videoUrl, content, sortOrder, status } = event;

validateRequired({ title, category }, ['title', 'category']);

insert('academy_materials', {
  title, category, content,
  image_url: imageUrl || null,
  video_url: videoUrl || null,
  sort_order: sortOrder || 0,
  status: status !== undefined ? status : 1,
  view_count: 0,
  download_count: 0,
  share_count: 0
});
```

---

## æ¨¡å—4ï¼šè¯¾ç¨‹ç®¡ç† ğŸ”´ ä¸¥é‡

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|---|---|
| å‰ç«¯é¡µé¢ | `admin/pages/course/list.html` |
| åˆ›å»ºæ¥å£ | `cloudfunctions/course/handlers/admin/createCourse.js` |
| æ›´æ–°æ¥å£ | `cloudfunctions/course/handlers/admin/updateCourse.js` |

### é—®é¢˜å¯¹ç…§è¡¨

| å‰ç«¯å‘é€å­—æ®µï¼ˆå½“å‰ï¼‰ | äº‘å‡½æ•°è¯»å– | DB åˆ—å | å½“å‰çŠ¶æ€ |
|---|---|---|---|
| `coverImage` | `cover_image`ï¼ˆè§£æ„ï¼‰ | `cover_image` | ğŸ”´ å€¼ä¸º undefinedï¼Œå°é¢ä¸ä¿å­˜ |
| `price` | `current_price`ï¼ˆè§£æ„ï¼‰ | `current_price` | ğŸ”´ å­—æ®µåä¸åŒ¹é…ï¼Œä»·æ ¼ä¸ä¿å­˜ |
| `maxStudents` | æ— å¯¹åº” | DB æ— æ­¤åˆ— | æ— æ•ˆå­—æ®µ |
| `sortOrder` | `sort_order`ï¼ˆè§£æ„ï¼‰ | `sort_order` | ğŸ”´ å€¼ä¸º undefinedï¼Œæ’åºä¸ä¿å­˜ |
| `courseId`ï¼ˆupdateï¼‰ | `id`ï¼ˆè§£æ„ï¼‰ | `id` | ğŸ”´ update ä¸»é”®è¯»ä¸åˆ°ï¼Œå…¨éƒ¨å¤±è´¥ï¼ |
| `'initial'/'intensive'` | `type` | `1/2/3`ï¼ˆtinyintï¼‰ | ğŸ”´ ç±»å‹å€¼ä¸åŒ¹é… |

### ä¿®æ”¹æ–¹æ¡ˆ

#### `list.html` ä¿®æ”¹

1. `handleSave` ä¸­ç»Ÿä¸€ç”¨ camelCase å‘é€ï¼Œä¿®æ­£å­—æ®µåï¼š
   ```javascript
   const params = {
     name: editForm.name,
     type: editForm.type,             // æ”¹ä¸ºæ•°å­—: 1/2/3
     coverImage: editForm.coverImage, // å·²æ˜¯ camelCase
     currentPrice: editForm.currentPrice,
     originalPrice: editForm.originalPrice,
     retrainPrice: editForm.retrainPrice,
     allowRetrain: editForm.allowRetrain,
     duration: editForm.duration,
     description: editForm.description,
     content: editForm.content,
     outline: editForm.outline,
     teacher: editForm.teacher,
     sortOrder: editForm.sortOrder,
     status: editForm.status
   };
   if (editMode.value === 'edit') {
     params.id = editForm.id; // ç”¨ idï¼Œä¸ç”¨ courseId
   }
   ```

2. `showAddDialog` å’Œ `editCourse` ä¸­ `editForm` å­—æ®µæ˜ å°„ç»Ÿä¸€ï¼š
   ```javascript
   // editCourse(course) ä¸­ï¼š
   Object.assign(editForm, {
     id: course.id,
     name: course.name,
     type: course.type,               // æ•°å­— 1/2/3
     coverImage: course.cover_image,
     currentPrice: course.current_price,
     originalPrice: course.original_price,
     retrainPrice: course.retrain_price,
     allowRetrain: course.allow_retrain,
     duration: course.duration,
     description: course.description,
     sortOrder: course.sort_order,
     status: course.status
   });
   ```

3. è¯¾ç¨‹ç±»å‹ä¸‹æ‹‰é€‰é¡¹æ”¹ä¸ºæ•°å­—å€¼ï¼š
   ```javascript
   // æ”¹å‰
   <t-option value="initial" label="åˆæ¢ç­" />
   // æ”¹å
   <t-option :value="1" label="åˆæ¢ç­" />
   <t-option :value="2" label="å¯†è®­ç­" />
   <t-option :value="3" label="å’¨è¯¢æœåŠ¡" />
   ```

#### `createCourse.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCaseï¼Œå†…éƒ¨è½¬æ¢
const { name, type, coverImage, currentPrice, originalPrice, retrainPrice,
        allowRetrain, duration, description, content, outline, teacher, sortOrder, status } = event;

validateRequired({ name, type, currentPrice }, ['name', 'type', 'currentPrice']);

insert('courses', {
  name, type, description, content, outline, teacher, duration,
  cover_image: coverImage || '',
  current_price: currentPrice,
  original_price: originalPrice || currentPrice,
  retrain_price: retrainPrice || 0,
  allow_retrain: allowRetrain ? 1 : 0,
  sort_order: sortOrder || 0,
  status: status !== undefined ? status : 1
});
```

#### `updateCourse.js` ä¿®æ”¹

```javascript
// åŒæ—¶å…¼å®¹ id å’Œ courseIdï¼ˆå‰ç«¯ç»Ÿä¸€æ”¹ä¸º id åå¯ç§»é™¤ courseId å…¼å®¹ï¼‰
const recordId = event.id || event.courseId;
const { coverImage, currentPrice, originalPrice, retrainPrice,
        allowRetrain, sortOrder, ...rest } = event;

// æ„å»º DB æ›´æ–°å­—æ®µ
const fieldsToUpdate = { ...rest }; // åŒ…å« name, type, description ç­‰ç›´æ¥åŒ¹é…å­—æ®µ
if (coverImage !== undefined) fieldsToUpdate.cover_image = coverImage;
if (currentPrice !== undefined) fieldsToUpdate.current_price = currentPrice;
if (originalPrice !== undefined) fieldsToUpdate.original_price = originalPrice;
if (retrainPrice !== undefined) fieldsToUpdate.retrain_price = retrainPrice;
if (allowRetrain !== undefined) fieldsToUpdate.allow_retrain = allowRetrain ? 1 : 0;
if (sortOrder !== undefined) fieldsToUpdate.sort_order = sortOrder;
// åˆ é™¤ä¸å±äº DB çš„å­—æ®µ
delete fieldsToUpdate.id;
delete fieldsToUpdate.courseId;
```

---

## æ¨¡å—5ï¼šå…¬å‘Šç®¡ç† ğŸŸ¡ ä¸­ç­‰

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|---|---|
| å‰ç«¯é¡µé¢ | `admin/pages/system/announcement.html` |
| åˆ›å»ºæ¥å£ | `cloudfunctions/system/handlers/admin/createAnnouncement.js` |
| æ›´æ–°æ¥å£ | `cloudfunctions/system/handlers/admin/updateAnnouncement.js` |

### é—®é¢˜è¯´æ˜

å‰ç«¯ç›´æ¥å‘ `cover_image`ï¼ˆsnake_caseï¼‰ï¼Œäº‘å‡½æ•°ä¹Ÿç›´æ¥æ¥æ”¶ snake_caseï¼ŒåŠŸèƒ½æ­£å¸¸ä½†è¿åè§„èŒƒã€‚

### ä¿®æ”¹æ–¹æ¡ˆ

#### `announcement.html` ä¿®æ”¹

```javascript
// handleSave ä¸­
const submitData = {
  title: formData.value.title,
  category: formData.value.category,
  content: formData.value.content,
  link: formData.value.link || '',
  coverImage: formData.value.cover_image || '',  // snake_case â†’ camelCase
  status: formData.value.status
};
```

#### `createAnnouncement.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCaseï¼Œè½¬æ¢
const { title, content, summary, category, coverImage, link, targetType,
        targetLevel, isTop, isPopup, startTime, endTime, sortOrder } = event;

// æ„å»º DB æ•°æ®
const announcementData = {
  title, content, summary, category, link, sort_order: sortOrder || 0,
  cover_image: coverImage || '',
  target_type: targetType || 0,
  target_level: targetLevel || null,
  is_top: isTop || 0,
  is_popup: isPopup || 0,
  status: 1,
  created_by: admin.id
};
```

#### `updateAnnouncement.js` ä¿®æ”¹

```javascript
// æ¥æ”¶ camelCaseï¼Œè½¬æ¢
const { id, title, content, summary, category, coverImage, link,
        targetType, targetLevel, isTop, isPopup, startTime, endTime, sortOrder, status } = event;

const updateData = {};
if (title) updateData.title = title;
if (content) updateData.content = content;
if (summary !== undefined) updateData.summary = summary;
if (category) updateData.category = category;
if (coverImage !== undefined) updateData.cover_image = coverImage;
if (link !== undefined) updateData.link = link;
if (targetType !== undefined) updateData.target_type = targetType;
if (targetLevel !== undefined) updateData.target_level = targetLevel;
if (isTop !== undefined) updateData.is_top = isTop;
if (isPopup !== undefined) updateData.is_popup = isPopup;
if (startTime) updateData.start_time = formatDateTime(startTime);
if (endTime) updateData.end_time = formatDateTime(endTime);
if (sortOrder !== undefined) updateData.sort_order = sortOrder;
if (status !== undefined) updateData.status = status;
```

---

## æ‰§è¡Œé¡ºåº

```
ä¿®å¤é¡ºåºï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦ï¼‰ï¼š
â‘  æ’æœŸç®¡ç†   â†’ æ”¹ schedule.html + updateClassRecord.js + createClassRecord.js â†’ éƒ¨ç½² course å‡½æ•°
â‘¡ æ¡ˆä¾‹ç®¡ç†   â†’ æ”¹ case.html + updateCase.js + createCase.js â†’ éƒ¨ç½² course å‡½æ•°  
â‘¢ èµ„æ–™ç®¡ç†   â†’ æ”¹ material.html + updateMaterial.js + createMaterial.js â†’ éƒ¨ç½² course å‡½æ•°
â‘£ è¯¾ç¨‹ç®¡ç†   â†’ æ”¹ list.html + createCourse.js + updateCourse.js â†’ éƒ¨ç½² course å‡½æ•°
â‘¤ å…¬å‘Šç®¡ç†   â†’ æ”¹ announcement.html + createAnnouncement.js + updateAnnouncement.js â†’ éƒ¨ç½² system å‡½æ•°
```

## æ–‡ä»¶æ¸…å•ï¼ˆå…± 15 ä¸ªæ–‡ä»¶ï¼‰

| # | æ–‡ä»¶è·¯å¾„ | ä¼˜å…ˆçº§ |
|---|---|---|
| 1 | `admin/pages/course/schedule.html` | ğŸ”´ |
| 2 | `cloudfunctions/course/handlers/admin/updateClassRecord.js` | ğŸ”´ |
| 3 | `cloudfunctions/course/handlers/admin/createClassRecord.js` | ğŸ”´ |
| 4 | `admin/pages/course/case.html` | ğŸ”´ |
| 5 | `cloudfunctions/course/handlers/admin/updateCase.js` | ğŸ”´ |
| 6 | `cloudfunctions/course/handlers/admin/createCase.js` | ğŸ”´ |
| 7 | `admin/pages/course/material.html` | ğŸ”´ |
| 8 | `cloudfunctions/course/handlers/admin/updateMaterial.js` | ğŸ”´ |
| 9 | `cloudfunctions/course/handlers/admin/createMaterial.js` | ğŸ”´ |
| 10 | `admin/pages/course/list.html` | ğŸ”´ |
| 11 | `cloudfunctions/course/handlers/admin/createCourse.js` | ğŸ”´ |
| 12 | `cloudfunctions/course/handlers/admin/updateCourse.js` | ğŸ”´ |
| 13 | `admin/pages/system/announcement.html` | ğŸŸ¡ |
| 14 | `cloudfunctions/system/handlers/admin/createAnnouncement.js` | ğŸŸ¡ |
| 15 | `cloudfunctions/system/handlers/admin/updateAnnouncement.js` | ğŸŸ¡ |
