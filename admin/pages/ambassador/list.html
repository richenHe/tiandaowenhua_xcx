<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>å¤§ä½¿åˆ—è¡¨</title><link rel="stylesheet" href="../../assets/libs/tdesign.min.css"><link rel="stylesheet" href="../../assets/css/tokens.css"><style>body{margin:0;padding:20px;background:#f5f5f5;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}.page-container{max-width:1400px;margin:0 auto;background:white;border-radius:8px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.page-header{margin-bottom:24px}.page-title{font-size:20px;font-weight:600;color:#333;margin:0 0 8px 0}.page-desc{font-size:14px;color:#999;margin:0}.search-bar{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}
    /* TDesign å¸ƒå±€æ ·å¼ - å¿…éœ€ï¼*/
    .t-layout {
      height: 100vh;
    }
    
    .t-layout__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 24px;
      background: #fff;
      border-bottom: 1px solid #dcdcdc;
    }
    
    .t-layout__sider {
      background: #fff;
      border-right: 1px solid #dcdcdc;
      width: 240px !important;
      flex-shrink: 0;
    }
    
    .t-layout__content {
      padding: 24px;
      overflow-y: auto;
      background: #f5f5f5;
    }

  </style></head>
<body>
  <div id="app">
    <t-layout style="height: 100vh;">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <t-header height="64px" style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
        background: #fff;
        border-bottom: 1px solid #dcdcdc;
      ">
        <div style="display: flex; align-items: center; gap: 16px;">
          <span style="font-size: 18px; font-weight: 600; color: #333;">ğŸ¨ å¤©é“æ–‡åŒ–åå°ç®¡ç†</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span>{{ adminInfo?.real_name || adminInfo?.username || 'ç®¡ç†å‘˜' }}</span>
          <t-button size="small" @click="handleLogout">é€€å‡º</t-button>
        </div>
      </t-header>
      
      <t-layout>
        <!-- ä¾§è¾¹èœå• -->
        <t-aside width="240px" style="
          background: #fff;
          border-right: 1px solid #dcdcdc;
          overflow-y: auto;
        ">
          <t-menu
            value="ambassador-list"
            :default-expanded="['user', 'order', 'course', 'ambassador', 'system']"
            theme="light"
            @change="handleMenuChange"
          >
            <t-menu-item value="dashboard">
              <template #icon><t-icon name="dashboard" /></template>
              æ•°æ®æ¦‚è§ˆ
            </t-menu-item>
            
            <t-submenu value="user">
              <template #icon><t-icon name="user" /></template>
              <template #title>ç”¨æˆ·ç®¡ç†</template>
              <t-menu-item value="user-list">å­¦å‘˜åˆ—è¡¨</t-menu-item>
              <t-menu-item value="user-referee">æ¨èäººç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="order">
              <template #icon><t-icon name="order" /></template>
              <template #title>è®¢å•ç®¡ç†</template>
              <t-menu-item value="order-list">è®¢å•åˆ—è¡¨</t-menu-item>
              <t-menu-item value="order-refund">é€€æ¬¾ç®¡ç†</t-menu-item>
              <t-menu-item value="withdraw-audit">æç°å®¡æ ¸</t-menu-item>
            </t-submenu>
            
            <t-submenu value="course">
              <template #icon><t-icon name="file" /></template>
              <template #title>è¯¾ç¨‹ç®¡ç†</template>
              <t-menu-item value="course-list">è¯¾ç¨‹åˆ—è¡¨</t-menu-item>
              <t-menu-item value="schedule-list">æ’æœŸç®¡ç†</t-menu-item>
              <t-menu-item value="appointment-list">é¢„çº¦ç®¡ç†</t-menu-item>
              <t-menu-item value="case-list">æ¡ˆä¾‹ç®¡ç†</t-menu-item>
              <t-menu-item value="material-list">èµ„æ–™ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="ambassador">
              <template #icon><t-icon name="usergroup" /></template>
              <template #title>å¤§ä½¿ç®¡ç†</template>
              <t-menu-item value="ambassador-list">å¤§ä½¿åˆ—è¡¨</t-menu-item>
              <t-menu-item value="application-audit">ç”³è¯·å®¡æ ¸</t-menu-item>
              <t-menu-item value="activity-list">æ´»åŠ¨ç®¡ç†</t-menu-item>
              <t-menu-item value="contract-list">åˆçº¦ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="system">
              <template #icon><t-icon name="setting" /></template>
              <template #title>ç³»ç»Ÿç®¡ç†</template>
              <t-menu-item value="admin-list">ç®¡ç†å‘˜ç®¡ç†</t-menu-item>
              <t-menu-item value="config">ç³»ç»Ÿé…ç½®</t-menu-item>
              <t-menu-item value="announcement-list">å…¬å‘Šç®¡ç†</t-menu-item>
              <t-menu-item value="feedback-list">åé¦ˆç®¡ç†</t-menu-item>
              <t-menu-item value="notification-list">é€šçŸ¥ç®¡ç†</t-menu-item>
              <t-menu-item value="level-config">ç­‰çº§é…ç½®</t-menu-item>
            </t-submenu>
          </t-menu>
        </t-aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <t-content class="page-content"><div class="page-container"><div class="page-header"><h1 class="page-title">å¤§ä½¿åˆ—è¡¨</h1><p class="page-desc">ç®¡ç†å¤©é“æ–‡åŒ–å¤§ä½¿è´¦æˆ·</p></div><div class="search-bar"><t-input v-model="filters.keyword" placeholder="å§“å/æ‰‹æœºå·" clearable style="width:200px;"><template #prefix-icon><t-icon name="search"/></template></t-input><t-select v-model="filters.level" :options="levelOptions" placeholder="å¤§ä½¿ç­‰çº§" clearable style="width:150px;"/><t-select v-model="filters.status" :options="statusOptions" placeholder="çŠ¶æ€" clearable style="width:150px;"/><t-button theme="primary" @click="handleSearch"><template #icon><t-icon name="search"/></template>æŸ¥è¯¢</t-button><t-button theme="default" @click="handleReset"><template #icon><t-icon name="refresh"/></template>é‡ç½®</t-button></div><t-table :data="tableData" :columns="columns" :loading="loading" :pagination="pagination" @page-change="handlePageChange" row-key="id" bordered stripe hover><template #level="{ row }"><t-tag v-if="row.ambassador_level===1" theme="default">äº‘é›€</t-tag><t-tag v-else-if="row.ambassador_level===2" theme="primary">é’é¸¾</t-tag><t-tag v-else-if="row.ambassador_level===3" theme="warning">é¸¿é¹„</t-tag></template><template #points="{ row }"><div><div style="font-weight:600;">åŠŸå¾·åˆ†: {{row.merit_points||0}}</div><div style="font-size:12px;color:#666;">ç°é‡‘åˆ†: {{row.cash_points_available||0}}</div></div></template><template #operation="{ row }"><t-space size="small"><t-button theme="primary" size="small" variant="text" @click="handleView(row)">æŸ¥çœ‹è¯¦æƒ…</t-button><t-button theme="default" size="small" variant="text" @click="handleAdjustPoints(row)">è°ƒæ•´ç§¯åˆ†</t-button><t-button theme="warning" size="small" variant="text" @click="handleUpgrade(row)">å‡çº§</t-button></t-space></template></t-table></div><t-dialog v-model:visible="detailVisible" header="å¤§ä½¿è¯¦æƒ…" width="650px" :footer="false"><t-descriptions v-if="currentRecord" bordered :column="2"><t-descriptions-item label="ID">{{currentRecord.id}}</t-descriptions-item><t-descriptions-item label="å§“å">{{currentRecord.real_name}}</t-descriptions-item><t-descriptions-item label="æ‰‹æœºå·">{{currentRecord.phone}}</t-descriptions-item><t-descriptions-item label="å¤§ä½¿ç­‰çº§"><t-tag v-if="currentRecord.ambassador_level===1" theme="default">äº‘é›€</t-tag><t-tag v-else-if="currentRecord.ambassador_level===2" theme="primary">é’é¸¾</t-tag><t-tag v-else-if="currentRecord.ambassador_level===3" theme="warning">é¸¿é¹„</t-tag></t-descriptions-item><t-descriptions-item label="åŠŸå¾·åˆ†">{{currentRecord.merit_points||0}}</t-descriptions-item><t-descriptions-item label="ç°é‡‘åˆ†å¯ç”¨">{{currentRecord.cash_points_available||0}}</t-descriptions-item><t-descriptions-item label="æ¨èäººæ•°">{{currentRecord.referral_count||0}}</t-descriptions-item><t-descriptions-item label="è®¢å•æ•°">{{currentRecord.order_count||0}}</t-descriptions-item><t-descriptions-item label="æ³¨å†Œæ—¶é—´" :span="2">{{currentRecord.created_at}}</t-descriptions-item></t-descriptions></t-dialog><t-dialog v-model:visible="pointsVisible" header="è°ƒæ•´ç§¯åˆ†" width="500px" @confirm="handlePointsSubmit"><t-form :data="pointsForm"><t-form-item label="è°ƒæ•´ç±»å‹"><t-radio-group v-model="pointsForm.type"><t-radio value="merit">åŠŸå¾·åˆ†</t-radio><t-radio value="cash">ç°é‡‘åˆ†</t-radio></t-radio-group></t-form-item><t-form-item label="è°ƒæ•´æ–¹å¼"><t-radio-group v-model="pointsForm.action"><t-radio value="add">å¢åŠ </t-radio><t-radio value="subtract">æ‰£é™¤</t-radio></t-radio-group></t-form-item><t-form-item label="è°ƒæ•´æ•°é‡"><t-input-number v-model="pointsForm.amount" :min="1" style="width:100%;"/></t-form-item><t-form-item label="è°ƒæ•´åŸå› "><t-textarea v-model="pointsForm.reason" placeholder="è¯·è¾“å…¥è°ƒæ•´åŸå› " :maxlength="200"/></t-form-item></t-form></t-dialog>        </t-content>
      </t-layout>
    </t-layout>
  </div>

  <script src="../../assets/libs/vue.global.js"></script><script src="../../assets/libs/tdesign.min.js"></script><script src="../../assets/js/config.js"></script><script src="../../assets/js/admin-api.js"></script>
  <script src="../../assets/js/sidebar-navigation.js"></script><script>const{createApp,ref,onMounted}=Vue;createApp({
      setup() {
        // å¼•å…¥ä¾§è¾¹æ å¯¼èˆªåŠŸèƒ½
        const { adminInfo, handleMenuChange, handleLogout } = SidebarNavigation.useSidebarNavigation();
        const loading=ref(false);const tableData=ref([]);const detailVisible=ref(false);const pointsVisible=ref(false);const currentRecord=ref(null);const pointsForm=ref({type:'merit',action:'add',amount:0,reason:''});const filters=ref({keyword:'',level:null,status:null});const levelOptions=[{label:'äº‘é›€',value:1},{label:'é’é¸¾',value:2},{label:'é¸¿é¹„',value:3}];const statusOptions=[{label:'æ­£å¸¸',value:1},{label:'å†»ç»“',value:0}];const pagination=ref({current:1,pageSize:20,total:0});const columns=[{colKey:'id',title:'ID',width:80},{colKey:'real_name',title:'å§“å',width:120},{colKey:'phone',title:'æ‰‹æœºå·',width:130},{colKey:'level',title:'ç­‰çº§',width:100,cell:'level'},{colKey:'points',title:'ç§¯åˆ†',width:150,cell:'points'},{colKey:'referral_count',title:'æ¨èäººæ•°',width:100},{colKey:'order_count',title:'è®¢å•æ•°',width:100},{colKey:'created_at',title:'æ³¨å†Œæ—¶é—´',width:160},{colKey:'operation',title:'æ“ä½œ',width:240,fixed:'right',cell:'operation'}];const fetchData=async()=>{loading.value=true;try{const params={page:pagination.value.current,pageSize:pagination.value.pageSize,...filters.value};const data=await AdminAPI.getAmbassadorList(params);tableData.value=data.list;pagination.value.total=data.total;}catch(error){TDesign.MessagePlugin.error(error.message||'è·å–æ•°æ®å¤±è´¥');}finally{loading.value=false;}};const handleSearch=()=>{pagination.value.current=1;fetchData();};const handleReset=()=>{filters.value={keyword:'',level:null,status:null};handleSearch();};const handlePageChange=(pageInfo)=>{pagination.value.current=pageInfo.current;pagination.value.pageSize=pageInfo.pageSize;fetchData();};const handleView=(row)=>{currentRecord.value=row;detailVisible.value=true;};const handleAdjustPoints=(row)=>{currentRecord.value=row;pointsForm.value={type:'merit',action:'add',amount:0,reason:''};pointsVisible.value=true;};const handleUpgrade=async(row)=>{const levels={1:'äº‘é›€',2:'é’é¸¾',3:'é¸¿é¹„'};const nextLevel=row.ambassador_level+1;if(nextLevel>3){TDesign.MessagePlugin.warning('å·²æ˜¯æœ€é«˜ç­‰çº§');return;}const confirmed=await TDesign.DialogPlugin.confirm({header:'ç¡®è®¤å‡çº§',body:`ç¡®è®¤å°† ${row.real_name} å‡çº§ä¸º ${levels[nextLevel]} å—ï¼Ÿ`,theme:'warning'});if(!confirmed)return;try{await AdminAPI.upgradeAmbassador({userId:row.id,targetLevel:nextLevel});TDesign.MessagePlugin.success('å‡çº§æˆåŠŸ');fetchData();}catch(error){TDesign.MessagePlugin.error(error.message||'å‡çº§å¤±è´¥');}};const handlePointsSubmit=async()=>{if(!pointsForm.value.amount||!pointsForm.value.reason){TDesign.MessagePlugin.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');return;}try{await AdminAPI.adjustAmbassadorPoints({userId:currentRecord.value.id,...pointsForm.value});TDesign.MessagePlugin.success('è°ƒæ•´æˆåŠŸ');pointsVisible.value=false;fetchData();}catch(error){TDesign.MessagePlugin.error(error.message||'è°ƒæ•´å¤±è´¥');}};onMounted(()=>{fetchData();});return {
          // ä¾§è¾¹æ å¯¼èˆª
          adminInfo,
          handleMenuChange,
          handleLogout,
          loading,tableData,detailVisible,pointsVisible,currentRecord,pointsForm,filters,levelOptions,statusOptions,pagination,columns,handleSearch,handleReset,handlePageChange,handleView,handleAdjustPoints,handleUpgrade,handlePointsSubmit
        };}}).use(TDesign).mount('#app');</script></body></html>






