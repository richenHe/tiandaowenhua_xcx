<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§ä½¿åˆ—è¡¨ - å¤©é“æ–‡åŒ–åå°</title>
  
  <link rel="stylesheet" href="../../assets/libs/tdesign.min.css">
  <link rel="stylesheet" href="../../assets/css/tokens.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
    }
    
    .t-layout {
      height: 100vh;
    }
    
    .t-layout__sider {
      background: #fff;
      border-right: 1px solid #dcdcdc;
      width: 240px !important;
      flex-shrink: 0;
    }
    
    .page-content {
      padding: 24px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    
    .page-header {
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 600;
    }
    
    .search-form {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    
    .table-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
    }
    
    .detail-section {
      margin-bottom: 24px;
    }
    
    .detail-section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #333;
    }
    
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      text-align: center;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 4px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .stat-label {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="app">
    <t-layout style="height: 100vh;">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <t-header height="64px" style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
        background: #fff;
        border-bottom: 1px solid #dcdcdc;
      ">
        <div style="display: flex; align-items: center; gap: 16px;">
          <span style="font-size: 18px; font-weight: 600; color: #333;">ğŸ¨ å¤©é“æ–‡åŒ–åå°ç®¡ç†</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span>{{ adminInfo?.real_name || adminInfo?.username || 'ç®¡ç†å‘˜' }}</span>
          <t-button size="small" @click="handleLogout">é€€å‡º</t-button>
        </div>
      </t-header>
      
      <t-layout>
        <!-- ä¾§è¾¹èœå• -->
        <t-aside width="240px" style="
          background: #fff;
          border-right: 1px solid #dcdcdc;
          overflow-y: auto;
        ">
          <t-menu
            value="ambassador-list"
            :default-expanded="['user', 'order', 'course', 'ambassador', 'system']"
            theme="light"
            @change="handleMenuChange"
          >
            <t-menu-item value="dashboard">
              <template #icon><t-icon name="dashboard" /></template>
              æ•°æ®æ¦‚è§ˆ
            </t-menu-item>
            
            <t-submenu value="user">
              <template #icon><t-icon name="user" /></template>
              <template #title>ç”¨æˆ·ç®¡ç†</template>
              <t-menu-item value="user-list">å­¦å‘˜åˆ—è¡¨</t-menu-item>
              <t-menu-item value="user-referee">æ¨èå…³ç³»æŸ¥è¯¢</t-menu-item>
              <t-menu-item value="user-referee-logs">æ¨èäººå˜æ›´è®°å½•</t-menu-item>
            </t-submenu>
            
            <t-submenu value="order">
              <template #icon><t-icon name="order" /></template>
              <template #title>è®¢å•ç®¡ç†</template>
              <t-menu-item value="order-list">è®¢å•åˆ—è¡¨</t-menu-item>
              <t-menu-item value="order-refund">é€€æ¬¾ç®¡ç†</t-menu-item>
              <t-menu-item value="withdraw-audit">æç°å®¡æ ¸</t-menu-item>
            </t-submenu>
            
            <t-submenu value="course">
              <template #icon><t-icon name="file" /></template>
              <template #title>è¯¾ç¨‹ç®¡ç†</template>
              <t-menu-item value="course-list">è¯¾ç¨‹åˆ—è¡¨</t-menu-item>
              <t-menu-item value="schedule-list">æ’æœŸç®¡ç†</t-menu-item>
              <t-menu-item value="appointment-list">é¢„çº¦ç®¡ç†</t-menu-item>
              <t-menu-item value="case-list">æ¡ˆä¾‹ç®¡ç†</t-menu-item>
              <t-menu-item value="material-list">èµ„æ–™ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="ambassador">
              <template #icon><t-icon name="usergroup" /></template>
              <template #title>å¤§ä½¿ç®¡ç†</template>
              <t-menu-item value="ambassador-list">å¤§ä½¿åˆ—è¡¨</t-menu-item>
              <t-menu-item value="application-audit">ç”³è¯·å®¡æ ¸</t-menu-item>
              <t-menu-item value="activity-list">æ´»åŠ¨ç®¡ç†</t-menu-item>
              <t-menu-item value="contract-list">åˆçº¦ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="system">
              <template #icon><t-icon name="setting" /></template>
              <template #title>ç³»ç»Ÿç®¡ç†</template>
              <t-menu-item value="admin-list">ç®¡ç†å‘˜ç®¡ç†</t-menu-item>
              <t-menu-item value="config">ç³»ç»Ÿé…ç½®</t-menu-item>
              <t-menu-item value="announcement-list">å…¬å‘Šç®¡ç†</t-menu-item>
              <t-menu-item value="feedback-list">åé¦ˆç®¡ç†</t-menu-item>
              <t-menu-item value="notification-list">é€šçŸ¥ç®¡ç†</t-menu-item>
              <t-menu-item value="level-config">ç­‰çº§é…ç½®</t-menu-item>
            </t-submenu>
          </t-menu>
        </t-aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <t-content class="page-content">
          <!-- é¡µé¢å¤´éƒ¨ -->
          <div class="page-header">
            <h1 class="page-title">å¤§ä½¿åˆ—è¡¨</h1>
          </div>
          
          <!-- æœç´¢è¡¨å• -->
          <div class="search-form">
            <t-form layout="inline">
              <t-form-item label="å…³é”®è¯">
                <t-input v-model="searchForm.keyword" placeholder="å§“å/æ‰‹æœºå·" clearable style="width: 200px;"></t-input>
              </t-form-item>
              
              <t-form-item label="å¤§ä½¿ç­‰çº§">
                <t-select v-model="searchForm.ambassadorLevel" clearable placeholder="å…¨éƒ¨" style="width: 150px;">
                  <t-option :value="1" label="é’é¸¾ä½¿è€…"></t-option>
                  <t-option :value="2" label="é’é¸¾å¤§ä½¿"></t-option>
                  <t-option :value="3" label="é¸¿é¹„ä½¿è€…"></t-option>
                  <t-option :value="4" label="é¸¿é¹„å¤§ä½¿"></t-option>
                </t-select>
              </t-form-item>
              
              <t-form-item label="çŠ¶æ€">
                <t-select v-model="searchForm.status" clearable placeholder="å…¨éƒ¨" style="width: 150px;">
                  <t-option :value="1" label="æ­£å¸¸"></t-option>
                  <t-option :value="0" label="å†»ç»“"></t-option>
                </t-select>
              </t-form-item>
              
              <t-form-item>
                <t-space>
                  <t-button theme="primary" @click="handleSearch">æŸ¥è¯¢</t-button>
                  <t-button theme="default" @click="handleReset">é‡ç½®</t-button>
                </t-space>
              </t-form-item>
            </t-form>
          </div>
          
          <!-- æ•°æ®è¡¨æ ¼ -->
          <div class="table-card">
            <t-table
              :data="tableData"
              :columns="columns"
              :loading="loading"
              row-key="id"
              :pagination="pagination"
              @page-change="onPageChange"
            >
              <template #ambassadorLevel="{ row }">
                <t-tag v-if="row.ambassador_level === 1" theme="primary">é’é¸¾ä½¿è€…</t-tag>
                <t-tag v-else-if="row.ambassador_level === 2" theme="success">é’é¸¾å¤§ä½¿</t-tag>
                <t-tag v-else-if="row.ambassador_level === 3" theme="warning">é¸¿é¹„ä½¿è€…</t-tag>
                <t-tag v-else-if="row.ambassador_level === 4" theme="danger">é¸¿é¹„å¤§ä½¿</t-tag>
              </template>
              
              <template #meritPoints="{ row }">
                {{ row.merit_points || 0 }}
              </template>
              
              <template #cashPoints="{ row }">
                Â¥{{ ((row.cash_points_available || 0) / 100).toFixed(2) }}
              </template>
              
              <template #status="{ row }">
                <t-tag :theme="row.status === 1 ? 'success' : 'danger'">
                  {{ row.status === 1 ? 'æ­£å¸¸' : 'å†»ç»“' }}
                </t-tag>
              </template>
              
              <template #action="{ row }">
                <t-space>
                  <t-button theme="primary" size="small" variant="text" @click="viewDetail(row)">è¯¦æƒ…</t-button>
                  <t-button theme="default" size="small" variant="text" @click="adjustPoints(row)">è°ƒæ•´ç§¯åˆ†</t-button>
                  <t-button theme="warning" size="small" variant="text" @click="upgrade(row)">å‡çº§</t-button>
                </t-space>
              </template>
            </t-table>
          </div>
          
          <!-- å¤§ä½¿è¯¦æƒ…å¯¹è¯æ¡† -->
          <t-dialog
            v-model:visible="detailVisible"
            header="å¤§ä½¿è¯¦æƒ…"
            width="900px"
            :footer="false"
          >
            <t-loading :loading="detailLoading">
              <div v-if="currentAmbassador">
                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div class="detail-section">
                  <h3 class="detail-section-title">åŸºç¡€ä¿¡æ¯</h3>
                  <t-descriptions :column="2" bordered>
                    <t-descriptions-item label="å§“å">{{ currentAmbassador.real_name }}</t-descriptions-item>
                    <t-descriptions-item label="æ‰‹æœºå·">{{ currentAmbassador.phone }}</t-descriptions-item>
                    <t-descriptions-item label="å¤§ä½¿ç­‰çº§">
                      <t-tag :theme="getLevelTheme(currentAmbassador.ambassador_level)">
                        {{ getLevelText(currentAmbassador.ambassador_level) }}
                      </t-tag>
                    </t-descriptions-item>
                    <t-descriptions-item label="çŠ¶æ€">
                      <t-tag :theme="currentAmbassador.status === 1 ? 'success' : 'danger'">
                        {{ currentAmbassador.status === 1 ? 'æ­£å¸¸' : 'å†»ç»“' }}
                      </t-tag>
                    </t-descriptions-item>
                    <t-descriptions-item label="æ³¨å†Œæ—¶é—´">
                      {{ formatDateTime(currentAmbassador.created_at) }}
                    </t-descriptions-item>
                    <t-descriptions-item label="æœ€åæ´»è·ƒ">
                      {{ formatDateTime(currentAmbassador.last_active_at) }}
                    </t-descriptions-item>
                  </t-descriptions>
                </div>
                
                <!-- å›¢é˜Ÿæ•°æ® -->
                <div class="detail-section">
                  <h3 class="detail-section-title">å›¢é˜Ÿæ•°æ®</h3>
                  <div class="stat-grid">
                    <div class="stat-card">
                      <div class="stat-value" :style="{color: '#0052d9'}">{{ currentAmbassador.team_count || 0 }}</div>
                      <div class="stat-label">å›¢é˜Ÿäººæ•°</div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-value" :style="{color: '#00a870'}">{{ currentAmbassador.direct_referrals || 0 }}</div>
                      <div class="stat-label">ç›´æ¨äººæ•°</div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-value" :style="{color: '#ed7b2f'}">Â¥{{ ((currentAmbassador.total_sales || 0) / 100).toFixed(2) }}</div>
                      <div class="stat-label">æ€»ä¸šç»©</div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-value" :style="{color: '#e34d59'}">{{ currentAmbassador.order_count || 0 }}</div>
                      <div class="stat-label">è®¢å•æ•°</div>
                    </div>
                  </div>
                </div>
                
                <!-- ç§¯åˆ†ä¿¡æ¯ -->
                <div class="detail-section">
                  <h3 class="detail-section-title">ç§¯åˆ†ä¿¡æ¯</h3>
                  <t-descriptions :column="2" bordered>
                    <t-descriptions-item label="åŠŸå¾·ç§¯åˆ†">
                      {{ currentAmbassador.merit_points || 0 }}
                    </t-descriptions-item>
                    <t-descriptions-item label="ç°é‡‘ç§¯åˆ†">
                      Â¥{{ ((currentAmbassador.cash_points_available || 0) / 100).toFixed(2) }}
                    </t-descriptions-item>
                    <t-descriptions-item label="å†»ç»“ç°é‡‘">
                      Â¥{{ ((currentAmbassador.cash_points_frozen || 0) / 100).toFixed(2) }}
                    </t-descriptions-item>
                    <t-descriptions-item label="ç´¯è®¡æ”¶ç›Š">
                      Â¥{{ ((currentAmbassador.total_earnings || 0) / 100).toFixed(2) }}
                    </t-descriptions-item>
                  </t-descriptions>
                </div>
                
                <!-- åˆçº¦ä¿¡æ¯ -->
                <div class="detail-section" v-if="currentAmbassador.contract">
                  <h3 class="detail-section-title">åˆçº¦ä¿¡æ¯</h3>
                  <t-descriptions :column="2" bordered>
                    <t-descriptions-item label="åˆçº¦ç±»å‹">
                      {{ currentAmbassador.contract.type_name }}
                    </t-descriptions-item>
                    <t-descriptions-item label="ç­¾çº¦æ—¥æœŸ">
                      {{ formatDate(currentAmbassador.contract.signed_at) }}
                    </t-descriptions-item>
                    <t-descriptions-item label="åˆ°æœŸæ—¥æœŸ">
                      {{ formatDate(currentAmbassador.contract.expires_at) }}
                    </t-descriptions-item>
                    <t-descriptions-item label="åˆçº¦çŠ¶æ€">
                      <t-tag :theme="getContractStatusTheme(currentAmbassador.contract.status)">
                        {{ getContractStatusText(currentAmbassador.contract.status) }}
                      </t-tag>
                    </t-descriptions-item>
                  </t-descriptions>
                </div>
              </div>
            </t-loading>
          </t-dialog>
          
          <!-- è°ƒæ•´ç§¯åˆ†å¯¹è¯æ¡† -->
          <t-dialog
            v-model:visible="pointsVisible"
            header="è°ƒæ•´ç§¯åˆ†"
            width="500px"
            @confirm="submitPoints"
            :confirm-btn="{ loading: pointsLoading }"
          >
            <t-form :data="pointsForm">
              <t-form-item label="è°ƒæ•´ç±»å‹">
                <t-radio-group v-model="pointsForm.type">
                  <t-radio value="merit">åŠŸå¾·ç§¯åˆ†</t-radio>
                  <t-radio value="cash">ç°é‡‘ç§¯åˆ†</t-radio>
                </t-radio-group>
              </t-form-item>
              
              <t-form-item label="è°ƒæ•´æ–¹å¼">
                <t-radio-group v-model="pointsForm.action">
                  <t-radio value="add">å¢åŠ </t-radio>
                  <t-radio value="subtract">æ‰£é™¤</t-radio>
                </t-radio-group>
              </t-form-item>
              
              <t-form-item label="è°ƒæ•´æ•°é‡">
                <t-input-number v-model="pointsForm.amount" :min="1" style="width: 100%;"></t-input-number>
              </t-form-item>
              
              <t-form-item label="è°ƒæ•´åŸå› " required>
                <t-textarea v-model="pointsForm.reason" placeholder="è¯·è¾“å…¥è°ƒæ•´åŸå› " :maxlength="200"></t-textarea>
              </t-form-item>
            </t-form>
          </t-dialog>
        </t-content>
      </t-layout>
    </t-layout>
  </div>

  <script src="../../assets/libs/vue.global.js"></script>
  <script src="../../assets/libs/tdesign.min.js"></script>
  <script src="../../assets/js/config.js"></script>
  <script src="../../assets/js/admin-api.js"></script>
  
  <script>
    const { createApp, ref, reactive, onMounted } = Vue;
    
    const app = createApp({
      setup() {
        // ç®¡ç†å‘˜ä¿¡æ¯
        const adminInfo = ref(null);
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const checkAuth = () => {
          adminInfo.value = AdminAPI.getCurrentAdmin();
          if (!adminInfo.value) {
            window.location.href = '../../login.html';
            return false;
          }
          return true;
        };
        
        // é€€å‡ºç™»å½•
        const handleLogout = () => {
          TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤é€€å‡º',
            body: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
            onConfirm: () => {
              AdminAPI.logout();
            }
          });
        };
        
        // èœå•åˆ‡æ¢
        const handleMenuChange = (value) => {
          const routes = {
            'dashboard': '../../index.html',
            'user-list': '../user/list.html',
            'user-referee': '../user/referee.html',
            'user-referee-logs': '../user/referee-logs.html',
            'order-list': '../order/list.html',
            'order-refund': '../order/refund.html',
            'withdraw-audit': '../order/withdraw-audit.html',
            'course-list': '../course/list.html',
            'schedule-list': '../course/schedule.html',
            'appointment-list': '../course/appointment.html',
            'case-list': '../course/case.html',
            'material-list': '../course/material.html',
            'ambassador-list': '../ambassador/list.html',
            'application-audit': '../ambassador/application-audit.html',
            'activity-list': '../ambassador/activity.html',
            'contract-list': '../ambassador/contract.html',
            'admin-list': '../system/admin.html',
            'config': '../system/config.html',
            'announcement-list': '../system/announcement.html',
            'feedback-list': '../system/feedback.html',
            'notification-list': '../system/notification.html',
            'level-config': '../system/level-config.html',
          };
          
          if (routes[value]) {
            window.location.href = routes[value];
          }
        };
        
        const loading = ref(false);
        const tableData = ref([]);
        const pagination = reactive({
          current: 1,
          pageSize: 20,
          total: 0,
        });
        
        const searchForm = reactive({
          keyword: '',
          ambassadorLevel: '',
          status: '',
        });
        
        const columns = [
          { colKey: 'id', title: 'ID', width: 80 },
          { colKey: 'real_name', title: 'å§“å', width: 100 },
          { colKey: 'phone', title: 'æ‰‹æœºå·', width: 130 },
          { colKey: 'ambassadorLevel', title: 'å¤§ä½¿ç­‰çº§', width: 120 },
          { colKey: 'meritPoints', title: 'åŠŸå¾·ç§¯åˆ†', width: 100 },
          { colKey: 'cashPoints', title: 'ç°é‡‘ç§¯åˆ†', width: 100 },
          { colKey: 'status', title: 'çŠ¶æ€', width: 80 },
          { colKey: 'action', title: 'æ“ä½œ', width: 200, fixed: 'right' },
        ];
        
        // è¯¦æƒ…å¯¹è¯æ¡†
        const detailVisible = ref(false);
        const detailLoading = ref(false);
        const currentAmbassador = ref(null);
        
        // ç§¯åˆ†è°ƒæ•´
        const pointsVisible = ref(false);
        const pointsLoading = ref(false);
        const pointsForm = reactive({
          type: 'merit',
          action: 'add',
          amount: 0,
          reason: '',
        });
        
        // åŠ è½½æ•°æ®
        const loadData = async () => {
          loading.value = true;
          try {
            const result = await AdminAPI.getAmbassadorList({
              page: pagination.current,
              pageSize: pagination.pageSize,
              keyword: searchForm.keyword,
              ambassadorLevel: searchForm.ambassadorLevel,
              status: searchForm.status,
            });
            
            tableData.value = result.list || [];
            pagination.total = result.total || 0;
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½å¤±è´¥: ' + error.message);
          } finally {
            loading.value = false;
          }
        };
        
        // æœç´¢
        const handleSearch = () => {
          pagination.current = 1;
          loadData();
        };
        
        // é‡ç½®
        const handleReset = () => {
          searchForm.keyword = '';
          searchForm.ambassadorLevel = '';
          searchForm.status = '';
          handleSearch();
        };
        
        // åˆ†é¡µ
        const onPageChange = (pageInfo) => {
          pagination.current = pageInfo.current;
          pagination.pageSize = pageInfo.pageSize;
          loadData();
        };
        
        // æŸ¥çœ‹è¯¦æƒ…ï¼ˆè°ƒç”¨ getAmbassadorDetail æ¥å£ï¼‰
        const viewDetail = async (row) => {
          detailVisible.value = true;
          detailLoading.value = true;
          try {
            currentAmbassador.value = await AdminAPI.getAmbassadorDetail(row.user_id || row.id);
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½å¤§ä½¿è¯¦æƒ…å¤±è´¥: ' + error.message);
            // é™çº§ä½¿ç”¨åˆ—è¡¨æ•°æ®
            currentAmbassador.value = row;
          } finally {
            detailLoading.value = false;
          }
        };
        
        // è°ƒæ•´ç§¯åˆ†
        const adjustPoints = (row) => {
          currentAmbassador.value = row;
          pointsForm.type = 'merit';
          pointsForm.action = 'add';
          pointsForm.amount = 0;
          pointsForm.reason = '';
          pointsVisible.value = true;
        };
        
        // æäº¤ç§¯åˆ†è°ƒæ•´
        const submitPoints = async () => {
          if (!pointsForm.amount || !pointsForm.reason) {
            TDesign.MessagePlugin.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
            return;
          }
          
          pointsLoading.value = true;
          try {
            await AdminAPI.adjustAmbassadorPoints({
              userId: currentAmbassador.value.id || currentAmbassador.value.user_id,
              ...pointsForm,
            });
            TDesign.MessagePlugin.success('è°ƒæ•´æˆåŠŸ');
            pointsVisible.value = false;
            loadData();
          } catch (error) {
            TDesign.MessagePlugin.error('è°ƒæ•´å¤±è´¥: ' + error.message);
          } finally {
            pointsLoading.value = false;
          }
        };
        
        // å‡çº§
        const upgrade = async (row) => {
          const levels = {
            1: 'é’é¸¾ä½¿è€…',
            2: 'é’é¸¾å¤§ä½¿',
            3: 'é¸¿é¹„ä½¿è€…',
            4: 'é¸¿é¹„å¤§ä½¿'
          };
          
          const nextLevel = row.ambassador_level + 1;
          if (nextLevel > 4) {
            TDesign.MessagePlugin.warning('å·²æ˜¯æœ€é«˜ç­‰çº§');
            return;
          }
          
          const confirmed = await TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤å‡çº§',
            body: `ç¡®è®¤å°† ${row.real_name} å‡çº§ä¸º ${levels[nextLevel]} å—ï¼Ÿ`,
            theme: 'warning',
          });
          
          if (!confirmed) return;
          
          try {
            await AdminAPI.upgradeAmbassador({
              userId: row.id || row.user_id,
              targetLevel: nextLevel,
            });
            TDesign.MessagePlugin.success('å‡çº§æˆåŠŸ');
            loadData();
          } catch (error) {
            TDesign.MessagePlugin.error('å‡çº§å¤±è´¥: ' + error.message);
          }
        };
        
        // è¾…åŠ©æ–¹æ³•
        const getLevelTheme = (level) => {
          const themes = { 1: 'primary', 2: 'success', 3: 'warning', 4: 'danger' };
          return themes[level] || 'default';
        };
        
        const getLevelText = (level) => {
          const texts = { 1: 'é’é¸¾ä½¿è€…', 2: 'é’é¸¾å¤§ä½¿', 3: 'é¸¿é¹„ä½¿è€…', 4: 'é¸¿é¹„å¤§ä½¿' };
          return texts[level] || 'æ™®é€šç”¨æˆ·';
        };
        
        const getContractStatusTheme = (status) => {
          const themes = { 1: 'success', 2: 'warning', 3: 'danger' };
          return themes[status] || 'default';
        };
        
        const getContractStatusText = (status) => {
          const texts = { 1: 'ç”Ÿæ•ˆä¸­', 2: 'å³å°†åˆ°æœŸ', 3: 'å·²åˆ°æœŸ' };
          return texts[status] || 'æœªçŸ¥';
        };
        
        const formatDateTime = (datetime) => {
          if (!datetime) return '-';
          return new Date(datetime).toLocaleString('zh-CN');
        };
        
        const formatDate = (date) => {
          if (!date) return '-';
          return new Date(date).toLocaleDateString('zh-CN');
        };
        
        onMounted(() => {
          if (checkAuth()) {
            loadData();
          }
        });
        
        return {
          adminInfo,
          handleLogout,
          handleMenuChange,
          loading,
          tableData,
          pagination,
          searchForm,
          columns,
          detailVisible,
          detailLoading,
          currentAmbassador,
          pointsVisible,
          pointsLoading,
          pointsForm,
          handleSearch,
          handleReset,
          onPageChange,
          viewDetail,
          adjustPoints,
          submitPoints,
          upgrade,
          getLevelTheme,
          getLevelText,
          getContractStatusTheme,
          getContractStatusText,
          formatDateTime,
          formatDate,
        };
      }
    });
    
    app.use(TDesign);
    app.mount('#app');
  </script>
</body>
</html>

