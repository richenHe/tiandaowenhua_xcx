<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­¦é™¢å†…å®¹ç®¡ç† - å¤©é“æ–‡åŒ–åå°</title>
  
  <link rel="stylesheet" href="../../assets/libs/tdesign.min.css">
  <link rel="stylesheet" href="../../assets/css/tokens.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
    }
    
    .t-layout {
      height: 100vh;
    }
    
    .t-layout__sider {
      background: #fff;
      border-right: 1px solid #dcdcdc;
      width: 240px !important;
      flex-shrink: 0;
    }
    
    .page-content {
      padding: 24px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    
    .page-header {
      margin-bottom: 24px;
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 600;
    }
    
    .table-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
    }
    
    .toolbar {
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="app">
    <t-layout style="height: 100vh;">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <t-header height="64px" style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
        background: #fff;
        border-bottom: 1px solid #dcdcdc;
      ">
        <div style="display: flex; align-items: center; gap: 16px;">
          <span style="font-size: 18px; font-weight: 600; color: #333;">ğŸ¨ å¤©é“æ–‡åŒ–åå°ç®¡ç†</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span>{{ adminInfo?.real_name || adminInfo?.username || 'ç®¡ç†å‘˜' }}</span>
          <t-button size="small" @click="handleLogout">é€€å‡º</t-button>
        </div>
      </t-header>
      
      <t-layout>
        <!-- ä¾§è¾¹èœå• -->
        <t-aside width="240px" style="
          background: #fff;
          border-right: 1px solid #dcdcdc;
          overflow-y: auto;
        ">
          <t-menu
            value="academy-content"
            :default-expanded="['user', 'order', 'course', 'ambassador', 'system']"
            theme="light"
            @change="handleMenuChange"
          >
            <t-menu-item value="dashboard">
              <template #icon><t-icon name="dashboard" /></template>
              æ•°æ®æ¦‚è§ˆ
            </t-menu-item>
            
            <t-submenu value="user">
              <template #icon><t-icon name="user" /></template>
              <template #title>ç”¨æˆ·ç®¡ç†</template>
              <t-menu-item value="user-list">å­¦å‘˜åˆ—è¡¨</t-menu-item>
              <t-menu-item value="user-referee">æ¨èå…³ç³»æŸ¥è¯¢</t-menu-item>
              <t-menu-item value="user-referee-logs">æ¨èäººå˜æ›´è®°å½•</t-menu-item>
            </t-submenu>
            
            <t-submenu value="order">
              <template #icon><t-icon name="order" /></template>
              <template #title>è®¢å•ç®¡ç†</template>
              <t-menu-item value="order-list">è®¢å•åˆ—è¡¨</t-menu-item>
              <t-menu-item value="order-refund">é€€æ¬¾ç®¡ç†</t-menu-item>
              <t-menu-item value="withdraw-audit">æç°å®¡æ ¸</t-menu-item>
            </t-submenu>
            
            <t-submenu value="course">
              <template #icon><t-icon name="file" /></template>
              <template #title>è¯¾ç¨‹ç®¡ç†</template>
              <t-menu-item value="course-list">è¯¾ç¨‹åˆ—è¡¨</t-menu-item>
              <t-menu-item value="schedule-list">æ’æœŸç®¡ç†</t-menu-item>
              <t-menu-item value="appointment-list">é¢„çº¦ç®¡ç†</t-menu-item>
              <t-menu-item value="case-list">æ¡ˆä¾‹ç®¡ç†</t-menu-item>
              <t-menu-item value="material-list">èµ„æ–™ç®¡ç†</t-menu-item>
              <t-menu-item value="academy-content">å­¦é™¢å†…å®¹</t-menu-item>
            </t-submenu>
            
            <t-submenu value="ambassador">
              <template #icon><t-icon name="usergroup" /></template>
              <template #title>å¤§ä½¿ç®¡ç†</template>
              <t-menu-item value="ambassador-list">å¤§ä½¿åˆ—è¡¨</t-menu-item>
              <t-menu-item value="application-audit">ç”³è¯·å®¡æ ¸</t-menu-item>
              <t-menu-item value="activity-list">æ´»åŠ¨ç®¡ç†</t-menu-item>
              <t-menu-item value="contract-list">åˆçº¦ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="system">
              <template #icon><t-icon name="setting" /></template>
              <template #title>ç³»ç»Ÿç®¡ç†</template>
              <t-menu-item value="admin-list">ç®¡ç†å‘˜ç®¡ç†</t-menu-item>
              <t-menu-item value="config">ç³»ç»Ÿé…ç½®</t-menu-item>
              <t-menu-item value="announcement-list">å…¬å‘Šç®¡ç†</t-menu-item>
              <t-menu-item value="feedback-list">åé¦ˆç®¡ç†</t-menu-item>
              <t-menu-item value="notification-list">é€šçŸ¥ç®¡ç†</t-menu-item>
              <t-menu-item value="level-config">ç­‰çº§é…ç½®</t-menu-item>
            </t-submenu>
          </t-menu>
        </t-aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <t-content class="page-content">
          <!-- é¡µé¢å¤´éƒ¨ -->
          <div class="page-header">
            <h1 class="page-title">å­¦é™¢å†…å®¹ç®¡ç†</h1>
          </div>
          
          <!-- æ ‡ç­¾é¡µ -->
          <t-tabs v-model="activeTab" @change="handleTabChange">
            <t-tab-panel value="courses" label="è¯¾ç¨‹åˆ—è¡¨"></t-tab-panel>
            <t-tab-panel value="chapters" label="ç« èŠ‚ç®¡ç†"></t-tab-panel>
            <t-tab-panel value="videos" label="è§†é¢‘ç®¡ç†"></t-tab-panel>
            <t-tab-panel value="materials" label="èµ„æ–™ç®¡ç†"></t-tab-panel>
          </t-tabs>
          
          <!-- è¯¾ç¨‹åˆ—è¡¨ -->
          <div class="table-card" v-if="activeTab === 'courses'">
            <div class="toolbar">
              <t-space>
                <t-input v-model="searchKeyword" placeholder="æœç´¢è¯¾ç¨‹åç§°" clearable style="width: 200px;"></t-input>
                <t-button theme="primary" @click="loadCourses">æŸ¥è¯¢</t-button>
              </t-space>
              <t-button theme="primary" @click="createCourse">
                <template #icon><t-icon name="add" /></template>
                æ–°å»ºè¯¾ç¨‹
              </t-button>
            </div>
            
            <t-table
              :data="courses"
              :columns="courseColumns"
              :loading="loading"
              row-key="id"
            >
              <template #status="{ row }">
                <t-tag :theme="row.status === 1 ? 'success' : 'default'">
                  {{ row.status === 1 ? 'ä¸Šæ¶' : 'ä¸‹æ¶' }}
                </t-tag>
              </template>
              
              <template #operation="{ row }">
                <t-space>
                  <t-button size="small" variant="text" theme="primary" @click="editCourse(row)">ç¼–è¾‘</t-button>
                  <t-button size="small" variant="text" theme="default" @click="viewChapters(row)">ç« èŠ‚</t-button>
                  <t-button size="small" variant="text" theme="danger" @click="deleteCourse(row)">åˆ é™¤</t-button>
                </t-space>
              </template>
            </t-table>
          </div>
          
          <!-- ç« èŠ‚ç®¡ç† -->
          <div class="table-card" v-if="activeTab === 'chapters'">
            <div class="toolbar">
              <t-select v-model="selectedCourseId" placeholder="é€‰æ‹©è¯¾ç¨‹" style="width: 200px;" @change="loadChapters">
                <t-option v-for="course in courses" :key="course.id" :value="course.id" :label="course.name"></t-option>
              </t-select>
              <t-button theme="primary" @click="createChapter" :disabled="!selectedCourseId">
                <template #icon><t-icon name="add" /></template>
                æ–°å»ºç« èŠ‚
              </t-button>
            </div>
            
            <t-table
              :data="chapters"
              :columns="chapterColumns"
              :loading="loading"
              row-key="id"
            >
              <template #operation="{ row }">
                <t-space>
                  <t-button size="small" variant="text" theme="primary" @click="editChapter(row)">ç¼–è¾‘</t-button>
                  <t-button size="small" variant="text" theme="default" @click="viewVideos(row)">è§†é¢‘</t-button>
                  <t-button size="small" variant="text" theme="danger" @click="deleteChapter(row)">åˆ é™¤</t-button>
                </t-space>
              </template>
            </t-table>
          </div>
          
          <!-- è§†é¢‘ç®¡ç† -->
          <div class="table-card" v-if="activeTab === 'videos'">
            <div class="toolbar">
              <t-space>
                <t-select v-model="selectedCourseId" placeholder="é€‰æ‹©è¯¾ç¨‹" style="width: 150px;" @change="loadChaptersByCourse">
                  <t-option v-for="course in courses" :key="course.id" :value="course.id" :label="course.name"></t-option>
                </t-select>
                <t-select v-model="selectedChapterId" placeholder="é€‰æ‹©ç« èŠ‚" style="width: 150px;" @change="loadVideos" :disabled="!selectedCourseId">
                  <t-option v-for="chapter in chapters" :key="chapter.id" :value="chapter.id" :label="chapter.title"></t-option>
                </t-select>
              </t-space>
              <t-button theme="primary" @click="uploadVideo" :disabled="!selectedChapterId">
                <template #icon><t-icon name="upload" /></template>
                ä¸Šä¼ è§†é¢‘
              </t-button>
            </div>
            
            <t-table
              :data="videos"
              :columns="videoColumns"
              :loading="loading"
              row-key="id"
            >
              <template #duration="{ row }">
                {{ formatDuration(row.duration) }}
              </template>
              
              <template #operation="{ row }">
                <t-space>
                  <t-button size="small" variant="text" theme="primary" @click="playVideo(row)">æ’­æ”¾</t-button>
                  <t-button size="small" variant="text" theme="default" @click="editVideo(row)">ç¼–è¾‘</t-button>
                  <t-button size="small" variant="text" theme="danger" @click="deleteVideo(row)">åˆ é™¤</t-button>
                </t-space>
              </template>
            </t-table>
          </div>
          
          <!-- èµ„æ–™ç®¡ç† -->
          <div class="table-card" v-if="activeTab === 'materials'">
            <div class="toolbar">
              <t-select v-model="selectedCourseId" placeholder="é€‰æ‹©è¯¾ç¨‹" style="width: 200px;" @change="loadMaterials">
                <t-option v-for="course in courses" :key="course.id" :value="course.id" :label="course.name"></t-option>
              </t-select>
              <t-button theme="primary" @click="uploadMaterial" :disabled="!selectedCourseId">
                <template #icon><t-icon name="upload" /></template>
                ä¸Šä¼ èµ„æ–™
              </t-button>
            </div>
            
            <t-table
              :data="materials"
              :columns="materialColumns"
              :loading="loading"
              row-key="id"
            >
              <template #fileType="{ row }">
                <t-tag>{{ row.file_type }}</t-tag>
              </template>
              
              <template #fileSize="{ row }">
                {{ formatFileSize(row.file_size) }}
              </template>
              
              <template #operation="{ row }">
                <t-space>
                  <t-button size="small" variant="text" theme="primary" @click="downloadMaterial(row)">ä¸‹è½½</t-button>
                  <t-button size="small" variant="text" theme="default" @click="editMaterial(row)">ç¼–è¾‘</t-button>
                  <t-button size="small" variant="text" theme="danger" @click="deleteMaterial(row)">åˆ é™¤</t-button>
                </t-space>
              </template>
            </t-table>
          </div>
        </t-content>
      </t-layout>
    </t-layout>
  </div>

  <script src="../../assets/libs/vue.global.js"></script>
  <script src="../../assets/libs/tdesign.min.js"></script>
  <script src="../../assets/js/config.js"></script>
  <script src="../../assets/js/admin-api.js"></script>
  
  <script>
    const { createApp, ref, reactive, onMounted } = Vue;
    
    const app = createApp({
      setup() {
        // ç®¡ç†å‘˜ä¿¡æ¯
        const adminInfo = ref(null);
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const checkAuth = () => {
          adminInfo.value = AdminAPI.getCurrentAdmin();
          if (!adminInfo.value) {
            window.location.href = '../../login.html';
            return false;
          }
          return true;
        };
        
        // é€€å‡ºç™»å½•
        const handleLogout = () => {
          TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤é€€å‡º',
            body: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
            onConfirm: () => {
              AdminAPI.logout();
            }
          });
        };
        
        // èœå•åˆ‡æ¢
        const handleMenuChange = (value) => {
          const routes = {
            'dashboard': '../../index.html',
            'user-list': '../user/list.html',
            'user-referee': '../user/referee.html',
            'user-referee-logs': '../user/referee-logs.html',
            'order-list': '../order/list.html',
            'order-refund': '../order/refund.html',
            'withdraw-audit': '../order/withdraw-audit.html',
            'course-list': '../course/list.html',
            'schedule-list': '../course/schedule.html',
            'appointment-list': '../course/appointment.html',
            'case-list': '../course/case.html',
            'material-list': '../course/material.html',
            'academy-content': '../course/academy.html',
            'ambassador-list': '../ambassador/list.html',
            'application-audit': '../ambassador/application-audit.html',
            'activity-list': '../ambassador/activity.html',
            'contract-list': '../ambassador/contract.html',
            'admin-list': '../system/admin.html',
            'config': '../system/config.html',
            'announcement-list': '../system/announcement.html',
            'feedback-list': '../system/feedback.html',
            'notification-list': '../system/notification.html',
            'level-config': '../system/level-config.html',
          };
          
          if (routes[value]) {
            window.location.href = routes[value];
          }
        };
        
        const loading = ref(false);
        const activeTab = ref('courses');
        const searchKeyword = ref('');
        const selectedCourseId = ref(null);
        const selectedChapterId = ref(null);
        
        // æ•°æ®
        const courses = ref([]);
        const chapters = ref([]);
        const videos = ref([]);
        const materials = ref([]);
        
        // è¡¨æ ¼åˆ—å®šä¹‰
        const courseColumns = [
          { colKey: 'id', title: 'ID', width: 80 },
          { colKey: 'name', title: 'è¯¾ç¨‹åç§°', width: 200 },
          { colKey: 'category', title: 'åˆ†ç±»', width: 100 },
          { colKey: 'status', title: 'çŠ¶æ€', width: 80 },
          { colKey: 'created_at', title: 'åˆ›å»ºæ—¶é—´', width: 160 },
          { colKey: 'operation', title: 'æ“ä½œ', width: 200, fixed: 'right' },
        ];
        
        const chapterColumns = [
          { colKey: 'id', title: 'ID', width: 80 },
          { colKey: 'title', title: 'ç« èŠ‚æ ‡é¢˜', width: 250 },
          { colKey: 'sort_order', title: 'æ’åº', width: 80 },
          { colKey: 'video_count', title: 'è§†é¢‘æ•°é‡', width: 100 },
          { colKey: 'created_at', title: 'åˆ›å»ºæ—¶é—´', width: 160 },
          { colKey: 'operation', title: 'æ“ä½œ', width: 200, fixed: 'right' },
        ];
        
        const videoColumns = [
          { colKey: 'id', title: 'ID', width: 80 },
          { colKey: 'title', title: 'è§†é¢‘æ ‡é¢˜', width: 250 },
          { colKey: 'duration', title: 'æ—¶é•¿', width: 100 },
          { colKey: 'sort_order', title: 'æ’åº', width: 80 },
          { colKey: 'created_at', title: 'ä¸Šä¼ æ—¶é—´', width: 160 },
          { colKey: 'operation', title: 'æ“ä½œ', width: 200, fixed: 'right' },
        ];
        
        const materialColumns = [
          { colKey: 'id', title: 'ID', width: 80 },
          { colKey: 'title', title: 'èµ„æ–™æ ‡é¢˜', width: 250 },
          { colKey: 'fileType', title: 'æ–‡ä»¶ç±»å‹', width: 100 },
          { colKey: 'fileSize', title: 'æ–‡ä»¶å¤§å°', width: 100 },
          { colKey: 'created_at', title: 'ä¸Šä¼ æ—¶é—´', width: 160 },
          { colKey: 'operation', title: 'æ“ä½œ', width: 200, fixed: 'right' },
        ];
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        const handleTabChange = (value) => {
          activeTab.value = value;
          if (value === 'courses') {
            loadCourses();
          }
        };
        
        // åŠ è½½è¯¾ç¨‹åˆ—è¡¨
        const loadCourses = async () => {
          loading.value = true;
          try {
            const result = await AdminAPI.manageAcademyContent({
              action: 'list_courses',
              data: { keyword: searchKeyword.value }
            });
            courses.value = result.list || [];
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½è¯¾ç¨‹å¤±è´¥: ' + error.message);
          } finally {
            loading.value = false;
          }
        };
        
        // åŠ è½½ç« èŠ‚åˆ—è¡¨
        const loadChapters = async () => {
          if (!selectedCourseId.value) return;
          
          loading.value = true;
          try {
            const result = await AdminAPI.manageAcademyContent({
              action: 'list_chapters',
              data: { courseId: selectedCourseId.value }
            });
            chapters.value = result.list || [];
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½ç« èŠ‚å¤±è´¥: ' + error.message);
          } finally {
            loading.value = false;
          }
        };
        
        // æ ¹æ®è¯¾ç¨‹åŠ è½½ç« èŠ‚
        const loadChaptersByCourse = () => {
          selectedChapterId.value = null;
          loadChapters();
        };
        
        // åŠ è½½è§†é¢‘åˆ—è¡¨
        const loadVideos = async () => {
          if (!selectedChapterId.value) return;
          
          loading.value = true;
          try {
            const result = await AdminAPI.manageAcademyContent({
              action: 'list_videos',
              data: { chapterId: selectedChapterId.value }
            });
            videos.value = result.list || [];
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½è§†é¢‘å¤±è´¥: ' + error.message);
          } finally {
            loading.value = false;
          }
        };
        
        // åŠ è½½èµ„æ–™åˆ—è¡¨
        const loadMaterials = async () => {
          if (!selectedCourseId.value) return;
          
          loading.value = true;
          try {
            const result = await AdminAPI.manageAcademyContent({
              action: 'list_materials',
              data: { courseId: selectedCourseId.value }
            });
            materials.value = result.list || [];
          } catch (error) {
            TDesign.MessagePlugin.error('åŠ è½½èµ„æ–™å¤±è´¥: ' + error.message);
          } finally {
            loading.value = false;
          }
        };
        
        // CRUDæ“ä½œ
        const createCourse = () => {
          TDesign.MessagePlugin.info('æ–°å»ºè¯¾ç¨‹åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const editCourse = (row) => {
          TDesign.MessagePlugin.info('ç¼–è¾‘è¯¾ç¨‹åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const deleteCourse = async (row) => {
          const confirmed = await TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤åˆ é™¤',
            body: `ç¡®å®šè¦åˆ é™¤è¯¾ç¨‹"${row.name}"å—ï¼Ÿ`,
            theme: 'warning',
          });
          
          if (!confirmed) return;
          
          try {
            await AdminAPI.manageAcademyContent({
              action: 'delete_course',
              data: { id: row.id }
            });
            TDesign.MessagePlugin.success('åˆ é™¤æˆåŠŸ');
            loadCourses();
          } catch (error) {
            TDesign.MessagePlugin.error('åˆ é™¤å¤±è´¥: ' + error.message);
          }
        };
        
        const viewChapters = (row) => {
          activeTab.value = 'chapters';
          selectedCourseId.value = row.id;
          loadChapters();
        };
        
        const createChapter = () => {
          TDesign.MessagePlugin.info('æ–°å»ºç« èŠ‚åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const editChapter = (row) => {
          TDesign.MessagePlugin.info('ç¼–è¾‘ç« èŠ‚åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const deleteChapter = async (row) => {
          const confirmed = await TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤åˆ é™¤',
            body: `ç¡®å®šè¦åˆ é™¤ç« èŠ‚"${row.title}"å—ï¼Ÿ`,
            theme: 'warning',
          });
          
          if (!confirmed) return;
          
          try {
            await AdminAPI.manageAcademyContent({
              action: 'delete_chapter',
              data: { id: row.id }
            });
            TDesign.MessagePlugin.success('åˆ é™¤æˆåŠŸ');
            loadChapters();
          } catch (error) {
            TDesign.MessagePlugin.error('åˆ é™¤å¤±è´¥: ' + error.message);
          }
        };
        
        const viewVideos = (row) => {
          activeTab.value = 'videos';
          selectedChapterId.value = row.id;
          loadVideos();
        };
        
        const uploadVideo = () => {
          TDesign.MessagePlugin.info('ä¸Šä¼ è§†é¢‘åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const playVideo = (row) => {
          TDesign.MessagePlugin.info('è§†é¢‘æ’­æ”¾åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const editVideo = (row) => {
          TDesign.MessagePlugin.info('ç¼–è¾‘è§†é¢‘åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const deleteVideo = async (row) => {
          const confirmed = await TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤åˆ é™¤',
            body: `ç¡®å®šè¦åˆ é™¤è§†é¢‘"${row.title}"å—ï¼Ÿ`,
            theme: 'warning',
          });
          
          if (!confirmed) return;
          
          try {
            await AdminAPI.manageAcademyContent({
              action: 'delete_video',
              data: { id: row.id }
            });
            TDesign.MessagePlugin.success('åˆ é™¤æˆåŠŸ');
            loadVideos();
          } catch (error) {
            TDesign.MessagePlugin.error('åˆ é™¤å¤±è´¥: ' + error.message);
          }
        };
        
        const uploadMaterial = () => {
          TDesign.MessagePlugin.info('ä¸Šä¼ èµ„æ–™åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const downloadMaterial = (row) => {
          if (row.file_url) {
            window.open(row.file_url, '_blank');
          } else {
            TDesign.MessagePlugin.warning('æ–‡ä»¶åœ°å€ä¸å­˜åœ¨');
          }
        };
        
        const editMaterial = (row) => {
          TDesign.MessagePlugin.info('ç¼–è¾‘èµ„æ–™åŠŸèƒ½å¼€å‘ä¸­...');
        };
        
        const deleteMaterial = async (row) => {
          const confirmed = await TDesign.DialogPlugin.confirm({
            header: 'ç¡®è®¤åˆ é™¤',
            body: `ç¡®å®šè¦åˆ é™¤èµ„æ–™"${row.title}"å—ï¼Ÿ`,
            theme: 'warning',
          });
          
          if (!confirmed) return;
          
          try {
            await AdminAPI.manageAcademyContent({
              action: 'delete_material',
              data: { id: row.id }
            });
            TDesign.MessagePlugin.success('åˆ é™¤æˆåŠŸ');
            loadMaterials();
          } catch (error) {
            TDesign.MessagePlugin.error('åˆ é™¤å¤±è´¥: ' + error.message);
          }
        };
        
        // è¾…åŠ©å‡½æ•°
        const formatDuration = (seconds) => {
          if (!seconds) return '-';
          const minutes = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${minutes}:${secs.toString().padStart(2, '0')}`;
        };
        
        const formatFileSize = (bytes) => {
          if (!bytes) return '-';
          const sizes = ['B', 'KB', 'MB', 'GB'];
          const i = Math.floor(Math.log(bytes) / Math.log(1024));
          return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;
        };
        
        onMounted(() => {
          if (checkAuth()) {
            loadCourses();
          }
        });
        
        return {
          adminInfo,
          handleLogout,
          handleMenuChange,
          loading,
          activeTab,
          searchKeyword,
          selectedCourseId,
          selectedChapterId,
          courses,
          chapters,
          videos,
          materials,
          courseColumns,
          chapterColumns,
          videoColumns,
          materialColumns,
          handleTabChange,
          loadCourses,
          loadChapters,
          loadChaptersByCourse,
          loadVideos,
          loadMaterials,
          createCourse,
          editCourse,
          deleteCourse,
          viewChapters,
          createChapter,
          editChapter,
          deleteChapter,
          viewVideos,
          uploadVideo,
          playVideo,
          editVideo,
          deleteVideo,
          uploadMaterial,
          downloadMaterial,
          editMaterial,
          deleteMaterial,
          formatDuration,
          formatFileSize,
        };
      }
    });
    
    app.use(TDesign);
    app.mount('#app');
  </script>
</body>
</html>

