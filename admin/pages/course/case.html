<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>æ¡ˆä¾‹ç®¡ç†</title><link rel="stylesheet" href="../../assets/libs/tdesign.min.css"><link rel="stylesheet" href="../../assets/css/tokens.css"><style>body{margin:0;padding:20px;background:#f5f5f5;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}.page-container{max-width:1400px;margin:0 auto;background:white;border-radius:8px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.page-header{margin-bottom:24px}.page-title{font-size:20px;font-weight:600;color:#333;margin:0 0 8px 0}.page-desc{font-size:14px;color:#999;margin:0}.search-bar{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}</style></head>
<body>
  <div id="app">
    <t-layout style="height: 100vh;">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <t-header height="64px" style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
        background: #fff;
        border-bottom: 1px solid #dcdcdc;
      ">
        <div style="display: flex; align-items: center; gap: 16px;">
          <span style="font-size: 18px; font-weight: 600; color: #333;">ğŸ¨ å¤©é“æ–‡åŒ–åå°ç®¡ç†</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span>{{ adminInfo?.real_name || adminInfo?.username || 'ç®¡ç†å‘˜' }}</span>
          <t-button size="small" @click="handleLogout">é€€å‡º</t-button>
        </div>
      </t-header>
      
      <t-layout>
        <!-- ä¾§è¾¹èœå• -->
        <t-aside width="240px" style="
          background: #fff;
          border-right: 1px solid #dcdcdc;
          overflow-y: auto;
        ">
          <t-menu
            value="case-list"
            :default-expanded="['user', 'order', 'course', 'ambassador', 'system']"
            theme="light"
            @change="handleMenuChange"
          >
            <t-menu-item value="dashboard">
              <template #icon><t-icon name="dashboard" /></template>
              æ•°æ®æ¦‚è§ˆ
            </t-menu-item>
            
            <t-submenu value="user">
              <template #icon><t-icon name="user" /></template>
              <template #title>ç”¨æˆ·ç®¡ç†</template>
              <t-menu-item value="user-list">å­¦å‘˜åˆ—è¡¨</t-menu-item>
              <t-menu-item value="user-referee">æ¨èäººç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="order">
              <template #icon><t-icon name="order" /></template>
              <template #title>è®¢å•ç®¡ç†</template>
              <t-menu-item value="order-list">è®¢å•åˆ—è¡¨</t-menu-item>
              <t-menu-item value="order-refund">é€€æ¬¾ç®¡ç†</t-menu-item>
              <t-menu-item value="withdraw-audit">æç°å®¡æ ¸</t-menu-item>
            </t-submenu>
            
            <t-submenu value="course">
              <template #icon><t-icon name="file" /></template>
              <template #title>è¯¾ç¨‹ç®¡ç†</template>
              <t-menu-item value="course-list">è¯¾ç¨‹åˆ—è¡¨</t-menu-item>
              <t-menu-item value="schedule-list">æ’æœŸç®¡ç†</t-menu-item>
              <t-menu-item value="appointment-list">é¢„çº¦ç®¡ç†</t-menu-item>
              <t-menu-item value="case-list">æ¡ˆä¾‹ç®¡ç†</t-menu-item>
              <t-menu-item value="material-list">èµ„æ–™ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="ambassador">
              <template #icon><t-icon name="usergroup" /></template>
              <template #title>å¤§ä½¿ç®¡ç†</template>
              <t-menu-item value="ambassador-list">å¤§ä½¿åˆ—è¡¨</t-menu-item>
              <t-menu-item value="application-audit">ç”³è¯·å®¡æ ¸</t-menu-item>
              <t-menu-item value="activity-list">æ´»åŠ¨ç®¡ç†</t-menu-item>
              <t-menu-item value="contract-list">åˆçº¦ç®¡ç†</t-menu-item>
            </t-submenu>
            
            <t-submenu value="system">
              <template #icon><t-icon name="setting" /></template>
              <template #title>ç³»ç»Ÿç®¡ç†</template>
              <t-menu-item value="admin-list">ç®¡ç†å‘˜ç®¡ç†</t-menu-item>
              <t-menu-item value="config">ç³»ç»Ÿé…ç½®</t-menu-item>
              <t-menu-item value="announcement-list">å…¬å‘Šç®¡ç†</t-menu-item>
              <t-menu-item value="feedback-list">åé¦ˆç®¡ç†</t-menu-item>
              <t-menu-item value="notification-list">é€šçŸ¥ç®¡ç†</t-menu-item>
              <t-menu-item value="level-config">ç­‰çº§é…ç½®</t-menu-item>
            </t-submenu>
          </t-menu>
        </t-aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <t-content class="page-content"><div class="page-container"><div class="page-header"><h1 class="page-title">æ¡ˆä¾‹ç®¡ç†</h1><p class="page-desc">ç®¡ç†è¯¾ç¨‹æ¡ˆä¾‹ï¼Œå±•ç¤ºå­¦å‘˜æˆæœ</p></div><div class="search-bar"><t-input v-model="filters.keyword" placeholder="æ¡ˆä¾‹æ ‡é¢˜" clearable style="width:200px;"><template #prefix-icon><t-icon name="search"/></template></t-input><t-select v-model="filters.courseId" :options="courseOptions" placeholder="å…³è”è¯¾ç¨‹" clearable style="width:200px;"/><t-button theme="primary" @click="handleSearch"><template #icon><t-icon name="search"/></template>æŸ¥è¯¢</t-button><t-button theme="default" @click="handleReset"><template #icon><t-icon name="refresh"/></template>é‡ç½®</t-button><t-button theme="success" @click="handleAdd"><template #icon><t-icon name="add"/></template>æ–°å¢æ¡ˆä¾‹</t-button></div><t-table :data="tableData" :columns="columns" :loading="loading" :pagination="pagination" @page-change="handlePageChange" row-key="id" bordered stripe hover><template #cover="{ row }"><t-image :src="row.cover" style="width:80px;height:60px;border-radius:4px;" fit="cover"/></template><template #status="{ row }"><t-tag v-if="row.status===1" theme="success">æ˜¾ç¤º</t-tag><t-tag v-else theme="default">éšè—</t-tag></template><template #operation="{ row }"><t-space size="small"><t-button theme="primary" size="small" variant="text" @click="handleEdit(row)">ç¼–è¾‘</t-button><t-button :theme="row.status===1?'warning':'success'" size="small" variant="text" @click="handleToggleStatus(row)">{{row.status===1?'éšè—':'æ˜¾ç¤º'}}</t-button><t-button theme="danger" size="small" variant="text" @click="handleDelete(row)">åˆ é™¤</t-button></t-space></template></t-table></div><t-dialog v-model:visible="formVisible" :header="formMode==='add'?'æ–°å¢æ¡ˆä¾‹':'ç¼–è¾‘æ¡ˆä¾‹'" width="700px" @confirm="handleSubmit"><t-form ref="form" :data="formData" :rules="rules" label-width="100px"><t-form-item label="æ¡ˆä¾‹æ ‡é¢˜" name="title"><t-input v-model="formData.title" placeholder="è¯·è¾“å…¥æ¡ˆä¾‹æ ‡é¢˜"/></t-form-item><t-form-item label="å°é¢å›¾ç‰‡" name="cover"><t-input v-model="formData.cover" placeholder="å›¾ç‰‡URL"/></t-form-item><t-form-item label="å…³è”è¯¾ç¨‹" name="course_id"><t-select v-model="formData.course_id" :options="courseOptions" placeholder="é€‰æ‹©è¯¾ç¨‹"/></t-form-item><t-form-item label="æ¡ˆä¾‹æè¿°" name="description"><t-textarea v-model="formData.description" placeholder="è¯·è¾“å…¥æ¡ˆä¾‹æè¿°" :maxlength="500" :autosize="{minRows:4,maxRows:8}"/></t-form-item><t-form-item label="æ¡ˆä¾‹å†…å®¹" name="content"><t-textarea v-model="formData.content" placeholder="è¯·è¾“å…¥è¯¦ç»†å†…å®¹" :maxlength="5000" :autosize="{minRows:6,maxRows:12}"/></t-form-item><t-form-item label="æ˜¾ç¤ºçŠ¶æ€" name="status"><t-radio-group v-model="formData.status"><t-radio :value="1">æ˜¾ç¤º</t-radio><t-radio :value="0">éšè—</t-radio></t-radio-group></t-form-item></t-form></t-dialog>        </t-content>
      </t-layout>
    </t-layout>
  </div>

  <script src="../../assets/libs/vue.global.js"></script><script src="../../assets/libs/tdesign.min.js"></script><script src="../../assets/js/config.js"></script><script src="../../assets/js/admin-api.js"></script><script>const{createApp,ref,onMounted}=Vue;createApp({setup(){const loading=ref(false);const tableData=ref([]);const formVisible=ref(false);const formMode=ref('add');const formData=ref({});const filters=ref({keyword:'',courseId:null});const courseOptions=ref([]);const pagination=ref({current:1,pageSize:20,total:0});const columns=[{colKey:'cover',title:'å°é¢',width:100,cell:'cover'},{colKey:'title',title:'æ¡ˆä¾‹æ ‡é¢˜',width:200},{colKey:'course_name',title:'å…³è”è¯¾ç¨‹',width:150},{colKey:'description',title:'æè¿°',ellipsis:true},{colKey:'created_at',title:'åˆ›å»ºæ—¶é—´',width:160},{colKey:'status',title:'çŠ¶æ€',width:80,cell:'status'},{colKey:'operation',title:'æ“ä½œ',width:200,fixed:'right',cell:'operation'}];const rules={title:[{required:true,message:'è¯·è¾“å…¥æ¡ˆä¾‹æ ‡é¢˜',type:'error'}],cover:[{required:true,message:'è¯·è¾“å…¥å°é¢å›¾ç‰‡',type:'error'}],course_id:[{required:true,message:'è¯·é€‰æ‹©å…³è”è¯¾ç¨‹',type:'error'}],description:[{required:true,message:'è¯·è¾“å…¥æ¡ˆä¾‹æè¿°',type:'error'}]};const fetchData=async()=>{loading.value=true;try{const params={page:pagination.value.current,pageSize:pagination.value.pageSize,...filters.value};const data=await AdminAPI.getCaseList(params);tableData.value=data.list;pagination.value.total=data.total;}catch(error){TDesign.MessagePlugin.error(error.message||'è·å–æ•°æ®å¤±è´¥');}finally{loading.value=false;}};const fetchCourses=async()=>{try{const data=await AdminAPI.getAllCourses();courseOptions.value=data.map(c=>({label:c.name,value:c.id}));}catch(error){console.error('è·å–è¯¾ç¨‹åˆ—è¡¨å¤±è´¥',error);}};const handleSearch=()=>{pagination.value.current=1;fetchData();};const handleReset=()=>{filters.value={keyword:'',courseId:null};handleSearch();};const handlePageChange=(pageInfo)=>{pagination.value.current=pageInfo.current;pagination.value.pageSize=pageInfo.pageSize;fetchData();};const handleAdd=()=>{formMode.value='add';formData.value={status:1};formVisible.value=true;};const handleEdit=(row)=>{formMode.value='edit';formData.value={...row};formVisible.value=true;};const handleDelete=async(row)=>{const confirmed=await TDesign.DialogPlugin.confirm({header:'ç¡®è®¤åˆ é™¤',body:'ç¡®è®¤åˆ é™¤è¯¥æ¡ˆä¾‹å—ï¼Ÿ',theme:'warning'});if(!confirmed)return;try{await AdminAPI.deleteCase({caseId:row.id});TDesign.MessagePlugin.success('åˆ é™¤æˆåŠŸ');fetchData();}catch(error){TDesign.MessagePlugin.error(error.message||'åˆ é™¤å¤±è´¥');}};const handleToggleStatus=async(row)=>{try{await AdminAPI.updateCaseStatus({caseId:row.id,status:row.status===1?0:1});TDesign.MessagePlugin.success('çŠ¶æ€å·²æ›´æ–°');fetchData();}catch(error){TDesign.MessagePlugin.error(error.message||'æ“ä½œå¤±è´¥');}};const handleSubmit=async()=>{try{if(formMode.value==='add'){await AdminAPI.createCase(formData.value);}else{await AdminAPI.updateCase(formData.value);}TDesign.MessagePlugin.success('ä¿å­˜æˆåŠŸ');formVisible.value=false;fetchData();}catch(error){TDesign.MessagePlugin.error(error.message||'ä¿å­˜å¤±è´¥');}};onMounted(()=>{fetchData();fetchCourses();});return{loading,tableData,formVisible,formMode,formData,filters,courseOptions,pagination,columns,rules,handleSearch,handleReset,handlePageChange,handleAdd,handleEdit,handleDelete,handleToggleStatus,handleSubmit};}}).use(TDesign).mount('#app');</script></body></html>

