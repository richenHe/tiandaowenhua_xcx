<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™»å½• - å¤©é“æ–‡åŒ–åå°ç®¡ç†</title>
  
  <!-- TDesign CSSï¼ˆæœ¬åœ°ï¼‰-->
  <link rel="stylesheet" href="./assets/libs/tdesign.min.css">
  
  <!-- è‡ªå®šä¹‰æ ·å¼ -->
  <link rel="stylesheet" href="./assets/css/tokens.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      min-height: 100vh !important;
      margin: 0 !important;
      padding: 0 !important;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    #app {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      min-height: 100vh;
    }
    
    .login-container {
      width: 400px;
      background: white;
      border-radius: 8px;
      padding: 40px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    
    .login-title {
      text-align: center;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 32px;
      color: #333;
    }
    
    .login-form .t-form__item {
      margin-bottom: 24px;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="login-container">
      <h1 class="login-title">å¤©é“æ–‡åŒ–åå°ç®¡ç†</h1>
      
      <t-form
        ref="form"
        :data="formData"
        :rules="rules"
        label-width="0"
        class="login-form"
        @submit="handleLogin"
      >
        <t-form-item name="username">
          <t-input
            v-model="formData.username"
            size="large"
            placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
            clearable
          >
            <template #prefix-icon>
              <t-icon name="user" />
            </template>
          </t-input>
        </t-form-item>
        
        <t-form-item name="password">
          <t-input
            v-model="formData.password"
            type="password"
            size="large"
            placeholder="è¯·è¾“å…¥å¯†ç "
            clearable
          >
            <template #prefix-icon>
              <t-icon name="lock-on" />
            </template>
          </t-input>
        </t-form-item>
        
        <t-form-item>
          <t-button
            type="submit"
            theme="primary"
            size="large"
            block
            :loading="loading"
          >
            {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
          </t-button>
        </t-form-item>
      </t-form>
      
      <div style="text-align: center; color: #999; font-size: 12px; margin-top: 16px;">
        <p>é»˜è®¤è´¦å·ï¼šadmin / 123456</p>
      </div>
    </div>
  </div>

  <!-- Vue 3.4.21ï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/vue.global.js"></script>
  
  <!-- TDesign Vueï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/tdesign.min.js"></script>
  
  <!-- CloudBase SDK 2.10.0ï¼ˆæœ¬åœ°ï¼‰-->
  <script src="./assets/libs/tcb-v2.js"></script>
  
  <!-- é…ç½®æ–‡ä»¶ -->
  <script src="./assets/js/config.js?v=1707755020"></script>
  
  <!-- API å°è£… -->
  <script src="./assets/js/admin-api.js?v=1770964300"></script>
  
  <script>
    // æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®åŠ è½½
    if (!window.Vue) {
      alert('Vue æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
      throw new Error('Vue æœªåŠ è½½');
    }
    if (!window.TDesign) {
      alert('TDesign æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
      throw new Error('TDesign æœªåŠ è½½');
    }
    // å…¼å®¹ cloudbase å’Œ tcb ä¸¤ç§å…¨å±€å˜é‡å
    if (!window.cloudbase && !window.tcb) {
      alert('CloudBase SDK æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
      throw new Error('CloudBase SDK æœªåŠ è½½');
    }
    if (!window.CONFIG) {
      alert('é…ç½®æ–‡ä»¶æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
      throw new Error('é…ç½®æ–‡ä»¶æœªåŠ è½½');
    }
    if (!window.AdminAPI) {
      alert('AdminAPI æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
      throw new Error('AdminAPI æœªåŠ è½½');
    }
    
    console.log('âœ… æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆ');
    console.log('CloudBase SDK:', window.cloudbase ? 'cloudbase' : 'tcb');
    console.log('CloudBase ENV_ID:', CONFIG.ENV_ID);
    
    const { createApp, ref } = Vue;
    
    const app = createApp({
      setup() {
        const form = ref(null);
        const loading = ref(false);
        
        const formData = ref({
          username: '',
          password: ''
        });
        
        const rules = {
          username: [
            { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', type: 'error' }
          ],
          password: [
            { required: true, message: 'è¯·è¾“å…¥å¯†ç ', type: 'error' }
          ]
        };
        
        const handleLogin = async ({ validateResult }) => {
          if (validateResult !== true) return;
          
          loading.value = true;
          
          try {
            console.log('ğŸ” å¼€å§‹ç™»å½•:', formData.value.username);
            console.log('ğŸ“¡ ç¯å¢ƒID:', CONFIG.ENV_ID);
            
            // ç›´æ¥è°ƒç”¨ç™»å½•æ¥å£ï¼ˆsystem äº‘å‡½æ•°å·²è®¾ç½®ä¸º invoke: trueï¼‰
            const result = await AdminAPI.login(
              formData.value.username,
              formData.value.password
            );
            
            console.log('ç™»å½•æˆåŠŸ:', result);
            TDesign.MessagePlugin.success('ç™»å½•æˆåŠŸ');
            
            // è·³è½¬åˆ°ä¸»é¡µï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿åœ¨åŒä¸€ç›®å½•ï¼‰
            setTimeout(() => {
              window.location.href = './index.html';
            }, 500);
            
          } catch (error) {
            console.error('ç™»å½•å¤±è´¥:', error);
            TDesign.MessagePlugin.error(error.message || 'ç™»å½•å¤±è´¥');
          } finally {
            loading.value = false;
          }
        };
        
        return {
          form,
          formData,
          rules,
          loading,
          handleLogin
        };
      }
    });
    
    app.use(TDesign);
    app.mount('#app');
  </script>
</body>
</html>

